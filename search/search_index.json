{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"GenIce3 Manual","text":"<p>GenIce3 is a Swiss army knife to generate hydrogen-disordered ice structures (and related systems such as clathrate hydrates). You provide a unit cell name, optional replication and options (guests, ions, exporters), and GenIce3 produces atomic coordinates in formats suitable for molecular dynamics or visualization.</p> <p>Quick start: <code>genice3 1h &gt; ice.gro</code></p>"},{"location":"#documentation","title":"Documentation","text":"Section Description Getting started Installation, requirements, demo, what's new in GenIce3 CLI reference Command-line usage and options Basics Generating ice, supercells, seed, density Clathrate hydrates Guest molecules, cage types, occupancy Doping and defects Ions (CLI), H\u2083O\u207a/OH\u207b and Bjerrum defects (API) Output formats Exporters (GROMACS, CIF, LAMMPS, etc.) and generation stages Unit cells Table of unit cell symbols (1h, 4, CS2, CIF, \u2026) Water models Built-in water models (exporter <code>water_model</code> suboption) Guest molecules Built-in guest molecules for clathrates Plugins Extra PyPI plugins and custom unit cell / exporter / molecule plugins Changes from GenIce2 Cage survey and other changes Citation How to cite GenIce Contribute How to contribute License MIT License"},{"location":"#api-examples","title":"API examples","text":"<p>The API examples show how to use GenIce3 from Python with embedded sample code (basic usage, CIF I/O, doping, guest occupancy, polarization, unit cell extension, topological defects).</p>"},{"location":"#for-ai-assistants","title":"For AI assistants","text":"<p>A concise, structured overview of GenIce3 for AI/LLM systems that need to explain the project to users: For AI assistants.</p>"},{"location":"#links","title":"Links","text":"<ul> <li>Repository</li> <li>Bug tracker</li> <li>Try on Colaboratory</li> </ul>"},{"location":"README-check/","title":"README \u7531\u6765\u306e\u5185\u5bb9\u30c1\u30a7\u30c3\u30af\uff08\u7c21\u7d20\u5316\u5f8c\u306e\u5bfe\u5fdc\u72b6\u6cc1\uff09","text":""},{"location":"README-check/#docs","title":"\u5bfe\u5fdc\u6e08\u307f\uff08docs \u306b\u540c\u7b49\u4ee5\u4e0a\u304c\u3042\u308b\uff09","text":"\u65e7 README \u306e\u5185\u5bb9 \u73fe\u5728\u306e\u5834\u6240 Usage\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\u4e00\u89a7\uff09 docs/cli.md\uff08temp_docs \u304b\u3089\u751f\u6210\uff09 Examples\uff081h, CS2 \u7b49\uff09 docs/cli.md Basics\uff08depolarization, seed, density, \u30e2\u30b8\u30e5\u30fc\u30eb\u69cb\u6210\uff09 docs/basics.md Clathrate\uff08CS1/CS2 \u4f8b\u3001cage \u4e00\u89a7\u3001EO \u30d7\u30e9\u30b0\u30a4\u30f3\u4f8b\u3001\u591a\u91cd\u5360\u6709\u306e\u6ce8\u610f\uff09 docs/clathrate-hydrates.md Doping\uff08-a/-c, Na/Cl \u4f8b\u3001\u967d\u9670\u30a4\u30aa\u30f3\u540c\u6570\u3001\u30d7\u30ed\u30c8\u30f3/Bjerrum \u306f API \u306e\u307f\uff09 docs/doping-and-defects.md Output formats\uff08\u8868\u3001mdanalysis\u30017 \u30b9\u30c6\u30fc\u30b8\uff09 docs/output-formats.md Unit cells\uff08\u8868\u3001\u547d\u540d\u5bfe\u5fdc\u8868\u3001cif2ice\u3001\u30b5\u30d6\u30aa\u30d7\u30b7\u30e7\u30f3\u4ed8\u304d\u30d7\u30e9\u30b0\u30a4\u30f3\uff09 docs/unitcells.md\uff08\u81ea\u52d5\u751f\u6210\uff09 Water models\uff08\u8868\uff09 docs/water-models.md Guest molecules\uff08\u8868\uff09 docs/guest-molecules.md Extra plugins\uff08genice2-rdf \u7b49\uff09 docs/plugins.md Main changes from GenIce2\uff08cage_survey\uff09 docs/changes-from-genice2.md References / Citation / Contribute / License README + docs/citation.md, contribute.md, license.md"},{"location":"README-check/#_1","title":"\u73fe\u72b6\u3068\u305a\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u70b9","text":""},{"location":"README-check/#1-pyprojecttoml-versiondependencies","title":"1. pyproject.toml \u306e\u4e8c\u91cd\u7ba1\u7406\uff08version\u30fbdependencies\uff09","text":"<ul> <li>replacer \u304c\u53c2\u7167\u3057\u3066\u3044\u308b\u306e\u306f <code>[tool.poetry]</code>\uff08version, dependencies\uff09\u3002</li> <li><code>[project]</code> \u306b\u306f\u5225\u306e version\uff083.0a4\uff09\u3068\u4f9d\u5b58\uff08genice-core&gt;=1.3.1, cycless&gt;=0.7 \u7b49\uff09\u304c\u3042\u308b\u3002</li> <li>README / docs/getting-started \u306e\u300cVersion\u300d\u300cRequirements\u300d\u306f poetry \u5074 \u306e\u5024\u306b\u306a\u308b\u3002</li> <li>\u904b\u7528\u3067 <code>[project]</code> \u3092\u6b63\u3068\u3059\u308b\u5834\u5408\u3001README \u3068\u5b9f\u30d3\u30eb\u30c9\u306e\u60c5\u5831\u304c\u98df\u3044\u9055\u3046\u53ef\u80fd\u6027\u3042\u308a\u3002</li> <li>\u63d0\u6848: version \u3068 dependencies \u3092 <code>[project]</code> \u306b\u4e00\u672c\u5316\u3057\u3001replacer \u3067 <code>[project]</code> \u3092\u8aad\u3080\u3088\u3046\u306b\u3059\u308b\u304b\u3001\u5c11\u306a\u304f\u3068\u3082 poetry \u3068 project \u3092\u624b\u52d5\u3067\u63c3\u3048\u308b\u3002</li> </ul>"},{"location":"README-check/#2-c-yaml","title":"2. \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08-C / YAML\uff09\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u672a\u8a18\u8f09","text":"<ul> <li>\u65e7 README \u3067\u306f\u300c-C \u3067 YAML \u3092\u8aad\u3081\u308b\u3002\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f manual \u53c2\u7167\u300d\u3060\u3063\u305f\u3002</li> <li>\u73fe\u5728\u306e docs \u306b\u306f \u300cconfig \u30d5\u30a1\u30a4\u30eb\u306e YAML \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u300d\u306e\u8aac\u660e\u30da\u30fc\u30b8\u3084\u7bc0\u304c\u306a\u3044\u3002</li> <li>cli.md \u306e usage \u306b \"config file format\" \u3068\u51fa\u308b\u304c\u3001manual \u5185\u306b\u305d\u306e\u8aac\u660e\u304c\u306a\u3044\u3002</li> <li>\u63d0\u6848: docs \u306e CLI \u304b Getting started \u306b\u300c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u300d\u306e\u77ed\u3044\u7bc0\u3092\u8ffd\u52a0\u3057\u3001\u4f8b YAML \u3068\u4e3b\u8981\u30ad\u30fc\uff08unitcell, rep, exporter, guest \u7b49\uff09\u3092\u66f8\u304f\u3002</li> </ul>"},{"location":"README-check/#3-uathf-uathf6","title":"3. \u8868\u8a18\u306e\u3086\u308c\uff08uathf / uathf6\uff09","text":"<ul> <li>cli.md: <code>genice3 CS2 -g 16=uathf6 ...</code>\uff08\u65e7 README \u3068\u540c\u3058\uff09\u3002</li> <li>clathrate-hydrates.md: <code>genice3 CS2 -g 16=uathf -G 0=me</code>\u3002</li> <li>guest-molecules \u3067\u306f <code>uathf</code>\uff085-site\uff09\u3068 <code>uathf6</code>\uff08Undocumented\uff09\u304c\u5225\u30a8\u30f3\u30c8\u30ea\u3002</li> <li>\u610f\u56f3\u7684\u306b\u300c\u5225\u306e\u4f8b\u300d\u306a\u3089\u554f\u984c\u306a\u3044\u304c\u3001\u3069\u3061\u3089\u3092\u63a8\u3059\u304b\u3067\u63c3\u3048\u3066\u3082\u3088\u3044\u3002</li> </ul>"},{"location":"README-check/#_2","title":"\u4e0d\u8db3\u3057\u3066\u3044\u308b\u60c5\u5831\uff08\u3042\u3063\u305f\u65b9\u304c\u3088\u3044\u3082\u306e\uff09","text":"<ul> <li>-C / YAML \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\uff08\u4e0a\u8a18 2\uff09\u3002</li> <li>\u4e0a\u8a18\u4ee5\u5916\u3067\u3001\u65e7 README \u306b\u3042\u3063\u305f\u5b9f\u8cea\u7684\u306a\u8aac\u660e\u304c docs \u304b\u3089\u629c\u3051\u3066\u3044\u308b\u3082\u306e\u306f\u306a\u3057\u3002</li> </ul>"},{"location":"basics/","title":"Basics","text":"<p>The program generates various hydrogen-disordered ice structures without defects. The total dipole moment is set to zero unless you change the depolarization behavior with <code>--depol_loop</code> or <code>--target_polarization</code>. The minimal structure (with <code>--rep 1 1 1</code>) is not always a single unit cell, because handling the hydrogen-bond network topology of very small lattices under periodic boundary conditions is difficult. Note that the generated structure is not optimized for potential energy.</p> <ul> <li> <p>To generate a large supercell of ice Ih in CIF format:</p> <pre><code>genice3 1h --rep 8 8 8 -e cif &gt; 1hx888.cif\n</code></pre> </li> <li> <p>To generate an ice V lattice with a different hydrogen order in CIF format, use the <code>-s</code> option to set the random seed:</p> <pre><code>genice3 5 -s 1024 -e cif &gt; 5-1024.cif\n</code></pre> </li> <li> <p>To generate an ice VI lattice at a different density with the TIP4P water model in GROMACS format:</p> <pre><code>genice3 6 --density 1.00 -e \"gromacs :water_model tip4p\" &gt; 6d1.00.gro\n</code></pre> </li> </ul> <p>GenIce3 is modular: it loads unit cells from plugins in the <code>unitcell</code> folder, places water and guest molecules using plugins in the <code>molecules</code> folder, and writes output via plugins in the <code>exporter</code> folder. You can add your own plugins to extend GenIce3; many plugins accept options.</p>"},{"location":"changes-from-genice2/","title":"Main changes from GenIce2","text":"<ul> <li> <p>Cage survey output: The <code>-A</code> / <code>--assess_cages</code> option has been removed. To obtain cage positions and types, use the exporter plugin <code>cage_survey</code> (output is JSON; redirect to a file for reuse):</p> <pre><code>genice3 CS2 -e cage_survey &gt; cages.json\n</code></pre> </li> </ul>"},{"location":"citation/","title":"Citation","text":"<p>If you use GenIce in your work, please cite as described in CITATION.cff or the papers below.</p> <p>The algorithms for generating depolarized, hydrogen-disordered ice are described in:</p> <p>M. Matsumoto, T. Yagasaki, and H. Tanaka, \"GenIce: Hydrogen-Disordered Ice Generator\", J. Comput. Chem. 39, 61-64 (2017). DOI: 10.1002/jcc.25077</p> <pre><code>@article{Matsumoto:2017bk,\n    author = {Matsumoto, Masakazu and Yagasaki, Takuma and Tanaka, Hideki},\n    title = {GenIce: Hydrogen-Disordered Ice Generator},\n    journal = {Journal of Computational Chemistry},\n    volume = {39},\n    pages = {61-64},\n    year = {2017}\n}\n</code></pre> <p>M. Matsumoto, T. Yagasaki, and H. Tanaka, \"GenIce-core: Efficient algorithm for generation of hydrogen-disordered ice structures.\", J. Chem. Phys. 160, 094101 (2024). DOI:10.1063/5.0198056</p> <pre><code>@article{Matsumoto:2024,\n    author = {Matsumoto, Masakazu and Yagasaki, Takuma and Tanaka, Hideki},\n    title = {GenIce-core: Efficient algorithm for generation of hydrogen-disordered ice structures},\n    journal = {Journal of Chemical Physics},\n    volume = {160},\n    pages = {094101},\n    year = {2024}\n}\n</code></pre> <p>For the full reference list (with DOI links), see References in this manual (generated from <code>citations.yaml</code>).</p>"},{"location":"clathrate-hydrates/","title":"Clathrate hydrates","text":"<p>For clathrate hydrates, you can build lattices with cages partially occupied by guest molecules.</p> <ul> <li> <p>To generate a CS1 clathrate hydrate with TIP4P water and CO\u2082 in GROMACS .gro format (60% of small cages filled with CO\u2082, 40% with methane):</p> <pre><code>genice3 CS1 -g A12=co2*0.6+me*0.4 -g A14=co2 -e \"gromacs :water_model tip4p\" &gt; cs1.gro\n</code></pre> <p>You can look up cage names in advance with <code>cage_survey</code>:</p> <pre><code>genice3 CS1 -e cage_survey &gt; survey.log\n</code></pre> </li> <li> <p>To generate a CS2 clathrate hydrate with TIP5P water, THF in the large cages, and methane in one small cage: first run <code>genice3</code> without guest options:</p> <pre><code>genice3 CS2 -e cage_survey &gt; survey.log\n</code></pre> <p>The cage list will be printed, for example:</p> <pre><code>INFO:root:Cage types: ['A12', 'A16']\nINFO:root:Cage type A12: {1, 2, 4, ...}\nINFO:root:Cage type A16: {0, 3, 5, ...}\n</code></pre> <p>This shows two cage types, <code>A12</code> and <code>A16</code>. To fill type <code>A16</code> with THF and put methane in cage <code>0</code> of type <code>A12</code>:</p> <pre><code>genice3 CS2 -g A16=uathf -G 0=me &gt; CS2.gro\n</code></pre> </li> </ul> <p>Only a few guest molecules are included by default; you can add more by writing a plugin. Here is an example for ethylene oxide:</p> <pre><code>import numpy as np\nimport genice3.molecule\n\nclass Molecule(genice3.molecule.Molecule):\n    def __init__(self):\n        # United-atom EO model with a dummy site\n        LOC = 0.1436  # nm\n        LCC = 0.1472  # nm\n        Y = (LOC**2 - (LCC/2)**2)**0.5\n        sites = np.array([[0., 0., 0.], [-LCC/2, Y, 0.], [+LCC/2, Y, 0.]])\n        mass = np.array([16, 14, 14])\n        CoM = mass @ sites / np.sum(mass)\n        sites -= CoM\n        atoms = [\"O\", \"C\", \"C\"]\n        labels = [\"Oe\", \"Ce\", \"Ce\"]\n        name = \"EO\"\n        super().__init__(sites=sites, labels=labels, name=name, is_water=False)\n</code></pre> <p>Save this as <code>eo.py</code> in a <code>molecule</code> folder in your current directory.</p> <p>Multiple occupancy not supported</p> <p>Multiple occupancy is not supported. To model it, prepare a <code>molecule</code> plugin that represents multiple molecules.</p>"},{"location":"cli/","title":"Command-line interface","text":""},{"location":"cli/#usage","title":"Usage","text":"<pre><code>Usage: genice3 [OPTIONS] UNITCELL\n\nOptions:\n  -h, --help               Show this message and exit.\n  -V, --version            Show the version and exit.\n  -D, --debug              Enable debug mode.\n  --depol_loop INTEGER     Number of iterations for the depolarization\n                           optimization loop. Larger values may improve\n                           the quality of the hydrogen bond network.\n                           Default is 1000.\n  --target_polarization FLOAT FLOAT FLOAT\n                           Target polarization vector (three floats: Px\n                           Py Pz). The dipole optimization will aim to\n                           make the net polarization close to this\n                           value. Example: --target_polarization 0 0 0\n                           (default).\n  --replication_matrix INT INT INT INT INT INT INT INT INT\n                           Replication matrix as 9 integers (3x3\n                           matrix). This matrix defines how the unit\n                           cell is replicated to create the supercell.\n                           The first row (p, q, r) specifies that the\n                           new a' axis direction is represented as\n                           pa+qb+rc using the original unit cell's basis\n                           vectors (a, b, c). Similarly, the second row\n                           (s, t, u) specifies that the b' axis\n                           direction is sa+tb+uc, and the third row\n                           defines the c' axis. For example,\n                           --replication_matrix 0 1 0 1 0 0 0 0 1 swaps\n                           the a and b axes of the unit cell. Another\n                           example, --replication_matrix 1 1 0 1 -1 0 0\n                           0 1 transforms the unit cell such that a'=a+b\n                           and b'=a-b. If not specified,\n                           replication_factors is used instead.\n  -r, --rep, --replication_factors INT INT INT\n                           Repeat the unit cell along a, b, and c axes.\n                           For example, --rep 2 2 2 creates a 2x2x2\n                           supercell. This is a convenient shortcut for\n                           diagonal replication matrices.\n  -s, --seed INTEGER       Random seed for guest molecule placement and\n                           other stochastic processes. Using the same\n                           seed will produce reproducible results.\n  -e, --exporter TEXT      Exporter plugin name (e.g. 'gromacs').\n                           Exporter-specific options are given as :key\n                           value after UNITCELL (e.g. gromacs\n                           :water_model 4site).\n  -g, --guest TEXT         Specify guest molecules for each cage type.\n                           Format: CAGE_LABEL=GUEST_SPEC. Examples:\n                           A12=me (single), 12=co2*0.6+me*0.4\n                           (probabilistic mix; use quotes in shell: -g\n                           \"12=co2*0.6+me*0.4\"). Both molecule*occupancy\n                           (co2*0.6) and occupancy*molecule (0.6*co2)\n                           are accepted. Multiple cage types with\n                           multiple -g options.\n  -G, --spot_guest TEXT    Specify guest molecule at a specific cage\n                           index. Format: CAGE_INDEX=MOLECULE_NAME, e.g.\n                           0=me, 5=4site. Multiple spot guests can be\n                           specified with multiple -G options.\n  -a, --anion TEXT         Anion at lattice site (unitcell-defined).\n                           Passed to unitcell plugin. Format:\n                           INDEX=ION_NAME (e.g. -a 3=Cl). Same as\n                           unitcell suboption --anion.\n  -c, --cation TEXT        Cation at lattice site (unitcell-defined).\n                           Passed to unitcell plugin. Format:\n                           INDEX=ION_NAME (e.g. -c 3=Na). Same as\n                           unitcell suboption --cation.\n  -A, --spot_anion TEXT    Specify anion replacing the specified water\n                           molecule (spot doping). Format:\n                           WATER_INDEX=ION_NAME. Examples: -A 13=Cl\n                           (place Cl- in cage 13), -A 32=Br (place Br-\n                           in cage 32). Multiple spot anions can be\n                           specified with multiple -A options.\n  -C, --spot_cation TEXT   Specify cation replacing the specified water\n                           molecule (spot doping). Format:\n                           WATER_INDEX=ION_NAME. Examples: -C 13=Na\n                           (place Na+ in cage 13), -C 32=K (place K+ in\n                           cage 32). Multiple spot cations can be\n                           specified with multiple -C options.\n  -Y, --config PATH        Path to a YAML configuration file. Settings\n                           from the config file will be overridden by\n                           command-line arguments. See documentation for\n                           the config file format.\n\nArguments:\n  UNITCELL                 Unitcell plugin name (required)\n\nUnitcell options (depend on UNITCELL; some unitcell may have additional options. Pass after UNITCELL):\n  --density FLOAT          Target density (e.g. g/cm\u00b3). Supported by\n                           many unit cells.\n  --shift X Y Z            Shift fractional coordinates. Supported by\n                           many unit cells.\n  --cation INDEX=ION       Cation at lattice site (unitcell-defined).\n                           May support :group suboption.\n  --anion INDEX=ION        Anion at lattice site (unitcell-defined).\n</code></pre> <p>Give the unit cell name as the first argument (see Unit cells for symbols such as <code>1h</code>, <code>4</code>, <code>CS2</code>), then options. Optional settings can be read from a YAML file with <code>-Y path/to/config.yaml</code>. Use <code>./genice3.x</code> instead of <code>genice3</code> when running from the source tree.</p>"},{"location":"cli/#config-file","title":"Config file","text":"<p>The <code>-Y</code> / <code>--config</code> option loads a YAML file. Keys correspond to command-line options; values are overridden by any options given on the command line. Top-level keys include:</p> <ul> <li>unitcell: unit cell name (string) or <code>name</code> plus options (e.g. <code>shift</code>).</li> <li>genice3: options such as <code>seed</code>, <code>depol_loop</code>, <code>replication_factors</code> (or <code>replication_matrix</code>), <code>debug</code>.</li> <li>exporter: exporter name (string) or <code>name</code> plus options (e.g. <code>guest</code>).</li> <li>spot_anion / spot_cation: water index \u2192 ion name (see Doping and defects).</li> </ul> <p>Example (minimal):</p> <pre><code>unitcell: 1h\nexporter: gromacs\ngenice3:\n  seed: 42\n  replication_factors: [2, 2, 2]\n</code></pre> <p>A longer example is in the repository: examples/config_example.yaml.</p>"},{"location":"cli/#examples","title":"Examples","text":"<ul> <li> <p>To generate a 3\u00d73\u00d73 supercell of hydrogen-disordered ice IV with TIP4P water in GROMACS .gro format:</p> <pre><code>genice3 4 --water tip4p --rep 3 3 3 &gt; ice4.gro\n</code></pre> </li> <li> <p>To generate a 2\u00d72\u00d74 supercell of CS2 clathrate hydrate with TIP4P water and THF in the large cages (united-atom model) in GROMACS .gro format:</p> <pre><code>genice3 CS2 -g 16=uathf6 --water tip4p --rep 2 2 4 &gt; cs2-224.gro\n</code></pre> </li> </ul>"},{"location":"contribute/","title":"How to contribute","text":"<p>GenIce has been available as open source software on GitHub since 2015. Feedback, suggestions for improvements and enhancements, bug fixes, etc. are sincerely welcome. Developers and test users are also welcome. If you have any ice structure that is publicly available but not included in GenIce, please let us know.</p>"},{"location":"doping-and-defects/","title":"Doping ions and topological defects","text":""},{"location":"doping-and-defects/#two-ways-to-place-ions","title":"Two ways to place ions","text":"<p>GenIce3 supports two kinds of ion placement, each with its own CLI options:</p> Purpose Short Long Meaning Unit-cell ions (lattice sites, replicated with the cell) <code>-a</code> <code>--anion</code> Anion at a unit-cell site index <code>-c</code> <code>--cation</code> Cation at a unit-cell site index Spot ions (specific water in the supercell) <code>-A</code> <code>--spot_anion</code> Anion replacing one water molecule by supercell index <code>-C</code> <code>--spot_cation</code> Cation replacing one water molecule by supercell index <p>You can combine both: e.g. unit-cell ions for a periodic pattern and spot ions for extra doping at chosen cages.</p>"},{"location":"doping-and-defects/#unit-cell-ions-a-c-lattice-sites-replicated-with-the-cell","title":"Unit-cell ions: <code>-a</code> / <code>-c</code> (lattice sites, replicated with the cell)","text":"<p>Unit-cell anions and cations are defined by a site index in the unit cell. Those sites are replicated with the lattice (e.g. <code>--rep 2 2 2</code> gives the same ion pattern in every 2\u00d72\u00d72 replica). Use <code>-a</code> (anion) and <code>-c</code> (cation):</p> <ul> <li><code>-a SITE_INDEX=ION_NAME</code> \u2014 put an anion at that lattice site in the unit cell</li> <li><code>-c SITE_INDEX=ION_NAME</code> \u2014 put a cation at that lattice site in the unit cell</li> </ul> <p>Example: CS2 clathrate with Na\u207a at unit-cell site 0 and Cl\u207b at unit-cell site 1; the pattern is repeated with replication:</p> <pre><code>genice3 CS2 -c 0=Na -a 1=Cl --rep 2 2 2 -e gromacs &gt; CS2.gro\n</code></pre> <p>YAML config equivalent:</p> <pre><code>unitcell: CS2\ncation: 0=Na\nanion: 1=Cl\nrep: [2, 2, 2]\nexporter: gromacs\n</code></pre> <p>Many unit cells (e.g. A15, CS2) support optional <code>:group</code> suboptions for cations (e.g. <code>--cation 0=N :group 1=methyl 6=methyl</code>). See API examples \u2192 doping.</p>"},{"location":"doping-and-defects/#spot-ions-a-c-specific-water-molecules-in-the-supercell","title":"Spot ions: <code>-A</code> / <code>-C</code> (specific water molecules in the supercell)","text":"<p>Spot anions and cations replace specific water molecules by their water index in the replicated supercell. Use <code>-A</code> (spot_anion) and <code>-C</code> (spot_cation):</p> <ul> <li><code>-A WATER_INDEX=ION_NAME</code> \u2014 put an anion at that water molecule (by supercell index)</li> <li><code>-C WATER_INDEX=ION_NAME</code> \u2014 put a cation at that water molecule (by supercell index)</li> </ul> <p>Example: A15 clathrate, 2\u00d72\u00d72 supercell; put Cl\u207b at water index 1 and Na\u207a at water index 51 in the supercell:</p> <pre><code>genice3 A15 --rep 2 2 2 -A 1=Cl -C 51=Na -e gromacs &gt; A15_doped.gro\n</code></pre> <p>YAML config equivalent:</p> <pre><code>unitcell: A15\nreplication_factors: [2, 2, 2]\nspot_anion: 1=Cl\nspot_cation: 51=Na\nexporter: gromacs\n</code></pre> <p>Multiple spot ions: use several options, e.g. <code>-A 1=Cl -A 35=Br -C 1=Na -C 35=K</code>.</p> <p>Charge balance</p> <p>The total number of cations and anions must be equal, or the ice rule cannot be satisfied and the program may not terminate.</p>"},{"location":"doping-and-defects/#protonic-and-bjerrum-defects-api-only","title":"Protonic and Bjerrum defects (API only)","text":"<p>With the GenIce3 Python API you can embed protonic defects (H\u2083O\u207a and OH\u207b) and Bjerrum topological defects at specified positions in the lattice. These are not exposed as command-line options yet.</p> <ul> <li>H\u2083O\u207a / OH\u207b: Use <code>spot_hydroniums</code> and <code>spot_hydroxides</code> (lists of site indices). See API examples \u2192 Topological defects.</li> <li>Bjerrum L/D defects: Place defects on specific edges (hydrogen bonds) by fixing adjacent bond orientations; use helpers such as <code>edges_closeto()</code> to find the edge nearest to a coordinate. Example scripts: <code>examples/api/12_topological_defect.py</code> and <code>examples/api/13_topological_defect2.py</code>.</li> </ul>"},{"location":"for-ai-assistants/","title":"GenIce3: Overview for AI Assistants","text":"<p>This page is intended for AI/LLM systems that need to understand and explain GenIce3 to users. It provides a compact, structured summary of the project.</p>"},{"location":"for-ai-assistants/#what-genice3-is","title":"What GenIce3 is","text":"<ul> <li>GenIce3 is a Python program and library that generates hydrogen-disordered ice structures (and related systems such as clathrate hydrates).</li> <li>It takes a unit cell (lattice type), optionally replicates it, applies the ice rule and depolarization, orients water molecules, and exports atomic coordinates in various formats (GROMACS, CIF, LAMMPS, etc.).</li> <li>It does not perform energy minimization; structures are topologically correct but not energy-optimized.</li> </ul>"},{"location":"for-ai-assistants/#key-concepts","title":"Key concepts","text":"Concept Meaning Unit cell A small repeating unit of the ice/clathrate lattice (e.g. <code>1h</code> = Ice Ih, <code>CS2</code> = clathrate sII). Specified by name as first argument. Replication The unit cell is repeated to form a supercell (<code>--rep 2 2 2</code> or <code>--replication_matrix</code>). Ice rule Each oxygen has exactly two covalently bound hydrogens; hydrogen bonds are assigned to satisfy this. Depolarization Dipole optimization so that net polarization is near a target (default zero). Cages In clathrates, cavities (e.g. 12-hedra, 16-hedra) that can hold guest molecules (methane, THF, etc.). Doping Unit-cell ions: <code>-a</code>/<code>--anion</code>, <code>-c</code>/<code>--cation</code> (lattice sites). Spot ions: <code>-A</code>/<code>--spot_anion</code>, <code>-C</code>/<code>--spot_cation</code> (specific water in supercell). See Doping and defects. Protonic / Bjerrum defects H\u2083O\u207a, OH\u207b, or L/D Bjerrum defects; currently API-only (see API examples)."},{"location":"for-ai-assistants/#entry-points","title":"Entry points","text":"<ol> <li>Command line: <code>genice3 [OPTIONS] UNITCELL</code> </li> <li>Unit cell name is required. Options include <code>--rep</code>, <code>-e</code> (exporter), <code>-g</code>/<code>-G</code> (guests), <code>-a</code>/<code>-c</code> (unitcell ions), <code>-A</code>/<code>-C</code> (spot ions), <code>-Y</code> (config file).  </li> <li> <p>Full list: run <code>genice3 --help</code> or see CLI reference.</p> </li> <li> <p>Python API: <code>from genice3.genice import GenIce3; from genice3.plugin import UnitCell, Exporter</code> </p> </li> <li>Create <code>GenIce3()</code>, set <code>genice.unitcell = UnitCell(\"A15\")</code> (or other name), optionally set <code>replication_matrix</code>, <code>spot_anions</code>, <code>spot_cations</code>, <code>spot_hydroniums</code>, <code>spot_hydroxides</code>, then access reactive properties (<code>graph</code>, <code>lattice_sites</code>, <code>digraph</code>, <code>orientations</code>) or call <code>Exporter(\"gromacs\").dump(genice, ...)</code>.  </li> <li>Reactive pipeline: Properties like <code>fixed_edges</code>, <code>digraph</code>, <code>orientations</code> are computed on demand from <code>unitcell</code>, <code>spot_*</code>, etc.  </li> <li>Examples: API examples (with embedded code).</li> </ol>"},{"location":"for-ai-assistants/#plugin-architecture","title":"Plugin architecture","text":"<ul> <li>Unit cells: Plugins in <code>unitcell</code> (built-in and user-added); name passed as first CLI argument or <code>UnitCell(\"Name\", ...)</code>. Some unit cells require options: pass them as keyword arguments, e.g. <code>UnitCell(\"CIF\", file=\"path/to.cif\")</code>, <code>UnitCell(\"aeroice\", length=3)</code> or <code>UnitCell(\"xFAU\", length=3)</code> (length = hexagonal prism length), <code>UnitCell(\"zeolite\", code=\"LTA\")</code>. See Unit cells for the list and suboption tables.</li> <li>Exporters: Plugins in <code>exporter</code>; selected with <code>-e</code> or <code>Exporter(\"name\").dump(genice, ...)</code>.</li> <li>Molecules: Water and guest models in <code>molecules</code>; water model via exporter suboption (e.g. <code>-e \"gromacs :water_model tip4p\"</code> or config <code>exporter.water_model</code>), or in API <code>Exporter(\"gromacs\").dump(genice, water_model=\"tip5p\")</code>. Symbols: tip3p, tip4p, 5site/tip5p, etc. See Water models. <code>-g</code>/<code>-G</code> for guests.</li> <li>User can add plugins by placing Python modules in <code>unitcell</code>, <code>exporter</code>, or <code>molecules</code> directories (e.g. current working directory).</li> </ul>"},{"location":"for-ai-assistants/#common-tasks-quick-answers","title":"Common tasks (quick answers)","text":"<ul> <li>Generate Ice Ih: <code>genice3 1h</code> or <code>genice3 1h --rep 2 2 2 -e gromacs &gt; ice.gro</code></li> <li>Clathrate with guests: <code>genice3 CS2 -g 16=uathf -G 0=me</code> (guest by cage type and by cage index)</li> <li>Ions: <code>genice3 CS2 -c 0=Na -a 1=Cl</code> (equal number of cations and anions required)</li> <li>H\u2083O\u207a/OH\u207b or Bjerrum defects: Use the Python API; see Topological defects.</li> <li>Output formats: GROMACS (default), CIF, LAMMPS, plotly, cage_survey (JSON), etc. See Output formats.</li> <li>List of unit cells: See Unit cells (symbols like <code>1h</code>, <code>4</code>, <code>CS1</code>, <code>CIF</code> for CIF file input).</li> </ul>"},{"location":"for-ai-assistants/#where-to-find-more","title":"Where to find more","text":"<ul> <li>Manual (this site): Home, Getting started, CLI, API examples.</li> <li>Repository: github.com/genice-dev/GenIce3.</li> <li>Citation: Citation; core algorithm in J. Comput. Chem. (2017) and J. Chem. Phys. (2024).</li> </ul> <p>When explaining GenIce3 to a user, prefer linking to the relevant manual section (e.g. CLI, ice structures, API examples) and summarize in one or two sentences what the user can do (generate ice/clathrate, choose lattice, export to MD formats, add ions or defects via API).</p>"},{"location":"getting-started/","title":"Getting started","text":""},{"location":"getting-started/#quick-start","title":"Quick start","text":"<p>To generate a hydrogen-disordered ice structure, use the unit cell name (e.g. <code>1h</code> for Ice Ih, <code>4</code> for Ice IV) as the first argument:</p> <pre><code>genice3 1h &gt; ice.gro\n</code></pre> <p>Full documentation is available at the manual.</p>"},{"location":"getting-started/#new-in-genice3","title":"New in GenIce3","text":"<ul> <li>Command line<ul> <li>Option syntax is now unified.</li> <li>Options can also be read from config files.</li> </ul> </li> <li>API<ul> <li>The API has been significantly improved.</li> <li>Python users can embed protonic (H\u2083O\u207a, OH\u207b) and Bjerrum topological defects directly into ice lattices.</li> </ul> </li> <li>Algorithm<ul> <li>A reactive programming style is used; the <code>DependencyEngine</code> was developed for this purpose.</li> <li>Once you specify the required data, the data generation pipeline is prepared and run automatically.</li> </ul> </li> </ul>"},{"location":"getting-started/#demo","title":"Demo","text":"<p>GenIce3 works well in interactive environments. Try it on Google Colaboratory.</p>"},{"location":"getting-started/#requirements","title":"Requirements","text":"<ul> <li>networkx &gt;=2.0.dev20160901144005</li> <li>numpy &gt;=2.0</li> <li>pairlist &gt;=0.6.4</li> <li>cycless &gt;=0.7</li> <li>graphstat &gt;=0.3.3</li> <li>yaplotlib &gt;=0.1.2</li> <li>openpyscad &gt;=0.5.0</li> <li>genice-core &gt;=1.3.1</li> <li>pyyaml &gt;=6.0</li> <li>jinja2 &gt;=3.1.4</li> <li>cif2ice (&gt;=0.4.1,&lt;0.5.0)</li> </ul>"},{"location":"getting-started/#installation","title":"Installation","text":"<p>GenIce3 is on PyPI. Install with pip:</p> <pre><code>pip install genice3\n</code></pre>"},{"location":"getting-started/#uninstallation","title":"Uninstallation","text":"<pre><code>pip uninstall genice3\n</code></pre>"},{"location":"guest-molecules/","title":"Guest molecules","text":"symbol type References H2 Hydrogen molecule. [https://www.britannica.com/science/hydrogen] ch4, co2 An all-atom methane model. et, me A united-atom methane model. mol Loader for MOL files (generated by MolView.org), e.g. mol[THF.mol]. thf An all-atom tetrahydrofuran (THF) model. uathf A united-atom five-site tetrahydrofuran (THF) model. empty, g12, g14, g15, g16, one, uathf6 (Undocumented) <p>For THF, <code>uathf</code> is a 5-site united-atom model; <code>uathf6</code> adds a dummy site (e.g. for some force fields). Both can be used with <code>-g</code> (e.g. <code>-g 16=uathf</code> or <code>-g 16=uathf6</code>).</p> <p>You can add custom guest molecules by placing plugins in a <code>molecules</code> directory in the current working directory.</p>"},{"location":"ice-structures/","title":"Ice structures (moved)","text":"<p>The unit cell list has been moved to Unit cells.</p>"},{"location":"license/","title":"License","text":"<p>GenIce3 is distributed under the MIT License. See LICENSE in the repository for details.</p>"},{"location":"output-formats/","title":"Output formats","text":"Name Application extension water solute HB suboptions remarks <code>_KG</code> Kirkwood G(r) Statistical test suite 2: Calculate G(r) for checking long-range disorder in molecular orientations. <code>_pol</code> Polarization none Calculate the polarization of the ice. <code>cage_survey</code> JSON .json none none none Cage positions and types (fractional coords, labels, faces). Replaces -A/--assess_cages. <code>cif</code> CIF .cif Atomic positions Atomic positions none Experimental <code>g</code>, <code>gromacs</code> Gromacs .gro Atomic positions Atomic positions none water_model: 3site, 4site, 6site, tip4p, etc. (water model name). Default format. <code>lammps</code>, <code>lmp</code> LAMMPS .lammps Atomic positions Atomic positions none water_model: 3site, 4site, 6site, tip4p, etc. (water model name). Yet to be verified. <code>py</code>, <code>python</code> Python unitcell plugin .py none none graph name: output unitcell module name (default: exported). Outputs a unitcell plugin where the supercell becomes the new unit cell. <code>y</code>, <code>yaplot</code> Yaplot .yap Atomic positions Atomic positions o H: radius of H atom (numeric). It renders molecular configurations and the HB network. <p>A GenIce3-compatible plugin genice3-mdanalysis is available; it provides an exporter for MDAnalysis and the many formats it supports. See <code>genice3-mdanalysis</code>. Plugins lists other prepared/planned plugins.</p> <p>You can add custom output formats by placing exporter plugins in an <code>exporter</code> directory under the current working directory.</p>"},{"location":"output-formats/#pipeline-reactive-dependency","title":"Pipeline (Reactive / Dependency)","text":"<p>GenIce3 does not use the old GenIce2-style fixed \u201cseven stages\u201d. The pipeline is reactive: which steps run is determined automatically from the Dependency graph. You request outputs (e.g. coordinates, cage list); the engine runs only the tasks required to produce them. Exporter plugins register hooks that run when their inputs become available.</p>"},{"location":"plugins/","title":"Plugins and extensions","text":""},{"location":"plugins/#prepared-exporter-plugins","title":"Prepared exporter plugins","text":"<p>The following exporter plugins are prepared for GenIce3 (install separately; compatibility may vary):</p> <ul> <li> <p>genice3-svg (<code>pip install genice3-svg</code>)</p> </li> <li> <p>genice3-py3dmol (<code>pip install genice3-py3dmol</code>)</p> </li> <li> <p>genice3-mdanalysis (<code>pip install genice3-mdanalysis</code>)</p> </li> </ul> <p>(List is maintained in <code>EXTRA.yaml</code> in the repository.)</p>"},{"location":"plugins/#custom-plugins","title":"Custom plugins","text":"<ul> <li>Unit cells: Place unit-cell plugins in a <code>unitcell</code> directory. The cif2ice tool can help create lattice modules from CIF files (e.g. from the IZA structure database).</li> <li>Exporters: Place exporter plugins in an <code>exporter</code> directory under the current working directory to add custom output formats.</li> <li>Molecules: Place water or guest molecule plugins in a <code>molecule</code> directory in the current working directory (see Clathrate hydrates for an example guest plugin).</li> </ul>"},{"location":"plugins/#plugin-source-locations","title":"Plugin source locations","text":"<p>Built-in unit cells and water/guest molecules live in the <code>genice3</code> package (<code>genice3/unitcell/</code>, <code>genice3/molecule/</code>). For developers, the source code for each plugin is in the corresponding module file; the Unit cells and Water models / Guest molecules tables list the symbol names that correspond to those modules.</p>"},{"location":"references/","title":"References","text":"<ul> <li>Abascal 2005: ABASCAL, J. L. F., SANZ, E., GARC\u00cdA FERN\u00c1NDEZ, R. and VEGA, C., 2005. A potential model for the study of ices and amorphous water: TIP4P/Ice. The Journal of Chemical Physics. Online. 15 June 2005. Vol.\u00a0122, no.\u00a023. DOI\u00a010.1063/1.1931662.</li> </ul> <ul> <li>Avogadro: Avogadro https://github.com/cryos/avogadro/blob/master/crystals/ice/H2O-Ice-IV.cif</li> </ul> <ul> <li>Baez 1998: B\u00c1EZ, Luis A. and CLANCY, Paulette, 1995, Phase equilibria in extended simple point charge ice\u2010water systems. The Journal of Chemical Physics [online]. 8 December 1995. Vol.\u00a0103, no.\u00a022, p.\u00a09744\u20139755. DOI\u00a010.1063/1.469938. Available from: http://dx.doi.org/10.1063/1.469938</li> </ul> <ul> <li>Berendsen 1987: H. J. C. Berendsen, J. R. Grigera, and T. P. Straatsma, J. Phys. Chem. 91, 6269 1987.</li> </ul> <ul> <li>Cockayne 1995: COCKAYNE, Eric, 1995. Dense quasiperiodic decagonal disc packing. Physical Review B [online]. 1 June 1995. Vol.\u00a051, no.\u00a021, p.\u00a014958\u201314961. DOI\u00a010.1103/physrevb.51.14958. Available from: http://dx.doi.org/10.1103/PhysRevB.51.14958</li> </ul> <ul> <li>Engel 2018: ENGEL, Edgar A., ANELLI, Andrea, CERIOTTI, Michele, PICKARD, Chris J. and NEEDS, Richard J., 2018, Mapping uncharted territory in ice\u00a0from zeolite networks to ice structures. Nature Communications [online]. 5 June 2018. Vol.\u00a09, no.\u00a01. DOI\u00a010.1038/s41467-018-04618-6. Available from: http://dx.doi.org/10.1038/s41467-018-04618-6</li> </ul> <ul> <li>Frank 1959: FRANK, F. C. and KASPER, J. S., 1959, Complex alloy structures regarded as sphere packings. II. Analysis and classification of representative structures. Acta Crystallographica [online]. 10 July 1959. Vol.\u00a012, no.\u00a07, p.\u00a0483\u2013499. DOI\u00a010.1107/s0365110x59001499. Available from: http://dx.doi.org/10.1107/S0365110X59001499</li> </ul> <ul> <li>Falenty 2014: FALENTY, Andrzej, HANSEN, Thomas C. and KUHS, Werner F., 2014, Formation and properties of ice XVI obtained by emptying a type sII clathrate hydrate. Nature [online]. December 2014. Vol.\u00a0516, no.\u00a07530, p.\u00a0231\u2013233. DOI\u00a010.1038/nature14014. Available from: http://dx.doi.org/10.1038/nature14014</li> </ul> <ul> <li>Fan 2010: Xiaofeng Fan, Dan Bing, Jingyun Zhang, Zexiang Shen, Jer-Lai Kuo,  Computational Materials Science 49 (2010) S170\u2013S175.</li> </ul> <ul> <li>Fennell 2005: FENNELL, Christopher J. and GEZELTER, J. Daniel, 2005, Computational Free Energy Studies of a New Ice Polymorph Which Exhibits Greater Stability than Ice Ih. Journal of Chemical Theory and Computation [online]. 30 April 2005. Vol.\u00a01, no.\u00a04, p.\u00a0662\u2013667. DOI\u00a010.1021/ct050005s. Available from: http://dx.doi.org/10.1021/ct050005s</li> </ul> <ul> <li>Geiger 2014: GEIGER, Philipp, DELLAGO, Christoph, MACHER, Markus, FRANCHINI, Cesare, KRESSE, Georg, BERNARD, J\u00fcrgen, STERN, Josef N. and LOERTING, Thomas, 2014. Proton Ordering of Cubic Ice Ic: Spectroscopy and Computer Simulations. The Journal of Physical Chemistry C. Online. 13 May 2014. Vol.\u00a0118, no.\u00a020, p.\u00a010989\u201310997. DOI\u00a010.1021/jp500324x.</li> </ul> <ul> <li>Hirata 2017: HIRATA, Masanori, YAGASAKI, Takuma, MATSUMOTO, Masakazu and TANAKA, Hideki, 2017, Phase Diagram of TIP4P/2005 Water at High Pressure. Langmuir [online]. 24 August 2017. Vol.\u00a033, no.\u00a042, p.\u00a011561\u201311569. DOI\u00a010.1021/acs.langmuir.7b01764. Available from: http://dx.doi.org/10.1021/acs.langmuir.7b01764</li> </ul> <ul> <li>Hirsch 2004: Hirsch, T. K. &amp; Ojam\u00e4e, L. Quantum-Chemical and Force-Field Investigations of Ice Ih: Computation of Proton-Ordered Structures and Prediction of Their Lattice Energies. J. Phys. Chem. B 108, 15856-15864 (2004)</li> </ul> <ul> <li>Huang 2016: HUANG, Yingying, ZHU, Chongqin, WANG, Lu, CAO, Xiaoxiao, SU, Yan, JIANG, Xue, MENG, Sheng, ZHAO, Jijun and ZENG, Xiao Cheng, 2016, A new phase diagram of water under negative pressure: The rise of the lowest-density clathrate s-III. Science Advances [online]. February 2016. Vol.\u00a02, no.\u00a02, p.\u00a0e1501010. DOI\u00a010.1126/sciadv.1501010. Available from: http://dx.doi.org/10.1126/sciadv.1501010</li> </ul> <ul> <li>Huang 2017: HUANG, Yingying, ZHU, Chongqin, WANG, Lu, ZHAO, Jijun and ZENG, Xiao Cheng, 2017, Prediction of a new ice clathrate with record low density: A potential candidate as ice XIX in guest-free form. Chemical Physics Letters [online]. March 2017. Vol.\u00a0671, p.\u00a0186\u2013191. DOI\u00a010.1016/j.cplett.2017.01.035. Available from: http://dx.doi.org/10.1016/j.cplett.2017.01.035</li> </ul> <ul> <li>IZA Database: http://www.iza-structure.org/databases/</li> </ul> <ul> <li>Jackson 1997: Jackson, S. M., V. M. Nield, R. W. Whitworth, M. Oguro, and C. C. Wilson, 1997, \u2018\u2018Single-crystal neutron diffraction studies of the structure of ice XI,\u2019\u2019 J. Phys. Chem. B 101, 6142.</li> </ul> <ul> <li>Jeffrey 1984: G. A. Jeffrey, In Inclusion Compounds; J. L. Atwood, J. E. D. Davies, D. D. MacNicol, Eds.; Academic Press: London, 1984, Vol. 1, Chap. 5.</li> </ul> <ul> <li>Jorgensen 1983: W. L. Jorgensen, J. Chandrasekhar, J. D. Madura, R. W. Impey, and M. L. Klein, Comparison of simple potential functions for simulating liquid water, J. Chem. Phys. 79 (1983) 926-935.</li> </ul> <ul> <li>Jorgensen 1985: W. L. Jorgensen and J. D. Madura, Temperature and size dependence for monte carlo simulations of TIP4P water, Mol. Phys. 56 (1985) 1381-1392.</li> </ul> <ul> <li>Kamb 1964: Kamb, B.IUCr. Ice. II. A proton-ordered form of ice. Acta Cryst 17, 1437\u20131449 (1964).</li> </ul> <ul> <li>Kamb 2003: Kamb, B., Hamilton, W. C., LaPlaca, S. J. &amp; Prakash, A. Ordered Proton Configuration in Ice II, from Single\u2010Crystal Neutron Diffraction. J. Chem. Phys. 55, 1934\u20131945 (2003).</li> </ul> <ul> <li>Karttunen 2011: KARTTUNEN, Antti J., FA\u0308SSLER, Thomas F., LINNOLAHTI, Mikko and PAKKANEN, Tapani A., 2011, Structural Principles of Semiconducting Group 14 Clathrate Frameworks. Inorganic Chemistry [online]. 7 March 2011. Vol.\u00a050, no.\u00a05, p.\u00a01733\u20131742. DOI\u00a010.1021/ic102178d. Available from: http://dx.doi.org/10.1021/ic102178d</li> </ul> <ul> <li>Koga 1997: KOGA, Kenichiro, ZENG, X. C. and TANAKA, Hideki, 1997. Freezing of Confined Water: A Bilayer Ice Phase in Hydrophobic Nanopores. Physical Review Letters [online]. 29 December 1997. Vol.\u00a079, no.\u00a026, p.\u00a05262\u20135265. DOI\u00a010.1103/physrevlett.79.5262. Available from: http://dx.doi.org/10.1103/PhysRevLett.79.5262</li> </ul> <ul> <li>Koga 2001: KOGA, Kenichiro, GAO, G. T., TANAKA, Hideki and ZENG, X. C., 2001, Formation of ordered ice nanotubes inside carbon nanotubes. Nature [online]. August 2001. Vol.\u00a0412, no.\u00a06849, p.\u00a0802\u2013805. DOI\u00a010.1038/35090532. Available from: http://dx.doi.org/10.1038/35090532</li> </ul> <ul> <li>Kosyakov 1999: KOSYAKOV, V. I. and POLYANSKAYA, T. M., 1999, Using structural data for estimating the stability of water networks in clathrate and semiclathrate hydrates. Journal of Structural Chemistry [online]. March 1999. Vol.\u00a040, no.\u00a02, p.\u00a0239\u2013245. DOI\u00a010.1007/bf02903652. Available from: http://dx.doi.org/10.1007/BF02903652</li> </ul> <ul> <li>Koza 2000: KOZA, M. M., SCHOBER, H., HANSEN, T., T\u00d6LLE, A. and FUJARA, F., 2000, Ice XII in Its Second Regime of Metastability. Physical Review Letters [online]. 1 May 2000. Vol.\u00a084, no.\u00a018, p.\u00a04112\u20134115. DOI\u00a010.1103/physrevlett.84.4112. Available from: http://dx.doi.org/10.1103/PhysRevLett.84.4112</li> </ul> <ul> <li>Kuhs 1998: KUHS, W. F., FINNEY, J. L., VETTIER, C. and BLISS, D. V., 1984, Structure and hydrogen ordering in ices VI, VII, and VIII by neutron powder diffraction. The Journal of Chemical Physics [online]. 15 October 1984. Vol.\u00a081, no.\u00a08, p.\u00a03612\u20133623. DOI\u00a010.1063/1.448109. Available from: http://dx.doi.org/10.1063/1.448109</li> </ul> <ul> <li>Liu 2019: LIU, Yuan, HUANG, Yingying, ZHU, Chongqin, LI, Hui, ZHAO, Jijun, WANG, Lu, OJAM\u00c4E, Lars, FRANCISCO, Joseph S. and ZENG, Xiao Cheng, 2019, An ultralow-density porous ice with the largest internal cavity identified in the water phase diagram. Proceedings of the National Academy of Sciences [online]. 10 June 2019. Vol.\u00a0116, no.\u00a026, p.\u00a012684\u201312691. DOI\u00a010.1073/pnas.1900739116. Available from: http://dx.doi.org/10.1073/pnas.1900739116</li> </ul> <ul> <li>Lei 2025: TAHERI, Bita, ZAKERHAMIDI, Mohammad Sadegh, SHAMKHALI, Amir Nasser, KIAN, Roshanak and SADEGHAN, Amir Amiri, 2025. Solvent polarity effect on photophysical properties of some aromatic azo dyes with focus on tautomeric and toxicity competition. Scientific Reports. Online. 5 May 2025. Vol.\u00a015, no.\u00a01. DOI\u00a010.1038/s41598-025-00001-w.</li> </ul> <ul> <li>Lobban 1998: LOBBAN, C., FINNEY, J. L. and KUHS, W. F., 1998, The structure of a new phase of ice. Nature [online]. January 1998. Vol.\u00a0391, no.\u00a06664, p.\u00a0268\u2013270. DOI\u00a010.1038/34622. Available from: http://dx.doi.org/10.1038/34622</li> </ul> <ul> <li>Londono 1988: LONDONO, D., KUHS, W. F. and FINNEY, J. L., 1988, Enclathration of helium in ice II: the first helium hydrate. Nature [online]. March 1988. Vol.\u00a0332, no.\u00a06160, p.\u00a0141\u2013142. DOI\u00a010.1038/332141a0. Available from: http://dx.doi.org/10.1038/332141a0</li> </ul> <ul> <li>Londono 1993: LONDONO, J. D., KUHS, W. F. and FINNEY, J. L., 1993, Neutron diffraction studies of ices III and IX on under\u2010pressure and recovered samples. The Journal of Chemical Physics [online]. 15 March 1993. Vol.\u00a098, no.\u00a06, p.\u00a04878\u20134888. DOI\u00a010.1063/1.464942. Available from: http://dx.doi.org/10.1063/1.464942</li> </ul> <ul> <li>Mahoney 2000: MAHONEY, Michael W. and JORGENSEN, William L., 2000. A five-site model for liquid water and the reproduction of the density anomaly by rigid, nonpolarizable potential functions. The Journal of Chemical Physics. Online. 22 May 2000. Vol.\u00a0112, no.\u00a020, p.\u00a08910\u20138922. DOI\u00a010.1063/1.481505.</li> </ul> <ul> <li>Matsui 2017: MATSUI, Takahiro, HIRATA, Masanori, YAGASAKI, Takuma, MATSUMOTO, Masakazu and TANAKA, Hideki, 2017, Communication: Hypothetical ultralow-density ice polymorphs. The Journal of Chemical Physics [online]. 7 September 2017. Vol.\u00a0147, no.\u00a09, p.\u00a0091101. DOI\u00a010.1063/1.4994757. Available from: http://dx.doi.org/10.1063/1.4994757</li> </ul> <ul> <li>Matsui 2019: MATSUI, Takahiro, YAGASAKI, Takuma, MATSUMOTO, Masakazu and TANAKA, Hideki, 2019, Phase diagram of ice polymorphs under negative pressure considering the limits of mechanical stability. The Journal of Chemical Physics [online]. 28 January 2019. Vol.\u00a0150, no.\u00a04, p.\u00a0041102. DOI\u00a010.1063/1.5083021. Available from: http://dx.doi.org/10.1063/1.5083021</li> </ul> <ul> <li>Matsumoto 2019: MATSUMOTO, Masakazu, YAGASAKI, Takuma and TANAKA, Hideki, 2019, A Bayesian approach for identification of ice Ih, ice Ic, high density, and low density liquid water with a torsional order parameter. The Journal of Chemical Physics [online]. 7 June 2019. Vol.\u00a0150, no.\u00a021, p.\u00a0214504. DOI\u00a010.1063/1.5096556. Available from: http://dx.doi.org/10.1063/1.5096556</li> </ul> <ul> <li>Matsumoto 2021: MATSUMOTO, Masakazu, YAGASAKI, Takuma and TANAKA, Hideki, 2021, Novel Algorithm to Generate Hydrogen-Disordered Ice Structures. Journal of Chemical Information and Modeling [online]. 24 May 2021. DOI\u00a010.1021/acs.jcim.1c00440. Available from: http://dx.doi.org/10.1021/acs.jcim.1c00440</li> </ul> <ul> <li>Maynard-Casely 2010: MAYNARD-CASELY, H. E., BULL, C. L., GUTHRIE, M., LOA, I., MCMAHON, M. I., GREGORYANZ, E., NELMES, R. J. and LOVEDAY, J. S., 2010, The distorted close-packed crystal structure of methane A. The Journal of Chemical Physics [online]. 14 August 2010. Vol.\u00a0133, no.\u00a06, p.\u00a0064504. DOI\u00a010.1063/1.3455889. Available from: http://dx.doi.org/10.1063/1.3455889</li> </ul> <ul> <li>Mochizuki 2014: MOCHIZUKI, Kenji, HIMOTO, Kazuhiro and MATSUMOTO, Masakazu, 2014, Diversity of transition pathways in the course of crystallization into ice VII. Phys. Chem. Chem. Phys. [online]. 2014. Vol.\u00a016, no.\u00a031, p.\u00a016419\u201316425. DOI\u00a010.1039/c4cp01616e. Available from: http://dx.doi.org/10.1039/c4cp01616e</li> </ul> <ul> <li>Mochizuki 2024: MOCHIZUKI, Kenji, 2024. Hydrogen Ordering in Ice Ih Facilitates the Transition from HDA to Ice XII. The Journal of Physical Chemistry C. Online. 16 October 2024. DOI\u00a010.1021/acs.jpcc.4c05371.</li> </ul> <ul> <li>Mousseau 2001: MOUSSEAU, Normand and BARKEMA, G.T., 2001, Fast bond-transposition algorithms for generating covalent amorphous structures. Current Opinion in Solid State and Materials Science [online]. December 2001. Vol.\u00a05, no.\u00a06, p.\u00a0497\u2013502. DOI\u00a010.1016/s1359-0286(02)00005-0. Available from: http://dx.doi.org/10.1016/S1359-0286(02)00005-0</li> </ul> <ul> <li>Nada 2003: Nada, Hiroki, and Jan P. J. M. van der Eerden. 2003. \u201cAn Intermolecular Potential Model for the Simulation of Ice and Water near the Melting Point: A Six-Site Model of H2O.\u201d The Journal of Chemical Physics 118 (16): 7401\u201313.</li> </ul> <ul> <li>Nakamura 2015: NAKAMURA, Tatsuya, MATSUMOTO, Masakazu, YAGASAKI, Takuma and TANAKA, Hideki, 2015, Thermodynamic Stability of Ice II and Its Hydrogen-Disordered Counterpart: Role of Zero-Point Energy. The Journal of Physical Chemistry B [online]. 3 December 2015. Vol.\u00a0120, no.\u00a08, p.\u00a01843\u20131848. DOI\u00a010.1021/acs.jpcb.5b09544. Available from: http://dx.doi.org/10.1021/acs.jpcb.5b09544</li> </ul> <ul> <li>Petrenko 1999: Petrenko and Whitworth, Physics of Ice, Table 11.2.</li> </ul> <ul> <li>Rosso 2016: DEL ROSSO, Leonardo, CELLI, Milva and ULIVI, Lorenzo, 2016, New porous water ice metastable at atmospheric pressure obtained by emptying a hydrogen-filled ice. Nature Communications [online]. 7 November 2016. Vol.\u00a07, no.\u00a01. DOI\u00a010.1038/ncomms13394. Available from: http://dx.doi.org/10.1038/ncomms13394</li> </ul> <ul> <li>Russo 2014: RUSSO, John, ROMANO, Flavio and TANAKA, Hajime, 2014, New metastable form of ice and its role in the homogeneous crystallization of water. Nature Materials [online]. 18 May 2014. Vol.\u00a013, no.\u00a07, p.\u00a0733\u2013739. DOI\u00a010.1038/nmat3977. Available from: http://dx.doi.org/10.1038/NMAT3977</li> </ul> <ul> <li>Salzmann 2006: SALZMANN, C. G., 2006, The Preparation and Structures of Hydrogen Ordered Phases of Ice. Science [online]. 24 March 2006. Vol.\u00a0311, no.\u00a05768, p.\u00a01758\u20131761. DOI\u00a010.1126/science.1123896. Available from: http://dx.doi.org/10.1126/science.1123896</li> </ul> <ul> <li>Sikiric 2010: DUTOUR SIKIRI\u0106, Mathieu, DELGADO-FRIEDRICHS, Olaf and DEZA, Michel, 2010, Space fullerenes: a computer search for new Frank\u2013Kasper structures. Acta Crystallographica Section A Foundations of Crystallography [online]. 5 August 2010. Vol.\u00a066, no.\u00a05, p.\u00a0602\u2013615. DOI\u00a010.1107/s0108767310022932. Available from: http://dx.doi.org/10.1107/S0108767310022932</li> </ul> <ul> <li>Smirnov 2013: SMIRNOV, Grigory S. and STEGAILOV, Vladimir V., 2013, Toward Determination of the New Hydrogen Hydrate Clathrate Structures. The Journal of Physical Chemistry Letters [online]. 9 October 2013. Vol.\u00a04, no.\u00a021, p.\u00a03560\u20133564. DOI\u00a010.1021/jz401669d. Available from: http://dx.doi.org/10.1021/jz401669d</li> </ul> <ul> <li>Stampfli 1986: Stampfli, P. A dodecagonal quasi-periodic lattice in 2 dimensions. Helv. Phys. Acta 59, 1260\u20131263 (1986).</li> </ul> <ul> <li>Strobel 2016: Strobel, Timothy A et al. \u201cHydrogen-Stuffed, Quartz-Like Water Ice.\u201d Journal of the American Chemical Society 138.42 (2016): 13786\u201313789.</li> </ul> <ul> <li>Svishchev 1996: SVISHCHEV, Igor M. and KUSALIK, Peter G., 1996. Quartzlike polymorph of ice. Physical Review B. Online. 1 April 1996. Vol.\u00a053, no.\u00a014, p.\u00a0R8815\u2013R8817. DOI\u00a010.1103/physrevb.53.r8815.</li> </ul> <ul> <li>Teeratchanan 2015: TEERATCHANAN, Pattanasak and HERMANN, Andreas, 2015, Computational phase diagrams of noble gas hydrates under pressure. The Journal of Chemical Physics [online]. 21 October 2015. Vol.\u00a0143, no.\u00a015, p.\u00a0154507. DOI\u00a010.1063/1.4933371. Available from: http://dx.doi.org/10.1063/1.4933371</li> </ul> <ul> <li>Vos 1993: VOS, Willem L., FINGER, Larry W., HEMLEY, Russell J. and MAO, Ho-kwang, 1993, NovelH2-H2O clathrates at high pressures. Physical Review Letters [online]. 8 November 1993. Vol.\u00a071, no.\u00a019, p.\u00a03150\u20133153. DOI\u00a010.1103/physrevlett.71.3150. Available from: http://dx.doi.org/10.1103/PhysRevLett.71.3150</li> </ul> <ul> <li>Weaire 1994: WEAIRE, D. and FHELAN, R., 1994. The structure of monodisperse foam. Philosophical Magazine Letters [online]. November 1994. Vol.\u00a070, no.\u00a05, p.\u00a0345\u2013350. DOI\u00a010.1080/09500839408240997. Available from: http://dx.doi.org/10.1080/09500839408240997</li> </ul> <ul> <li>Yagasaki 2018: YAGASAKI, Takuma, MATSUMOTO, Masakazu and TANAKA, Hideki, 2018, Phase Diagrams of TIP4P/2005, SPC/E, and TIP5P Water at High Pressure. The Journal of Physical Chemistry B [online]. 17 July 2018. Vol.\u00a0122, no.\u00a031, p.\u00a07718\u20137725. DOI\u00a010.1021/acs.jpcb.8b04441. Available from: http://dx.doi.org/10.1021/acs.jpcb.8b04441</li> </ul> <ul> <li>Zhao 2019: Zhao, C.-L. et al. Seven-Site Effective Pair Potential for Simulating Liquid Water. J. Phys. Chem. B 123, 4594-4603 (2019).</li> </ul>"},{"location":"unitcells/","title":"Unit cells","text":"<p>List of unit cell names (symbols) specified as the first argument. Structures with the same description are grouped on the same row.</p> Symbol Description References 0, ice0 Metastable ice \"0\". [Russo 2014] 11, XI, ice11 A candidate for an antiferroelectric Ice XI #19. [Jackson 1997, Fan 2010] 115_2_114, 12_1_11, 144_2_7301, 151_2_4949650, 153_2_155471, 176_2_5256, 207_1_4435, 2_2_623457, ACO, CS4, DDR, IWV, LTA, MAR, NON, PCOD8007225, PCOD8036144, PCOD8204698, PCOD8301974, PCOD8321499, PCOD8324623, SGT, SOD, engel01, engel03, engel04, engel17, engel20, engel23, engel24, engel26, engel29, engel30, engel31, engel34, sVII Hypothetical zeolitic ice [Jeffrey 1984, Kosyakov 1999, Engel 2018, IZA Database] 11alt A layered ferroelectric Ice XI. 12, XII, ice12 Metastable high-pressure ice XII. [Lobban 1998, Koza 2000] 13, XIII, ice13 Ice XIII, a hydrogen-ordered counterpart of ice V. [Salzmann 2006] 14, ice14 Ice XIV, a partially hydrogen-ordered counterpart of ice XII. Note that it does not reproduce the occupancies (probability of occupation) of the possible hydrogen sites. [Salzmann 2006] 16, CS2, MTN, XVI, ice16, sII Ultralow-density Ice XVI. [Jeffrey 1984, Kosyakov 1999, Sikiric 2010, Falenty 2014, IZA Database] 17, XVII, ice17 Ultralow-density Ice XVII. [Smirnov 2013, Rosso 2016, Strobel 2016] 1c, Ic, ice1c Cubic type of ice I. [Vos 1993] 1h, Ih, ice1h Most popular Ice I (hexagonal). NOTE: Due to a historical reason, the crystal axes of hexagonal ice are exchanged. If you want the basal plane to be Z axis, please use ice1h_unit instead. 1h_unit, ice1h_unit Most popular Ice I (hexagonal). 2, II, ice2 Hydrogen-ordered ice II. [Kamb 1964, Londono 1988, Kamb 2003] 2D3 Trilayer honeycomb ice. 2d, ice2d, ice2rect A hydrogen-disordered counterpart of ice II. [Nakamura 2015] 3, III, ice3 Ice III. [Petrenko 1999] 4, IV, ice4 Ice IV. [Avogadro] 5, V, ice5 Monoclinic ice V (testing). 5R Ice V with orthogonal unit cell. (testing) 6, VI, ice6 Conventional high-pressure ice VI. [Petrenko 1999] 6h Half lattice of ice VI. 7, VII, ice7 Conventional high-pressure ice VII. 8, VIII, ice8 Ice VIII, a hydrogen-ordered counterpart of ice VII. [Kuhs 1998] 9, IX, ice9 Ice IX, a hydrogen-ordered counterpart of ice III. [Londono 1993] A, iceA Hypothetical ice A. [Baez 1998] A15, Struct33 Cubic Structure I of clathrate hydrate. [Sikiric 2010] B, iceB Hypothetical ice B. [Baez 1998] BSV, engel05 Hypothetical zeolitic ice of the gyroid structure. [Engel 2018, IZA Database] C14, C15, C36, FK6layers, FK9layers, HS2, Hcomp, Struct01, Struct03, Struct04, Struct05, Struct06, Struct07, Struct08, Struct09, Struct10, Struct11, Struct12, Struct13, Struct14, Struct15, Struct16, Struct17, Struct18, Struct19, Struct20, Struct21, Struct22, Struct23, Struct24, Struct25, Struct26, Struct27, Struct28, Struct29, Struct30, Struct31, Struct32, Struct34, Struct35, Struct36, Struct37, Struct38, Struct39, Struct40, Struct41, Struct42, Struct43, Struct44, Struct45, Struct46, Struct47, Struct48, Struct49, Struct50, Struct51, Struct52, Struct53, Struct54, Struct55, Struct56, Struct57, Struct58, Struct59, Struct60, Struct61, Struct62, Struct63, Struct64, Struct65, Struct66, Struct67, Struct68, Struct69, Struct70, Struct71, Struct72, Struct73, Struct74, Struct75, Struct76, Struct77, Struct78, Struct79, Struct80, Struct81, Struct82, Struct83, Struct84, Z, delta, mu, psigma, sV, sigma, zra-d A space fullerene. [Sikiric 2010] CIF Load a CIF file and create a unit cell. CRN1, CRN2, CRN3 A continuous random network of Sillium. [Mousseau 2001] CS1, MEP, sI Clathrate hydrates sI. [Frank 1959, Jeffrey 1984, Kosyakov 1999, IZA Database] DOH, HS3, sH Clathrate type H. EMT Hypothetical ice with a large cavity. [Liu 2019, IZA Database] FAU Hypothetical ice at negative pressure ice 'sIV'. [Huang 2017, IZA Database] HS1, sIV Hydrogen-disordered ice Ih. [Frank 1959, Jeffrey 1984, Kosyakov 1999] M, iceM A hypothetical hydrogen-ordered high-density ice. [Mochizuki 2024] RHO Hypothetical ice at negative pressure ice 'sIII'. [Huang 2016, IZA Database] Struct02 A space fullerene. (I phase?) [Sikiric 2010] T Hypothetical clathrate type T. [Sikiric 2010, Karttunen 2011] XIc-a A candidate for the proton-ordered counterpart of ice Ic. The structure 'a' in Figure 1. [Geiger 2014] aeroice Aeroice (alias of xFAU). [Matsui 2017] c0te Filled ice C0 by Teeratchanan (Hydrogen-disordered.) (Positions of guests are supplied.) [Teeratchanan 2015] c1te Hydrogen-ordered hydrogen hydrate C1 by Teeratchanan. (Positions of guests are supplied.) [Teeratchanan 2015] eleven Ice XI w/ stacking faults. i Hypothetical ice \"i\". [Fennell 2005] iceL The hypothetical Ice L [Lei 2025] iceMd A hydrogen-disordered counterpart of ice M. [Mochizuki 2024] iceT Hypothetical ice T. [Hirata 2017] iceT2 Hypothetical ice T2. [Yagasaki 2018] one Ice I w/ stacking disorder. oprism Hydrogen-ordered ice nanotubes. [Koga 2001] sTprime Filled ice sT'. [Smirnov 2013] xFAU Aeroice xFAU. [Matsui 2017] xdtc A porous ice with cylindrical channels. [Matsumoto 2021] zeolite Load a zeolite framework from IZA by 3-letter code (CIF via download). [https://www.iza-structure.org/databases/] TS1, dtc, sIII (Undocumented)"},{"location":"unitcells/#unit-cell-plugins-with-sub-options","title":"Unit cell plugins (with sub-options)","text":"<p>The following unit cells require additional options (e.g. file path, IZA code).</p> <ul> <li>CLI: <code>--option value</code> (e.g. <code>genice3 CIF --file MEP.cif</code>)</li> <li>YAML: Under <code>unitcell:</code> set <code>name</code> and option keys (examples below).</li> <li>Run <code>genice3 SYMBOL?</code> to show plugin usage.</li> </ul>"},{"location":"unitcells/#cif","title":"CIF","text":"<p>Load a CIF file and create a unit cell.</p> <p>CLI:</p> <pre><code>genice3 CIF --file path/to/structure.cif (required) --osite O --hsite VALUE\n  --file: Path to CIF file.\n  --osite: O site label or regex.\n  --hsite: H site label or regex (omit to let GenIce3 place H).\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"CIF\", file='path/to/structure.cif', osite='O', hsite=None)\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: CIF\n  file: path/to/structure.cif\n  osite: O\n  hsite: ...\n</code></pre> CLI option Description <code>--file</code> Path to CIF file. <code>--osite</code> O site label or regex. <code>--hsite</code> H site label or regex (omit to let GenIce3 place H)."},{"location":"unitcells/#aeroice","title":"aeroice","text":"<p>Aeroice (alias of xFAU).</p> <p>CLI:</p> <pre><code>genice3 aeroice --length 3 (required)\n  --length: Number of hexagonal prism segments. 0=SOD, 1=FAU, 2+=aeroice.\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"aeroice\", length=3)\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: aeroice\n  length: 3\n</code></pre> CLI option Description <code>--length</code> Number of hexagonal prism segments. 0=SOD, 1=FAU, 2+=aeroice."},{"location":"unitcells/#eleven","title":"eleven","text":"<p>Ice XI w/ stacking faults.</p> <p>CLI:</p> <pre><code>genice3 eleven --layers ccchchc (required)\n  --layers: Stacking pattern. 'c'=cubic, 'h'=hexagonal (e.g. ccchchc).\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"eleven\", layers='ccchchc')\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: eleven\n  layers: ccchchc\n</code></pre> CLI option Description <code>--layers</code> Stacking pattern. 'c'=cubic, 'h'=hexagonal (e.g. ccchchc)."},{"location":"unitcells/#one","title":"one","text":"<p>Ice I w/ stacking disorder.</p> <p>CLI:</p> <pre><code>genice3 one --layers ccchchc (required)\n  --layers: Stacking pattern. 'c'=cubic, 'h'=hexagonal (e.g. ccchchc, hh, ccc).\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"one\", layers='ccchchc')\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: one\n  layers: ccchchc\n</code></pre> CLI option Description <code>--layers</code> Stacking pattern. 'c'=cubic, 'h'=hexagonal (e.g. ccchchc, hh, ccc)."},{"location":"unitcells/#oprism","title":"oprism","text":"<p>Hydrogen-ordered ice nanotubes.</p> <p>CLI:</p> <pre><code>genice3 oprism --sides 6 (required) --rows 10 (required)\n  --sides: Number of sides.\n  --rows: Number of rows (must be even).\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"oprism\", sides='6', rows='10')\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: oprism\n  sides: 6\n  rows: 10\n</code></pre> CLI option Description <code>--sides</code> Number of sides. <code>--rows</code> Number of rows (must be even)."},{"location":"unitcells/#xfau","title":"xFAU","text":"<p>Aeroice xFAU.</p> <p>CLI:</p> <pre><code>genice3 xFAU --length 3 (required)\n  --length: Number of hexagonal prism segments. 0=SOD, 1=FAU, 2+=aeroice.\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"xFAU\", length=3)\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: xFAU\n  length: 3\n</code></pre> CLI option Description <code>--length</code> Number of hexagonal prism segments. 0=SOD, 1=FAU, 2+=aeroice."},{"location":"unitcells/#zeolite","title":"zeolite","text":"<p>Load a zeolite framework from IZA by 3-letter code (CIF via download).</p> <p>CLI:</p> <pre><code>genice3 zeolite --code LTA (required) --osite O\n  --code: 3-letter IZA framework code (e.g. LTA, FAU).\n  --osite: O site label or regex.\n</code></pre> <p>API:</p> <pre><code>UnitCell(\"zeolite\", code='LTA', osite='O')\n</code></pre> <p>YAML:</p> <pre><code>unitcell:\n  name: zeolite\n  code: LTA\n  osite: O\n</code></pre> CLI option Description <code>--code</code> 3-letter IZA framework code (e.g. LTA, FAU). <code>--osite</code> O site label or regex. <p>Names in quotation marks have not been experimentally verified.</p> <p>You can add custom unit cells by placing unit-cell plugins in a <code>unitcell</code> directory. cif2ice can fetch CIF files from the IZA structure database and help you create a unitcell module.</p> <p>Note: Different naming conventions are used in the literature.</p> CH/FI CH ice FK Zeo Foam sI CS1 - A15 MEP Weaire-Phelan sII CS2 16 C15 MTN sIII TS1 - sigma - sIV HS1 - Z - sV HS2 - * - sVII CS4 - * SOD Kelvin sH HS3 - * DOH C0 - 17 * - C1 - 2 * - C2 - 1c * - <p>FI: Filled ices; CH: Clathrate hydrates; FK: Frank-Kasper duals; Zeo: Zeolites; Foam: foam crystals [Weaire 1994].</p> <p>-: No correspondence; *: Non-FK types.</p> <p>To request new unit cells, contact vitroid@gmail.com.</p>"},{"location":"water-models/","title":"Water models","text":"<p>Specify a water model with the <code>:water_model</code> suboption of exporter plugins.</p> symbol type References 3site, spce, tip3p A typical 3-site model. [Jorgensen 1983] 4site, tip4p A typical 4-site model. [Jorgensen 1983, Jorgensen 1985] 5site, tip5p A typical 5-site model. [Mahoney 2000] 6site, NvdE A 6-site water model. [Nada 2003] 7site A seven-site water model. [Zhao 2019] ice TIP4P/Ice water model. [Abascal 2005] physical_water Physical model of water; Oxygen atom is on the lattice point. [Jorgensen 1983] (Undocumented)"},{"location":"api/genice3/genice/","title":"Genice","text":"<pre><code>&lt;main class=\"pdoc\"&gt;\n        &lt;section class=\"module-info\"&gt;\n                &lt;h1 class=\"modulename\"&gt;\n</code></pre> <p>genice3.genice    </p> <pre><code>                    &lt;input id=\"mod-genice-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n\n                    &lt;label class=\"view-source-button\" for=\"mod-genice-view-source\"&gt;&lt;span&gt;View Source&lt;/span&gt;&lt;/label&gt;\n\n                    &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"L-1\"&gt;&lt;a href=\"#L-1\"&gt;&lt;span class=\"linenos\"&gt;   1&lt;/span&gt;&lt;/a&gt;&lt;span class=\"c1\"&gt;# Another plan of reactive GenIce3 (\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3088\u308b\u5b9f\u88c5).&lt;/span&gt;\n</code></pre> <p>   2    3from genice3 import ConfigurationError    4from genice3.group import Group    5from genice3.molecule import Molecule    6from genice3.plugin import UnitCell as UnitCellPlugin, safe_import    7from genice3.util import (    8 replicate_positions,    9 grandcell_wrap,   10 assume_tetrahedral_vectors,   11)   12from genice3.cage import CageSpecs, CageSpec   13from cif2ice import cellshape   14import genice_core   15import networkx as nx   16import numpy as np   17from dataclasses import dataclass   18from logging import getLogger   19from typing import Any, Dict, Generator, List, Tuple   20from enum import Enum   21import inspect   22   23from dependency_engine import DependencyEngine, get_reactive_tasks, reactive   24from genice3.unitcell import UnitCell   25   26   27def _graph_degree_stats(g: nx.Graph) -&gt; str:   28 \"\"\"\u30b0\u30e9\u30d5\u306e\u6b21\u6570\u5206\u5e03\uff080,1,2,3,4,&gt;4 \u306e\u30ce\u30fc\u30c9\u6570\u3068\u5272\u5408\uff09\u3092\u6587\u5b57\u5217\u3067\u8fd4\u3059\u3002\"\"\"   29 n = g.number_of_nodes()   30 if n == 0:   31 return \"nodes=0\"   32 deg = [g.degree(v) for v in g]   33 buckets = {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, \"&gt;4\": 0}   34 for d in deg:   35 if d &lt;= 4:   36 buckets[d] += 1   37 else:   38 buckets[\"&gt;4\"] += 1   39 parts = [f\"deg{k}:{c}({100c/n:.1f}%)\" for k, c in buckets.items() if c]   40 return f\"nodes={n} \" + \" \".join(parts)   41   42   43class ShowUsageError(Exception):   44 \"\"\"Usage\u8868\u793a\u3092\u8981\u6c42\u3059\u308b\u4f8b\u5916   45   46    Args:   47        flag_name: \u30d5\u30e9\u30b0\u540d\uff08\u4f8b: \"?\", \"help?\", \"cage?\"\uff09   48    \"\"\"   49   50 def init(self, flag_name: str, message: str = \"\"):   51 self.flag_name = flag_name   52 super().init(message or f\"Show usage for flag: {flag_name}\")   53   54   55# enum\u306e\u3088\u3046\u306a\u3082\u306e\u306f\u3069\u3046\u5b9a\u7fa9\u3059\u308b?   56class MoleculeType(Enum):   57 WATER = \"water\"   58 GUEST = \"guest\"   59 DOPANT = \"dopant\"   60 GROUP = \"group\"   61   62   63@dataclass   64class GuestSpec:   65 \"\"\"   66    \u30b2\u30b9\u30c8\u306e\u60c5\u5831\u3092\u8868\u3059\u30c7\u30fc\u30bf\u30af\u30e9\u30b9\u3002   67    \"\"\"   68   69 molecule: Molecule   70 occupancy: float   71   72 def repr(self) -&gt; str:   73 return (   74 f\"GuestSpec(molecule={self.molecule.name!r}, \"   75 f\"occupancy={self.occupancy:.3f})\"   76 )   77   78   79@dataclass   80class AtomicStructure:   81 \"\"\"   82    \u539f\u5b50\u69cb\u9020\u30c7\u30fc\u30bf\u3092\u7d71\u5408\u7684\u306b\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u30af\u30e9\u30b9\u3002   83    exporter\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002   84    \"\"\"   85   86 waters: Dict[int, Molecule]   87 guests: List[Molecule]   88 ions: Dict[int, Molecule]   89 cell: np.ndarray   90   91 def repr(self) -&gt; str:   92 return (   93 f\"AtomicStructure(n_waters={len(self.waters)}, \"   94 f\"n_guests={len(self.guests)}, \"   95 f\"n_ions={len(self.ions)}, \"   96 f\"cell_shape={self.cell.shape})\"   97 )   98   99  100def _assume_water_orientations(  101 coord: np.ndarray, digraph: nx.DiGraph, cellmat: np.ndarray, dopants: Dict[int, str]  102) -&gt; np.ndarray:  103 \"\"\"\u6709\u5411\u30b0\u30e9\u30d5\u3068\u5ea7\u6a19\u304b\u3089\u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\uff08Nx3x3\uff09\u3092\u8a08\u7b97\u3059\u308b\u3002  104  105    2\u672c\u306eOH\u304c\u4e00\u76f4\u7dda\u4e0a\u306b\u3042\u308b\u5834\u5408\u306f\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u306a\u3044\u3002  106  107    Args:  108        coord: \u5404\u30ce\u30fc\u30c9\u306e\u5206\u6570\u5ea7\u6a19\uff08Nx3\uff09\u3002  109        digraph: \u6c34\u7d20\u7d50\u5408\u306e\u5411\u304d\u304c\u6c7a\u307e\u3063\u305f\u6709\u5411\u30b0\u30e9\u30d5\u3002  110        cellmat: \u30bb\u30eb\u884c\u5217\uff08\u5206\u6570\u2192\u76f4\u4ea4\u5909\u63db\u306b\u4f7f\u7528\uff09\u3002  111        dopants: \u30c9\u30fc\u30d1\u30f3\u30c8\u304c\u5360\u3081\u308b\u30b5\u30a4\u30c8\uff08\u30ce\u30fc\u30c9\u756a\u53f7\u2192\u30a4\u30aa\u30f3\u540d\uff09\u3002  112  113    Returns:  114        \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\uff08Nx3x3\uff09\u3002\u76f4\u4ea4\u5ea7\u6a19\u7cfb\u3067\u306e\u56de\u8ee2\u884c\u5217\u3002  115    \"\"\"  116  117 logger = getLogger()  118 # just for a test of pure water  119 if len(coord) != digraph.number_of_nodes():  120 raise ValueError(  121 f\"coord length ({len(coord)}) must match digraph node count \"  122 f\"({digraph.number_of_nodes()})\"  123 )  124 if len(dopants):  125 logger.info(f\"  {dopants} dopants\")  126 # \u901a\u5e38\u306e\u6c37\u3067\u3042\u308c\u3070\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u9ad8\u901f\u5316\u3067\u304d\u308b\u3002  127  128 nnode = len(list(digraph))  129 neis = np.zeros([nnode, 2], dtype=int)  130  131 # \u4eee\u60f3\u30ce\u30fc\u30c9\u7528\u306e\u914d\u5217\u3002\u7b2c0\u8981\u7d20\u306f\u5b9f\u969b\u306b\u306f\u7b2cnnode\u8981\u7d20\u3092\u8868\u3059\u3002  132 extended_coord = []  133  134 celli = np.linalg.inv(cellmat)  135 # v0 = np.zeros([nnode, 3])  136 # v1 = np.zeros([nnode, 3])  137 for node in digraph:  138 if node in dopants:  139 h1 = np.array([0.0, 1, 1]) / (20.5)  140 h2 = np.array([0.0, -1, 1]) / (20.5)  141 r1 = h1 @ celli  142 r2 = h2 @ celli  143 # \u4eee\u60f3\u30ce\u30fc\u30c9\u306b\u3055\u3057\u304b\u3048\u308b  144 neis[node] = [nnode + len(extended_coord), nnode + len(extended_coord) + 1]  145 extended_coord += [coord[node] + r1, coord[node] + r2]  146 continue  147 succ = list(digraph.successors(node))  148 if len(succ) &lt; 2:  149 vsucc = (coord[succ] - coord[node]) @ cellmat  150 pred = list(digraph.predecessors(node))  151 vpred = (coord[pred] - coord[node]) @ cellmat  152 vsucc /= np.linalg.norm(vsucc, axis=1)[:, np.newaxis]  153 vpred /= np.linalg.norm(vpred, axis=1)[:, np.newaxis]  154 if len(vpred) &gt; 2:  155 # number of incoming bonds should be &lt;= 2  156 vpred = vpred[:2]  157 vcomp = assume_tetrahedral_vectors(np.vstack([vpred, vsucc]))  158 logger.debug(f\"Node {node} vcomp {vcomp} vsucc {vsucc} vpred {vpred}\")  159 vsucc = np.vstack([vsucc, vcomp])[:2]  160 rsucc = vsucc @ celli  161 # \u4eee\u60f3\u30ce\u30fc\u30c9\u306b\u3055\u3057\u304b\u3048\u308b  162 neis[node] = [nnode + len(extended_coord), nnode + len(extended_coord) + 1]  163 extended_coord += [coord[node] + rsucc[0], coord[node] + rsucc[1]]  164 else:  165 neis[node] = succ  166  167 if len(extended_coord) == 0:  168 extended_coord = coord  169 else:  170 extended_coord = np.vstack([coord, extended_coord])  171  172 # array of donating vectors  173 v0 = extended_coord[neis[:, 0]] - coord[:]  174 v0 -= np.floor(v0 + 0.5)  175 v0 = v0 @ cellmat  176 v0 /= np.linalg.norm(v0, axis=1)[:, np.newaxis]  177 v1 = extended_coord[neis[:, 1]] - coord[:]  178 v1 -= np.floor(v1 + 0.5)  179 v1 = v1 @ cellmat  180 v1 /= np.linalg.norm(v1, axis=1)[:, np.newaxis]  181 # intramolecular axes  182 y = v1 - v0  183 y /= np.linalg.norm(y, axis=1)[:, np.newaxis]  184 z = v0 + v1  185 z /= np.linalg.norm(z, axis=1)[:, np.newaxis]  186 x = np.cross(y, z, axisa=1, axisb=1)  187  188 rotmatrices = np.zeros([nnode, 3, 3])  189  190 rotmatrices[:, 0, :] = x  191 rotmatrices[:, 1, :] = y  192 rotmatrices[:, 2, :] = z  193 return rotmatrices  194  195  196def _replicate_lattice_node(  197 lattice_site_node: int, nmol: int, replication_matrix: np.ndarray  198) -&gt; Generator[int, None, None]:  199 \"\"\"1\u3064\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u8907\u88fd\u3057\u305f\u3068\u304d\u306e\u30ce\u30fc\u30c9\u756a\u53f7\u3092\u5217\u6319\u3059\u308b\u3002  200  201    Args:  202        lattice_site_node: \u8907\u88fd\u524d\u306e\u5358\u4f4d\u80de\u5185\u3067\u306e\u683c\u5b50\u30b5\u30a4\u30c8\uff08\u30ce\u30fc\u30c9\uff09\u756a\u53f7\u3002  203        nmol: \u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u6570\uff08\u30ce\u30fc\u30c9\u6570\uff09\u3002  204        replication_matrix: \u62e1\u5927\u500d\u7387\uff08\u884c\u5217\u5f0f\uff09\u306e\u8a08\u7b97\u306b\u7528\u3044\u308b3x3\u884c\u5217\u3002\u901a\u5e38\u306f replication_matrix \u3092\u6e21\u3059\u3002  205  206    Yields:  207        \u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e\u30ce\u30fc\u30c9\u756a\u53f7\uff08lattice_site_node + nmol * i for i in 0..\u500d\u7387-1\uff09\u3002  208    \"\"\"  209 multiple = int(np.floor(np.linalg.det(replication_matrix) + 0.5))  210 for i in range(multiple):  211 yield lattice_site_node + nmol i  212  213  214def _replicate_graph(  215 graph1: nx.Graph,  216 cell1frac_coords: np.ndarray,  217 replica_vectors: np.ndarray,  218 replica_vector_index: Dict[Tuple[int, ...], int],  219 reshape: np.ndarray,  220) -&gt; nx.Graph:  221 \"\"\"  222    \u6307\u5b9a\u3055\u308c\u305f\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u3068\u5f62\u72b6\u306b\u57fa\u3065\u3044\u3066\u30b0\u30e9\u30d5\u3092\u8907\u88fd\u3059\u308b\u3002  223  224    2\u3064\u306e\u5ea7\u6a19\u7cfb\u304c\u3044\u308a\u307f\u3060\u308c\u3066\u3044\u308b\u306e\u3067\u6ce8\u610f\u3002  225    cell1frac: \u8907\u88fd\u524d\u306e\u5358\u4f4d\u80de\u306b\u304a\u3051\u308b\u5c0f\u6570\u5ea7\u6a19  226    grandfrac: \u8907\u88fd\u5f8c\u306e\u5927\u304d\u306a\u5358\u4f4d\u80de\u306b\u304a\u3051\u308b\u5c0f\u6570\u5ea7\u6a19  227  228    Args:  229      graph1: \u5143\u306e\u30b0\u30e9\u30d5\u3002  230      cell1frac_coords: \u5143\u306e\u30b0\u30e9\u30d5\u5185\u306e\u7bc0\u70b9\u306e\u5206\u6570\u5ea7\u6a19 (Nx3)\u3002  231      replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\u3002  232      replica_vector_index: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb \u2192 \u4e00\u610f\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3002  233      reshape: \u62e1\u5927\u5358\u4f4d\u80de\u306e\u7a4d\u307f\u91cd\u306d\u65b9\u3092\u8868\u3059\u884c\u5217\u3002  234  235    Returns:  236      \u8907\u88fd\u3055\u308c\u305f\u7121\u5411\u30b0\u30e9\u30d5\u3002fixed \u306e\u8907\u88fd\u306f\u884c\u308f\u306a\u3044\u3002  237    \"\"\"  238 # repgraph = dg.IceGraph()  239 repgraph = nx.Graph()  240 nmol = cell1frac_coords.shape[0]  241  242 # \u6b63\u306e\u884c\u5217\u5f0f\u306e\u5024(\u500d\u7387)\u3002\u6574\u6570\u3002  243 det = np.linalg.det(reshape)  244 if det &lt; 0:  245 det = -det  246 det = np.floor(det + 0.5).astype(int)  247 # \u9006\u884c\u5217\u306b\u884c\u5217\u5f0f\u3092\u304b\u3051\u305f\u3082\u306e\u3002\u6574\u6570\u884c\u5217\u3002  248 invdet = np.floor(np.linalg.inv(reshape) det + 0.5).astype(int)  249  250 for i, j in graph1.edges(data=False):  251 # positions in the original small cell  252 cell1_delta = cell1frac_coords[j] - cell1frac_coords[i]  253 cell1_delta = np.floor(cell1_delta + 0.5).astype(int)  254  255 for a, cell1frac_a in enumerate(replica_vectors):  256 cell1frac_b = cell1frac_a + cell1_delta  257 cell1frac_b = np.floor(  258 grandcell_wrap(cell1frac_b, reshape, invdet, det)  259 ).astype(int)  260 b = replica_vector_index[tuple(cell1frac_b)]  261 newi = nmol b + i  262 newj = nmol a + j  263  264 repgraph.add_edge(newi, newj)  265  266 return repgraph  267  268  269def _replicate_fixed_edges(  270 repgraph: nx.Graph, fixed: nx.DiGraph, nmol: int  271) -&gt; nx.DiGraph:  272 \"\"\"\u5358\u4f4d\u80de\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u62e1\u5927\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\u4e0a\u306b\u8907\u88fd\u3057\u305f\u6709\u5411\u30b0\u30e9\u30d5\u3092\u8fd4\u3059\u3002  273  274    Args:  275        repgraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002  276        fixed: \u5358\u4f4d\u80de\u5185\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\uff08\u6709\u5411\u30b0\u30e9\u30d5\uff09\u3002  277        nmol: \u5358\u4f4d\u80de\u5185\u306e\u30ce\u30fc\u30c9\u6570\u3002  278  279    Returns:  280        \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8868\u3059\u6709\u5411\u30b0\u30e9\u30d5\u3002  281    \"\"\"  282 logger = getLogger(\"replicate_fixed_edges\")  283 rep_fixed_edges = nx.DiGraph()  284 for repi, repj in repgraph.edges():  285 i = repi % nmol  286 j = repj % nmol  287 if fixed.has_edge(i, j):  288 rep_fixed_edges.add_edge(repi, repj)  289 elif fixed.has_edge(j, i):  290 rep_fixed_edges.add_edge(repj, repi)  291 for edge in rep_fixed_edges.edges():  292 logger.debug(f\" {edge=}\")  293 return rep_fixed_edges  294  295  296def replicate_subgraph(  297 repgraph: nx.Graph, subgraph: nx.Graph, nmol: int  298) -&gt; Generator[nx.Graph, None, None]:  299 \"\"\"\u5358\u4f4d\u80de\u5185\u306e subgraph \u306e\u5404\u30ec\u30d7\u30ea\u30ab\u3092 repgraph \u304b\u3089\u53d6\u308a\u51fa\u3057\u3066 yield \u3059\u308b\u3002  300  301    Args:  302        repgraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002  303        subgraph: \u5358\u4f4d\u80de\u5185\u306e\u90e8\u5206\u30b0\u30e9\u30d5\uff08\u4f8b: 1\u30b1\u30fc\u30b8\u3092\u69cb\u6210\u3059\u308b\u30ce\u30fc\u30c9\u3068\u8fba\uff09\u3002  304        nmol: \u5358\u4f4d\u80de\u5185\u306e\u30ce\u30fc\u30c9\u6570\u3002  305  306    Yields:  307        \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u5404\u30ec\u30d7\u30ea\u30ab\u306b\u5bfe\u5fdc\u3059\u308b\u90e8\u5206\u30b0\u30e9\u30d5\uff08nx.Graph\uff09\u3002  308    \"\"\"  309 origin = list(subgraph.nodes())[0]  310 nrep = len(repgraph) // nmol # number of replicas  311  312 def _next(_reporigin):  313 for _repnei in nx.neighbors(repgraph, _reporigin):  314 _origin = _reporigin % nmol  315 _nei = _repnei % nmol  316 if _nei in nx.neighbors(subgraph, _origin) and not replica.has_edge(  317 _reporigin, _repnei  318 ):  319 replica.add_edge(_reporigin, _repnei)  320 _next(_repnei)  321  322 for rep in range(nrep):  323 reporigin = origin + nmol rep  324 replica = nx.Graph()  325 _next(reporigin)  326 yield replica  327  328  329# ============================================================================  330# DependencyEngine\u30bf\u30b9\u30af\u95a2\u6570\u5b9a\u7fa9: \u4f9d\u5b58\u95a2\u4fc2\u306f\u5f15\u6570\u540d\u304b\u3089\u81ea\u52d5\u63a8\u8ad6\u3055\u308c\u308b  331# \u5404\u95a2\u6570\u306b\u306f @reactive \u3092\u4ed8\u3051\u308b\u3002\u95a2\u6570\u540d\u304c\u305d\u306e\u307e\u307e genice.&lt;\u540d\u524d&gt; \u306b\u306a\u308b\u306e\u3067\u540d\u8a5e\u3067\u66f8\u304f\u3002  332# ============================================================================  333  334_genice3_logger = getLogger(\"GenIce3\")  335  336  337@reactive  338def cell(unitcell: UnitCell, replication_matrix: np.ndarray) -&gt; np.ndarray:  339 \"\"\"\u62e1\u5927\u5358\u4f4d\u80de\u306e\u30bb\u30eb\u884c\u5217\"\"\"  340 return unitcell.cell @ replication_matrix  341  342  343@reactive  344def replica_vectors(replication_matrix: np.ndarray) -&gt; np.ndarray:  345 \"\"\"\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u3092\u8a08\u7b97\u3059\u308b\u3002  346  347    \u62e1\u5927\u5358\u4f4d\u80de\u3092\u69cb\u6210\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u3001\u5143\u306e\u5358\u4f4d\u80de\u306e\u30b0\u30ea\u30c3\u30c9\u4f4d\u7f6e\u3092\u8868\u3059  348    \u6574\u6570\u30d9\u30af\u30c8\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u5404\u30d9\u30af\u30c8\u30eb\u306f\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e  349    \u5358\u4f4d\u80de\u306e\u76f8\u5bfe\u4f4d\u7f6e\u3092\u8868\u3057\u307e\u3059\u3002  350  351    Args:  352        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217  353  354    Returns:  355        np.ndarray: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\uff08Nx3\u914d\u5217\u3001N\u306f\u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u5358\u4f4d\u80de\u6570\uff09  356    \"\"\"  357 i, j, k = np.array(replication_matrix)  358 corners = np.array(  359 [a i + b j + c k for a in (0, 1) for b in (0, 1) for c in (0, 1)]  360 )  361  362 mins = np.min(corners, axis=0)  363 maxs = np.max(corners, axis=0)  364 _genice3_logger.debug(f\"  {mins=}, {maxs=}\")  365  366 det = abs(np.linalg.det(replication_matrix))  367 det = np.floor(det + 0.5).astype(int)  368 invdet = np.floor(np.linalg.inv(replication_matrix) det + 0.5).astype(int)  369  370 vecs = set()  371 for a in range(mins[0], maxs[0] + 1):  372 for b in range(mins[1], maxs[1] + 1):  373 for c in range(mins[2], maxs[2] + 1):  374 abc = np.array([a, b, c])  375 rep = grandcell_wrap(abc, replication_matrix, invdet, det).astype(int)  376 if tuple(rep) not in vecs:  377 vecs.add(tuple(rep))  378  379 vecs = np.array(list(vecs))  380 vol = abs(np.linalg.det(replication_matrix))  381 if not np.allclose(vol, len(vecs)):  382 raise ValueError(  383 f\"replication_matrix determinant ({vol}) must equal number of \"  384 f\"replica vectors ({len(vecs)})\"  385 )  386 return vecs  387  388  389@reactive  390def replica_vector_labels(replica_vectors: np.ndarray) -&gt; Dict[Tuple[int, ...], int]:  391 \"\"\"\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb \u2192 \u4e00\u610f\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002  392  393    \u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e\u5358\u4f4d\u80de\u306e\u4f4d\u7f6e\u3092\u3001\u30b0\u30e9\u30d5\u8907\u88fd\u306a\u3069\u3067\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3002  394  395    Args:  396        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\uff08Nx3\uff09\u3002  397  398    Returns:  399        \u5ea7\u6a19\u30bf\u30d7\u30eb (a, b, c) \u3092 0..N-1 \u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u8f9e\u66f8\u3002  400    \"\"\"  401 return {tuple(xyz): i for i, xyz in enumerate(replica_vectors)}  402  403  404@reactive  405def graph(  406 unitcell: UnitCell,  407 replica_vectors: np.ndarray,  408 replica_vector_labels: Dict[Tuple[int, ...], int],  409 replication_matrix: np.ndarray,  410) -&gt; nx.Graph:  411 \"\"\"\u62e1\u5927\u5358\u4f4d\u80de\u306b\u5bfe\u5fdc\u3059\u308b\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u3002  412  413    \u57fa\u672c\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\uff08\u6c34\u5206\u5b50\u9593\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u3092\u3001  414    \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u3066\u7d71\u5408\u3057\u305f\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3057\u307e\u3059\u3002  415    \u3053\u306e\u30b0\u30e9\u30d5\u306f\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u9593\u306e\u63a5\u7d9a\u95a2\u4fc2\u3092\u8868\u3057\u307e\u3059\u3002  416  417    Args:  418        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8  419        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217  420        replica_vector_labels: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb\u2192\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u8f9e\u66f8\uff08replica_vector_labels \u30bf\u30b9\u30af\u306e\u623b\u308a\u5024\uff09  421        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217  422  423    Returns:  424        nx.Graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u3059\u7121\u5411\u30b0\u30e9\u30d5  425    \"\"\"  426 g = _replicate_graph(  427 unitcell.graph,  428 unitcell.lattice_sites,  429 replica_vectors,  430 replica_vector_index=replica_vector_labels,  431 reshape=replication_matrix,  432 )  433 getLogger(name).info(\"graph: %s\", _graph_degree_stats(g))  434 return g  435  436  437@reactive  438def lattice_sites(  439 unitcell: UnitCell,  440 replica_vectors: np.ndarray,  441 replication_matrix: np.ndarray,  442) -&gt; np.ndarray:  443 \"\"\"\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002  444  445    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u307e\u3059\u3002  446    \u5404\u6c34\u5206\u5b50\u306e\u4f4d\u7f6e\u306f\u3001\u5358\u4f4d\u80de\u306e\u5468\u671f\u5883\u754c\u6761\u4ef6\u306b\u5f93\u3063\u3066\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002  447  448    Args:  449        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8  450        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217  451        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217  452  453    Returns:  454        np.ndarray: \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\uff08Nx3\u914d\u5217\u3001N\u306f\u6c34\u5206\u5b50\u6570\uff09  455    \"\"\"  456 return replicate_positions(  457 unitcell.lattice_sites, replica_vectors, replication_matrix  458 )  459  460  461@reactive  462def anions(  463 unitcell: UnitCell, replica_vectors: np.ndarray, spot_anions: Dict[int, str]  464) -&gt; Dict[int, str]:  465 \"\"\"\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u914d\u7f6e\u60c5\u5831\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002  466  467    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u3068\u3001spot_anions\u3067\u6307\u5b9a\u3055\u308c\u305f  468    \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u8fd4\u3057\u307e\u3059\u3002  469  470    Args:  471        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8  472        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217  473        spot_anions: \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u306e\u8f9e\u66f8\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09  474  475    Returns:  476        Dict[int, str]: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09  477    \"\"\"  478 anion_dict: Dict[int, str] = {}  479 Z = len(unitcell.lattice_sites)  480 for site_index, ion_name in unitcell.anions.items():  481 for i in range(len(replica_vectors)):  482 site = i Z + site_index  483 anion_dict[site] = ion_name  484 for site_index, ion_name in spot_anions.items():  485 anion_dict[site_index] = ion_name  486 return anion_dict  487  488  489@reactive  490def cations(  491 unitcell: UnitCell, replica_vectors: np.ndarray, spot_cations: Dict[int, str]  492) -&gt; Dict[int, str]:  493 \"\"\"\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u914d\u7f6e\u60c5\u5831\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002  494  495    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u3068\u3001spot_cations\u3067\u6307\u5b9a\u3055\u308c\u305f  496    \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u8fd4\u3057\u307e\u3059\u3002  497  498    Args:  499        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8  500        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217  501        spot_cations: \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u306e\u8f9e\u66f8\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09  502  503    Returns:  504        Dict[int, str]: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09  505    \"\"\"  506 cation_dict: Dict[int, str] = {}  507 Z = len(unitcell.lattice_sites)  508 for site_index, ion_name in unitcell.cations.items():  509 for i in range(len(replica_vectors)):  510 site = i Z + site_index  511 cation_dict[site] = ion_name  512 for site_index, ion_name in spot_cations.items():  513 cation_dict[site_index] = ion_name  514 return cation_dict  515  516  517@reactive  518def site_occupants(  519 anions: Dict[int, str],  520 cations: Dict[int, str],  521 spot_hydroniums: List[int],  522 spot_hydroxides: List[int],  523 lattice_sites: np.ndarray,  524) -&gt; List[str]:  525 \"\"\"\u5404\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u5360\u6709\u7a2e\uff08\u6c34\u5206\u5b50\u30fb\u30a4\u30aa\u30f3\u30fbH3O+\u30fbOH-\uff09\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002  526  527    \u5404\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u5206\u5b50\u3001\u30a2\u30cb\u30aa\u30f3\u3001\u30ab\u30c1\u30aa\u30f3\u3001H3O+\u3001OH- \u306e\u3044\u305a\u308c\u3067\u5360\u6709\u3055\u308c\u3066\u3044\u308b\u304b\u3092  528    \u5224\u5b9a\u3057\u3001\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u9806\u306b\u30ea\u30b9\u30c8\u3068\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002  529  530    Args:  531        anions: \u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8  532        cations: \u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8  533        spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8  534        spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8  535        lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217  536  537    Returns:  538        List[str]: \u5404\u30b5\u30a4\u30c8\u306e\u5360\u6709\u7a2e\u306e\u30ea\u30b9\u30c8\uff08\"water\" \u307e\u305f\u306f\u30a4\u30aa\u30f3\u540d\uff09  539    \"\"\"  540 occupants = [\"water\"] len(lattice_sites)  541 for site, ion_name in anions.items():  542 occupants[site] = ion_name  543 for site, ion_name in cations.items():  544 occupants[site] = ion_name  545 for site in spot_hydroniums:  546 occupants[site] = \"H3O+\"  547 for site in spot_hydroxides:  548 occupants[site] = \"OH-\"  549 return occupants  550  551  552@reactive  553def fixed_edges(  554 graph: nx.Graph,  555 unitcell: UnitCell,  556 spot_anions: Dict[int, str],  557 spot_cations: Dict[int, str],  558 spot_hydroniums: List[int],  559 spot_hydroxides: List[int],  560 bjerrum_L_edges: List[Tuple[int, int]],  561 bjerrum_D_edges: List[Tuple[int, int]],  562) -&gt; nx.DiGraph:  563 \"\"\"\u56fa\u5b9a\u30a8\u30c3\u30b8\uff08\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u56fa\u5b9a\u3055\u308c\u305f\u30a8\u30c3\u30b8\uff09\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002  564  565    \u57fa\u672c\u5358\u4f4d\u80de\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u56fa\u5b9a\u30a8\u30c3\u30b8\u3068\u3001spot_anions/spot_cations/spot_hydroniums/  566    spot_hydroxides \u3067\u6307\u5b9a\u3055\u308c\u305f\u30a4\u30aa\u30f3\u30fb\u7f6e\u63db\u7a2e\u306b\u57fa\u3065\u304f\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u7d71\u5408\u3057\u3001  567    \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8fd4\u3057\u307e\u3059\u3002  568    - \u30a2\u30cb\u30aa\u30f3: 4\u672c\u53d7\u3051\u5165\u308c\u3002\u30ab\u30c1\u30aa\u30f3: 4\u672c\u4f9b\u4e0e\u3002  569    - H3O+ (spot_hydroniums): 1\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002  570    - OH- (spot_hydroxides): 3\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002  571  572    Args:  573        graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u30b0\u30e9\u30d5  574        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8  575        spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e  576        spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e  577        spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff081\u53d7\u5bb9\u30fb3\u4f9b\u4e0e\uff09  578        spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff083\u53d7\u5bb9\u30fb1\u4f9b\u4e0e\uff09  579  580    Returns:  581        nx.DiGraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8868\u3059\u6709\u5411\u30b0\u30e9\u30d5  582    \"\"\"  583 if (  584 spot_anions  585 or spot_cations  586 or spot_hydroniums  587 or spot_hydroxides  588 or bjerrum_L_edges  589 or bjerrum_D_edges  590 ) and not unitcell.SUPPORTS_ION_DOPING:  591 raise ConfigurationError(  592 \"Ion doping (spot_anion/spot_cation/spot_hydronium/spot_hydroxide) \"  593 \"is not supported for hydrogen-ordered ices.\"  594 )  595 dg = _replicate_fixed_edges(graph, unitcell.fixed, len(unitcell.lattice_sites))  596 for site_index in spot_anions:  597 for nei in graph.neighbors(site_index):  598 if dg.has_edge(site_index, nei):  599 raise ConfigurationError(  600 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {site_index}; \u3059\u3067\u306b({site_index} --&gt; {nei})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\"  601 )  602 else:  603 dg.add_edge(nei, site_index)  604 for site_index in spot_cations:  605 for nei in graph.neighbors(site_index):  606 if dg.has_edge(nei, site_index):  607 raise ConfigurationError(  608 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {site_index}; \u3059\u3067\u306b({nei} --&gt; {site_index})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\"  609 )  610 else:  611 dg.add_edge(site_index, nei)  612 for site_index in spot_hydroniums:  613 neis = sorted(graph.neighbors(site_index))  614 if len(neis) != 4:  615 raise ConfigurationError(  616 f\"spot_hydronium at {site_index} must have 4 neighbors, got {len(neis)}.\"  617 )  618 dg.add_edge(neis[0], site_index)  619 for nei in neis[1:]:  620 dg.add_edge(site_index, nei)  621 for site_index in spot_hydroxides:  622 neis = sorted(graph.neighbors(site_index))  623 if len(neis) != 4:  624 raise ConfigurationError(  625 f\"spot_hydroxide at {site_index} must have 4 neighbors, got {len(neis)}.\"  626 )  627 dg.add_edge(site_index, neis[0])  628 for nei in neis[1:]:  629 dg.add_edge(nei, site_index)  630 # Bjerrum L \u6b20\u9665: i \u30ce\u30fc\u30c9\u3092 hydronium \u3068\u540c\u69d8\u306b\u6271\u3046\u3002  631 for i, j in bjerrum_L_edges or []:  632 neis = sorted(graph.neighbors(i))  633 if len(neis) != 4:  634 raise ConfigurationError(  635 f\"bjerrum_L at {i} must have 4 neighbors, got {len(neis)}.\"  636 )  637 if j not in neis:  638 raise ConfigurationError(  639 f\"bjerrum_L edge ({i}, {j}) is not an edge in the graph.\"  640 )  641 # \u53d7\u5bb9\u5074\u3068\u306a\u308b\u96a3\u63a5\u30ce\u30fc\u30c9\u3092 j \u4ee5\u5916\u304b\u3089 1 \u3064\u9078\u3076  642 acceptor = next((nei for nei in neis if nei != j), None)  643 if acceptor is None:  644 raise ConfigurationError(  645 f\"bjerrum_L at {i} cannot choose acceptor neighbor distinct from {j}.\"  646 )  647 # hydronium \u3068\u540c\u69d8\u306e\u30c1\u30a7\u30c3\u30af\u30fb\u8ffd\u52a0\u30ed\u30b8\u30c3\u30af  648 for nei in neis:  649 if nei == acceptor:  650 # nei -&gt; i \uff08\u53d7\u5bb9\uff09  651 if dg.has_edge(i, nei):  652 raise ConfigurationError(  653 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({i} --&gt; {nei})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\"  654 )  655 dg.add_edge(nei, i)  656 else:  657 # i -&gt; nei \uff08\u4f9b\u4e0e\uff09  658 if dg.has_edge(nei, i):  659 raise ConfigurationError(  660 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({nei} --&gt; {i})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\"  661 )  662 dg.add_edge(i, nei)  663 # Bjerrum D \u6b20\u9665: i \u30ce\u30fc\u30c9\u3092 hydroxide \u3068\u540c\u69d8\u306b\u6271\u3046\uff08\u305f\u3060\u3057 j \u306f\u4f9b\u4e0e\u5074\u306b\u3057\u306a\u3044\uff09\u3002  664 for i, j in bjerrum_D_edges or []:  665 neis = sorted(graph.neighbors(i))  666 if len(neis) != 4:  667 raise ConfigurationError(  668 f\"bjerrum_D at {i} must have 4 neighbors, got {len(neis)}.\"  669 )  670 if j not in neis:  671 raise ConfigurationError(  672 f\"bjerrum_D edge ({i}, {j}) is not an edge in the graph.\"  673 )  674 # \u4f9b\u4e0e\u5074\u3068\u306a\u308b\u96a3\u63a5\u30ce\u30fc\u30c9\u3092 j \u4ee5\u5916\u304b\u3089 1 \u3064\u9078\u3076  675 donor = next((nei for nei in neis if nei != j), None)  676 if donor is None:  677 raise ConfigurationError(  678 f\"bjerrum_D at {i} cannot choose donor neighbor distinct from {j}.\"  679 )  680 for nei in neis:  681 if nei == donor:  682 # i -&gt; nei \uff08\u4f9b\u4e0e\uff09  683 if dg.has_edge(nei, i):  684 raise ConfigurationError(  685 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({nei} --&gt; {i})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\"  686 )  687 dg.add_edge(i, nei)  688 else:  689 # nei -&gt; i \uff08\u53d7\u5bb9\uff09  690 if dg.has_edge(i, nei):  691 raise ConfigurationError(  692 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({i} --&gt; {nei})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\"  693 )  694 dg.add_edge(nei, i)  695 return dg  696  697  698@reactive  699def digraph(  700 graph: nx.Graph,  701 depol_loop: int,  702 lattice_sites: np.ndarray,  703 fixed_edges: nx.DiGraph,  704 target_pol: np.ndarray,  705 bjerrum_L_edges: List[Tuple[int, int]],  706 bjerrum_D_edges: List[Tuple[int, int]],  707) -&gt; nx.DiGraph:  708 \"\"\"\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u3002  709  710    \u7121\u5411\u30b0\u30e9\u30d5\uff08\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u304b\u3089\u3001\u5404\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\uff08\u30d7\u30ed\u30c8\u30f3\u306e\u5411\u304d\uff09  711    \u3092\u6c7a\u5b9a\u3057\u3066\u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u56fa\u5b9a\u30a8\u30c3\u30b8\u3067\u6307\u5b9a\u3055\u308c\u305f\u65b9\u5411\u306f\u7dad\u6301\u3055\u308c\u3001  712    \u305d\u308c\u4ee5\u5916\u306e\u30a8\u30c3\u30b8\u306f\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3088\u308a\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002  713  714    Args:  715        graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5  716        depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570  717        lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217  718        fixed_edges: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u306e\u6709\u5411\u30b0\u30e9\u30d5  719        target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024  720  721    Returns:  722        nx.DiGraph: \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5  723    \"\"\"  724 for edge in fixed_edges.edges():  725 _genice3_logger.debug(f\"+ {edge=}\")  726 dg = genice_core.ice_graph(  727 graph,  728 vertex_positions=lattice_sites,  729 is_periodic_boundary=True,  730 dipole_optimization_cycles=depol_loop,  731 fixed_edges=fixed_edges,  732 pairing_attempts=1000,  733 target_pol=target_pol,  734 )  735 if not dg:  736 raise ConfigurationError(\"Failed to generate a directed graph.\")  737 # Bjerrum L \u6b20\u9665: \u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u3092\u524a\u9664\u3059\u308b\uff08\u4e21\u65b9\u5411\u3068\u3082\u53d6\u308a\u9664\u304f\uff09  738 for edge in bjerrum_L_edges or []:  739 i, j = edge  740 if dg.has_edge(i, j):  741 dg.remove_edge(i, j)  742 if dg.has_edge(j, i):  743 dg.remove_edge(j, i)  744 # Bjerrum D \u6b20\u9665: \u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u3092\u4e21\u65b9\u5411\u3068\u3082\u5b58\u5728\u3055\u305b\u308b  745 for edge in bjerrum_D_edges or []:  746 i, j = edge  747 if not dg.has_edge(i, j):  748 dg.add_edge(i, j)  749 if not dg.has_edge(j, i):  750 dg.add_edge(j, i)  751 return dg  752  753  754@reactive  755def orientations(  756 lattice_sites: np.ndarray,  757 digraph: nx.DiGraph,  758 cell: np.ndarray,  759 anions: Dict[int, str],  760 cations: Dict[int, str],  761 spot_hydroniums: List[int],  762 spot_hydroxides: List[int],  763) -&gt; np.ndarray:  764 \"\"\"\u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\u3092\u8a08\u7b97\u3059\u308b\u3002  765  766    \u6709\u5411\u30b0\u30e9\u30d5\u3067\u6c7a\u5b9a\u3055\u308c\u305f\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u306b\u57fa\u3065\u3044\u3066\u3001\u5404\u6c34\u5206\u5b50\u306e  767    \u914d\u5411\uff08\u56de\u8ee2\u884c\u5217\uff09\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u6c34\u5206\u5b50\u306eOH\u30d9\u30af\u30c8\u30eb\u306e\u65b9\u5411\u304b\u3089  768    \u5206\u5b50\u5168\u4f53\u306e\u914d\u5411\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002  769  770    Args:  771        lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217  772        digraph: \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5  773        cell: \u62e1\u5927\u5358\u4f4d\u80de\u306e\u30bb\u30eb\u884c\u5217  774        anions: \u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8  775        cations: \u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8  776        spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8  777        spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8  778  779    Returns:  780        np.ndarray: \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\uff08Nx3x3\u914d\u5217\u3001N\u306f\u6c34\u5206\u5b50\u6570\uff09  781    \"\"\"  782 return _assume_water_orientations(  783 lattice_sites,  784 digraph,  785 cell,  786 set(anions) | set(cations) | set(spot_hydroniums) | set(spot_hydroxides),  787 )  788  789  790@reactive  791def cages(  792 unitcell: UnitCell,  793 replica_vectors: np.ndarray,  794 replication_matrix: np.ndarray,  795 graph: nx.Graph,  796) -&gt; CageSpecs | None:  797 \"\"\"\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002  798  799    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b2\u30b9\u30c8\u5206\u5b50\u3092\u914d\u7f6e\u3059\u308b\u305f\u3081\u306e\u30b1\u30fc\u30b8\uff08\u7a7a\u9699\uff09\u306e  800    \u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3092\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002  801  802    Args:  803        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002  804        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\u3002  805        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002  806        graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\uff08\u30b5\u30d6\u30b0\u30e9\u30d5\u8907\u88fd\u306b\u4f7f\u7528\uff09\u3002  807  808    Returns:  809        CageSpecs: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3002  810        unitcell.cages \u304c None \u306e\u5834\u5408\u306f None\u3002  811    \"\"\"  812 if unitcell.cages is None:  813 return None  814 # \u30b1\u30fc\u30b8\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\uff08\u7a7a\u306e\u914d\u5217\uff09\u306e\u51e6\u7406  815 if len(unitcell.cages.positions) == 0:  816 return CageSpecs(positions=np.array([]).reshape(0, 3), specs=[])  817 repcagepos = replicate_positions(  818 unitcell.cages.positions, replica_vectors, replication_matrix  819 )  820 num_cages_in_unitcell = len(unitcell.cages.positions)  821  822 # replicate_subgraph\u306f\u30b1\u30fc\u30b8\u4e00\u500b\u305a\u3064\u3092replicate\u3059\u308b\u304c\u3001repcagespecs\u306e\u4e26\u3073\u9806\u306f\u5358\u4f4d\u80de\u5358\u4f4d\u3002  823 repcagespecs = [None] len(repcagepos)  824 for i, cage in enumerate(unitcell.cages.specs):  825 for j, repgraph in enumerate(  826 replicate_subgraph(graph, cage.graph, unitcell.lattice_sites.shape[0])  827 ):  828 repcagespecs[i + j num_cages_in_unitcell] = CageSpec(  829 cage_type=cage.cage_type, faces=cage.faces, graph=repgraph  830 )  831 # unit cell\u306ecages\u3068\u540c\u3058\u69cb\u9020\u3002  832 _genice3_logger.debug(f\"{repcagepos=}, {repcagespecs=}\")  833 return CageSpecs(positions=repcagepos, specs=repcagespecs)  834  835  836def place_groups_on_lattice(  837 genice: \"GenIce3\",  838 spot_cation_groups: Dict[int, Dict[int, str]],  839) -&gt; None:  840 \"\"\"  841    \u683c\u5b50\u70b9\u306b group \u3092\u914d\u7f6e\u3059\u308b\u3002  842  843    Args:  844        genice: GenIce3 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9  845        spot_cation_groups: \u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d} \u306e\u8f9e\u66f8  846    \"\"\"  847 _genice3_logger.info(  848 f\"place_groups_on_lattice: dummy implementation (group assignment not yet applied) {spot_cation_groups=}\"  849 )  850  851  852def log_spot_cation_cages(genice: \"GenIce3\") -&gt; None:  853 \"\"\"spot_cation \u3054\u3068\u306b\u5c5e\u3059\u308b\u30b1\u30fc\u30b8\u306eID\u30fbcage_type\u30fbfaces\u3092\u30ed\u30b0\u8868\u793a\u3059\u308b\u3002\"\"\"  854 if not genice.spot_cations or genice.cages is None or len(genice.cages.specs) == 0:  855 return  856 num_replicas = int(np.round(np.linalg.det(genice.replication_matrix)))  857 num_cages_in_unitcell = len(genice.cages.specs) // max(1, num_replicas)  858 for site, ion_name in genice.spot_cations.items():  859 cage_indices = genice.cages.node_to_cage_indices.get(site, [])  860 for cage_id in cage_indices:  861 spec = genice.cages.specs[cage_id]  862 genice.logger.info(  863 f\"spot_cation {site}={ion_name} belongs to cage {cage_id} ({spec.cage_type} {spec.faces}) in the supercell.\"  864 )  865  866  867def log_cation_cages(genice: \"GenIce3\") -&gt; None:  868 \"\"\"\u5358\u4f4d\u80de\u5185\u306e\u30ab\u30c1\u30aa\u30f3\u3054\u3068\u306b\u3001\u5c5e\u3059\u308b\u30b1\u30fc\u30b8\u306eID\u30fbcage_type\u30fbfaces \u3092\u30ed\u30b0\u8868\u793a\u3059\u308b\u3002\"\"\"  869 if (  870 not genice.cations  871 or genice.unitcell.cages is None  872 or len(genice.unitcell.cages.specs) == 0  873 ):  874 return  875 for site, ion_name in genice.cations.items():  876 cage_indices = genice.unitcell.cages.node_to_cage_indices.get(site, [])  877 for cage_id in cage_indices:  878 spec = genice.unitcell.cages.specs[cage_id]  879 genice.logger.info(  880 f\"cation {site}={ion_name} belongs to cage {cage_id} ({spec.cage_type} {spec.faces}) in the unit cell.\"  881 )  882  883  884def place_group(direction: np.ndarray, bondlen: float, group_name: str) -&gt; Group:  885 \"\"\"\u6307\u5b9a\u65b9\u5411\u30fb\u7d50\u5408\u9577\u3067 group \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307f\u3001\u914d\u7f6e\u3057\u305f Group \u3092\u8fd4\u3059\u3002  886  887    \u7f6e\u63db\u30a4\u30aa\u30f3\u304b\u3089 group \u306e\u30a2\u30f3\u30ab\u30fc\u539f\u5b50\u307e\u3067\u304c direction \u65b9\u5411\u306b bondlen \u306e\u9577\u3055\u3067\u4e26\u3076\u3002  888    TODO: \u5c06\u6765\u306f2\u500b\u4ee5\u4e0a\u306e\u30a2\u30f3\u30ab\u30fc\u3092\u6301\u3064 group \u3092\u6271\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002  889  890    Args:  891        direction: \u914d\u7f6e\u65b9\u5411\uff08\u76f4\u4ea4\u5ea7\u6a19\u3001\u6b63\u898f\u5316\u3055\u308c\u308b\uff09\u3002  892        bondlen: \u30a2\u30f3\u30ab\u30fc\u307e\u3067\u306e\u7d50\u5408\u9577\u3002  893        group_name: group \u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonia\"\uff09\u3002  894  895    Returns:  896        \u56de\u8ee2\u30fb\u4e26\u9032\u3092\u9069\u7528\u3057\u305f Group \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3002  897    \"\"\"  898 # logger = getLogger(\"GenIce3\")  899 group = safe_import(\"group\", group_name).Group()  900 # logger.info(f\"{group_name=} {group=}\")  901 direction /= np.linalg.norm(direction)  902 offset = direction bondlen  903 # Z\u8ef8\u3092direction\u65b9\u5411\u306b\u50be\u3051\u308b\u884c\u5217  904 ex, ey, ez = direction  905 r = (ex2 + ey2) 0.5  906 Ry = np.array([[ez, 0, -r], [0, 1, 0], [r, 0, ez]])  907 Rz = np.array([[ex / r, ey / r, 0], [-ey / r, ex / r, 0], [0, 0, 1]])  908 rotmat = Ry @ Rz  909 sites = group.sites @ rotmat + offset  910 return Group(  911 sites=sites,  912 labels=group.labels,  913 bonds=group.bonds,  914 name=group.name,  915 )  916  917  918# ============================================================================  919# GenIce3\u30af\u30e9\u30b9: DependencyEngine\u3092\u30e9\u30c3\u30d7  920# ============================================================================  921  922  923class GenIce3:  924 \"\"\"GenIce3\u306e\u30e1\u30a4\u30f3\u30af\u30e9\u30b9\uff1a\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3088\u308b\u6c37\u69cb\u9020\u751f\u6210\u30b7\u30b9\u30c6\u30e0  925  926    GenIce3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u30a8\u30f3\u30b8\u30f3\uff08DependencyEngine\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u5fc5\u8981\u306a\u6642\u306b  927    \u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u306f  928    \u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3060\u3051\u3067\u3001\u305d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e  929    \u8a08\u7b97\u304c\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002  930  931    \u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u4ed5\u7d44\u307f:  932        - \u5404\u30d7\u30ed\u30d1\u30c6\u30a3\uff08digraph, graph, lattice_sites\u306a\u3069\uff09\u306f\u3001\u30a2\u30af\u30bb\u30b9\u6642\u306b  933          \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u307e\u3059  934        - \u4f9d\u5b58\u95a2\u4fc2\u306f\u95a2\u6570\u306e\u5f15\u6570\u540d\u304b\u3089\u81ea\u52d5\u7684\u306b\u63a8\u8ad6\u3055\u308c\u307e\u3059  935        - \u4e00\u5ea6\u8a08\u7b97\u3055\u308c\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3001\u4f9d\u5b58\u3059\u308b\u5165\u529b\u304c\u5909\u66f4\u3055\u308c\u308b\u307e\u3067  936          \u518d\u5229\u7528\u3055\u308c\u307e\u3059  937        - \u5165\u529b\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell, replication_matrix, depol_loop\u306a\u3069\uff09\u304c  938          \u5909\u66f4\u3055\u308c\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b  939          \u30af\u30ea\u30a2\u3055\u308c\u307e\u3059  940  941    \u4f7f\u7528\u4f8b:  942        &gt;&gt;&gt; genice = GenIce3(unitcell=my_unitcell)  943        &gt;&gt;&gt; digraph = genice.digraph  # \u81ea\u52d5\u7684\u306b\u5fc5\u8981\u306a\u8a08\u7b97\u304c\u5b9f\u884c\u3055\u308c\u308b  944        &gt;&gt;&gt; orientations = genice.orientations  # digraph\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081\u3001digraph\u304c\u5148\u306b\u8a08\u7b97\u3055\u308c\u308b  945  946    Attributes:  947        digraph (nx.DiGraph): \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5\u3002  948            \u7121\u5411\u30b0\u30e9\u30d5\u304b\u3089\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3088\u308a\u5404\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u3092\u6c7a\u5b9a\u3057\u305f  949            \u6709\u5411\u30b0\u30e9\u30d5\u3067\u3059\u3002\u56fa\u5b9a\u30a8\u30c3\u30b8\u3067\u6307\u5b9a\u3055\u308c\u305f\u65b9\u5411\u306f\u7dad\u6301\u3055\u308c\u3001\u305d\u308c\u4ee5\u5916\u306e\u30a8\u30c3\u30b8\u306f  950            \u6700\u9069\u5316\u306b\u3088\u308a\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2  951            \uff08graph, lattice_sites, fixed_edges \u306a\u3069\uff09\u304c\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u307e\u3059\u3002  952  953        graph (nx.Graph): \u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002  954            \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u6c34\u5206\u5b50\u9593\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u3059\u7121\u5411\u30b0\u30e9\u30d5\u3067\u3059\u3002  955            \u57fa\u672c\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u3066\u7d71\u5408\u3057\u305f\u3082\u306e\u3067\u3059\u3002  956  957        lattice_sites (np.ndarray): \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217\u3002  958            \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u8868\u3059Nx3\u914d\u5217\u3067\u3059\uff08N\u306f\u6c34\u5206\u5b50\u6570\uff09\u3002  959            \u57fa\u672c\u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u3001\u5358\u4f4d\u80de\u306e\u5468\u671f\u5883\u754c\u6761\u4ef6\u306b\u5f93\u3063\u3066\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b  960            \u8907\u88fd\u3057\u305f\u3082\u306e\u3067\u3059\u3002  961  962        orientations (np.ndarray): \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\u3002  963            \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\uff08\u56de\u8ee2\u884c\u5217\uff09\u3092\u8868\u3059Nx3x3\u914d\u5217\u3067\u3059\uff08N\u306f\u6c34\u5206\u5b50\u6570\uff09\u3002  964            \u6709\u5411\u30b0\u30e9\u30d5\u3067\u6c7a\u5b9a\u3055\u308c\u305f\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u306b\u57fa\u3065\u3044\u3066\u3001\u5404\u6c34\u5206\u5b50\u306eOH\u30d9\u30af\u30c8\u30eb\u306e  965            \u65b9\u5411\u304b\u3089\u5206\u5b50\u5168\u4f53\u306e\u914d\u5411\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002  966  967        unitcell (UnitCell): \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002  968            \u6c37\u69cb\u9020\u306e\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8868\u3059\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\u683c\u5b50\u69cb\u9020\u3001\u6c34\u5206\u5b50\u306e\u914d\u7f6e\u3001  969            \u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3001\u56fa\u5b9a\u30a8\u30c3\u30b8\u306a\u3069\u306e\u60c5\u5831\u3092\u542b\u307f\u307e\u3059\u3002  970  971        replication_matrix (np.ndarray): \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3002  972            \u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092\u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b3x3\u6574\u6570\u884c\u5217\u3067\u3059\u3002  973            \u5358\u4f4d\u884c\u5217\u306e\u5834\u5408\u306f\u57fa\u672c\u5358\u4f4d\u80de\u306e\u307f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002  974  975        depol_loop (int): \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002  976            \u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u969b\u306e\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570\u3067\u3059\u3002  977            \u5024\u304c\u5927\u304d\u3044\u307b\u3069\u3088\u308a\u6700\u9069\u5316\u3055\u308c\u305f\u69cb\u9020\u304c\u5f97\u3089\u308c\u307e\u3059\u304c\u3001\u8a08\u7b97\u6642\u9593\u3082\u5897\u52a0\u3057\u307e\u3059\u3002  978  979        seed (int): \u4e71\u6570\u30b7\u30fc\u30c9\u3002  980            \u4e71\u6570\u751f\u6210\u5668\u306e\u30b7\u30fc\u30c9\u5024\u3067\u3059\u3002digraph\u306e\u751f\u6210\u306a\u3069\u3067\u4f7f\u7528\u3055\u308c\u308b\u4e71\u6570\u306e\u521d\u671f\u5316\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002  981            \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e  982            \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002  983  984        spot_anions (Dict[int, str]): \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002  985            \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3067\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001  986            \u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002  987  988        spot_cations (Dict[int, str]): \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002  989            \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3067\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001  990            \u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002  991  992        spot_hydroniums (List[int]): H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff081\u53d7\u5bb9\u30fb3\u4f9b\u4e0e\uff09\u3002  993  994        spot_hydroxides (List[int]): OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff083\u53d7\u5bb9\u30fb1\u4f9b\u4e0e\uff09\u3002  995  996        cages (CageSpecs): \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30b1\u30fc\u30b8\u4f4d\u7f6e\u30fb\u30bf\u30a4\u30d7\u3002  997            \u5358\u4f4d\u80de\u306e\u30b1\u30fc\u30b8\u3092 replica_vectors \u306b\u5f93\u3063\u3066\u8907\u88fd\u3057\u305f\u3082\u306e\u3067\u3001\u30b2\u30b9\u30c8\u914d\u7f6e\u3084 cage_survey \u51fa\u529b\u306b\u5229\u7528\u3057\u307e\u3059\u3002  998  999        fixed_edges (nx.DiGraph): \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3002 1000            \u5358\u4f4d\u80de\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3068 spot_anion/spot_cation/spot_hydronium/spot_hydroxide \u306b\u57fa\u3065\u304f\u56fa\u5b9a\u3092\u7d71\u5408\u3057\u305f\u3082\u306e\u3067\u3001digraph \u306e\u751f\u6210\u306b\u5229\u7528\u3057\u307e\u3059\u3002 1001    \"\"\" 1002 1003 # Class\u540d\u3067log\u8868\u793a\u3057\u305f\u3044\u3002 1004 logger = getLogger(\"GenIce3\") 1005 1006 # \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3059\u308bproperty\u306e\u30ea\u30b9\u30c8 1007 # \u3053\u306e\u30ea\u30b9\u30c8\u306b\u542b\u307e\u308c\u308bproperty\u306e\u307fAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b 1008 PUBLIC_API_PROPERTIES = [ 1009 \"digraph\", 1010 \"graph\", 1011 \"lattice_sites\", 1012 \"orientations\", 1013 \"unitcell\", 1014 \"replication_matrix\", 1015 \"depol_loop\", 1016 \"target_pol\", 1017 \"seed\", 1018 \"spot_anions\", 1019 \"spot_cations\", 1020 \"spot_hydroniums\", 1021 \"spot_hydroxides\", 1022 ] 1023 1024 def init( 1025 self, 1026 depol_loop: int = 1000, 1027 replication_matrix: np.ndarray = np.eye(3, dtype=int), 1028 target_pol: np.ndarray = np.array([0.0, 0.0, 0.0]), 1029 seed: int = 1, 1030 spot_anions: Dict[int, str] = {}, 1031 spot_cations: Dict[int, str] = {}, 1032 spot_hydroniums: List[int] = None, 1033 spot_hydroxides: List[int] = None, 1034 bjerrum_L_edges: List[Tuple[int, int]] | None = None, 1035 bjerrum_D_edges: List[Tuple[int, int]] | None = None, 1036 guests: Dict[str, List[\"GuestSpec\"]] = None, 1037 spot_guests: Dict[int, Molecule] = None, 1038 spot_cation_groups: Dict[int, Dict[int, str]] = None, 1039 kwargs: Any, 1040 ) -&gt; None: 1041 \"\"\"GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u521d\u671f\u5316\u3059\u308b\u3002 1042 1043        Args: 1044            depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1000\uff09 1045            replication_matrix: \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: \u5358\u4f4d\u884c\u5217\uff09 1046            target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: [0, 0, 0]\uff09 1047            seed: \u4e71\u6570\u30b7\u30fc\u30c9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1\uff09 1048            spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1049            spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1050            spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09 1051            spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09 1052            guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1053            spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1054            spot_cation_groups: spot_cation \u306e --group \u6307\u5b9a\uff08\u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d}\uff09\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1055 kwargs: \u305d\u306e\u4ed6\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell\u306a\u3069\uff09 1056 1057        Raises: 1058            ConfigurationError: \u7121\u52b9\u306a\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408 1059        \"\"\" 1060 # DependencyEngine\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210 1061 self.engine = DependencyEngine() 1062 1063 # Default\u5024\u304c\u5fc5\u8981\u306a\u3082\u306e 1064 self.seed = ( 1065 seed # reactive property\u3068\u3057\u3066\u8a2d\u5b9a\uff08setter\u3067np.random.seed()\u3082\u5b9f\u884c\u3055\u308c\u308b\uff09 1066 ) 1067 self.depol_loop = depol_loop 1068 self.replication_matrix = replication_matrix 1069 self.target_pol = target_pol 1070 self.spot_anions = spot_anions 1071 self.spot_cations = spot_cations 1072 self.spot_hydroniums = spot_hydroniums if spot_hydroniums is not None else [] 1073 self.spot_hydroxides = spot_hydroxides if spot_hydroxides is not None else [] 1074 self.bjerrum_L_edges = bjerrum_L_edges if bjerrum_L_edges is not None else [] 1075 self.bjerrum_D_edges = bjerrum_D_edges if bjerrum_D_edges is not None else [] 1076 self.guests = guests if guests is not None else {} 1077 self.spot_guests = spot_guests if spot_guests is not None else {} 1078 self.spot_cation_groups = ( 1079 spot_cation_groups if spot_cation_groups is not None else {} 1080 ) 1081 1082 # \u30bf\u30b9\u30af\u3092\u767b\u9332\uff08\u30e2\u30b8\u30e5\u30fc\u30eb\u30ec\u30d9\u30eb\u306e\u95a2\u6570\u3092\u767b\u9332\uff09 1083 self._register_tasks() 1084 1085 # Default\u5024\u304c\u4e0d\u8981\u306a\u3082\u306e 1086 for key in self.list_settable_reactive_properties(): 1087 if key in kwargs: 1088 setattr(self, key, kwargs.pop(key)) 1089 if kwargs: 1090 raise ConfigurationError(f\"Invalid keyword arguments: {kwargs}.\") 1091 1092 def _register_tasks(self): 1093 \"\"\"DependencyEngine \u306b @reactive \u3092\u4ed8\u3051\u305f\u30bf\u30b9\u30af\u95a2\u6570\u3092\u767b\u9332\u3059\u308b\"\"\" 1094 for func in get_reactive_tasks(name): 1095 self.engine.task(func) 1096 1097 # spot_anions 1098 @property 1099 def spot_anions(self): 1100 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002 1101 1102        Returns: 1103            Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1104        \"\"\" 1105 if not hasattr(self, \"_spot_anions\"): 1106 self._spot_anions = {} 1107 return self._spot_anions 1108 1109 @spot_anions.setter 1110 def spot_anions(self, spot_anions): 1111 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1112 1113        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1114        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1115 1116        Args: 1117            spot_anions: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1118        \"\"\" 1119 self._spot_anions = spot_anions 1120 self.logger.debug(f\"  {spot_anions=}\") 1121 self.engine.cache.clear() 1122 1123 # spot_cations 1124 @property 1125 def spot_cations(self): 1126 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002 1127 1128        Returns: 1129            Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1130        \"\"\" 1131 if not hasattr(self, \"_spot_cations\"): 1132 self._spot_cations = {} 1133 return self._spot_cations 1134 1135 @spot_cations.setter 1136 def spot_cations(self, spot_cations): 1137 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1138 1139        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1140        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1141 1142        Args: 1143            spot_cations: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1144        \"\"\" 1145 self._spot_cations = spot_cations 1146 self.logger.debug(f\"  {spot_cations=}\") 1147 self.engine.cache.clear() 1148 1149 # spot_hydroniums (H3O+: 1\u53d7\u5bb9\u30fb3\u4f9b\u4e0e) 1150 @property 1151 def spot_hydroniums(self): 1152 \"\"\"H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30021\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002 1153 1154        Returns: 1155            List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8 1156        \"\"\" 1157 if not hasattr(self, \"_spot_hydroniums\"): 1158 self._spot_hydroniums = [] 1159 return self._spot_hydroniums 1160 1161 @spot_hydroniums.setter 1162 def spot_hydroniums(self, spot_hydroniums): 1163 self._spot_hydroniums = ( 1164 list(spot_hydroniums) if spot_hydroniums is not None else [] 1165 ) 1166 self.logger.debug(f\"  {spot_hydroniums=}\") 1167 self.engine.cache.clear() 1168 1169 # spot_hydroxides (OH-: 3\u53d7\u5bb9\u30fb1\u4f9b\u4e0e) 1170 @property 1171 def spot_hydroxides(self): 1172 \"\"\"OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30023\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002 1173 1174        Returns: 1175            List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8 1176        \"\"\" 1177 if not hasattr(self, \"_spot_hydroxides\"): 1178 self._spot_hydroxides = [] 1179 return self._spot_hydroxides 1180 1181 @spot_hydroxides.setter 1182 def spot_hydroxides(self, spot_hydroxides): 1183 self._spot_hydroxides = ( 1184 list(spot_hydroxides) if spot_hydroxides is not None else [] 1185 ) 1186 self.logger.debug(f\"  {spot_hydroxides=}\") 1187 self.engine.cache.clear() 1188 1189 # Bjerrum L \u6b20\u9665\u306b\u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u96c6\u5408\uff08(i, j) \u306e\u30ea\u30b9\u30c8\uff09 1190 @property 1191 def bjerrum_L_edges(self) -&gt; List[Tuple[int, int]]: 1192 if not hasattr(self, \"_bjerrum_L_edges\"): 1193 self._bjerrum_L_edges = [] 1194 return self._bjerrum_L_edges 1195 1196 @bjerrum_L_edges.setter 1197 def bjerrum_L_edges(self, edges: List[Tuple[int, int]] | None): 1198 self._bjerrum_L_edges = list(edges) if edges is not None else [] 1199 self.logger.debug(f\"  {self._bjerrum_L_edges=}\") 1200 self.engine.cache.clear() 1201 1202 # Bjerrum D \u6b20\u9665\u306b\u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u96c6\u5408\uff08(i, j) \u306e\u30ea\u30b9\u30c8\uff09 1203 @property 1204 def bjerrum_D_edges(self) -&gt; List[Tuple[int, int]]: 1205 if not hasattr(self, \"_bjerrum_D_edges\"): 1206 self._bjerrum_D_edges = [] 1207 return self._bjerrum_D_edges 1208 1209 @bjerrum_D_edges.setter 1210 def bjerrum_D_edges(self, edges: List[Tuple[int, int]] | None): 1211 self._bjerrum_D_edges = list(edges) if edges is not None else [] 1212 self.logger.debug(f\"  {self._bjerrum_D_edges=}\") 1213 self.engine.cache.clear() 1214 1215 def add_spot_hydronium(self, sites): 1216 \"\"\"H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1217 1218        Args: 1219            sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1220        \"\"\" 1221 if sites is None: 1222 return 1223 # numpy \u306e\u30b9\u30ab\u30e9\u30fc\u3082\u53d7\u3051\u4ed8\u3051\u308b 1224 if isinstance(sites, (int, np.integer)): 1225 new_sites = [int(sites)] 1226 else: 1227 new_sites = list(sites) 1228 # setter \u3092\u7d4c\u7531\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7121\u52b9\u5316\u3059\u308b 1229 self.spot_hydroniums = list(self.spot_hydroniums) + new_sites 1230 1231 def add_spot_hydroxide(self, sites): 1232 \"\"\"OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1233 1234        Args: 1235            sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1236        \"\"\" 1237 if sites is None: 1238 return 1239 if isinstance(sites, (int, np.integer)): 1240 new_sites = [int(sites)] 1241 else: 1242 new_sites = list(sites) 1243 self.spot_hydroxides = list(self.spot_hydroxides) + new_sites 1244 1245 def add_bjerrum_L(self, edges): 1246 \"\"\"Bjerrum L \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1247 1248        Args: 1249            edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1250        \"\"\" 1251 if edges is None: 1252 return 1253 # \u5358\u4e00\u30bf\u30d7\u30eb (i, j) \u3082\u8a31\u5bb9\u3059\u308b 1254 if isinstance(edges, tuple) and len(edges) == 2: 1255 new_edges = [edges] 1256 else: 1257 new_edges = list(edges) 1258 self.bjerrum_L_edges = list(self.bjerrum_L_edges) + new_edges 1259 1260 def add_bjerrum_D(self, edges): 1261 \"\"\"Bjerrum D \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1262 1263        Args: 1264            edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1265        \"\"\" 1266 if edges is None: 1267 return 1268 if isinstance(edges, tuple) and len(edges) == 2: 1269 new_edges = [edges] 1270 else: 1271 new_edges = list(edges) 1272 self.bjerrum_D_edges = list(self.bjerrum_D_edges) + new_edges 1273 1274 @property 1275 def seed(self): 1276 \"\"\"\u4e71\u6570\u30b7\u30fc\u30c9\u3002 1277 1278        Returns: 1279            int: \u4e71\u6570\u30b7\u30fc\u30c9\u5024 1280        \"\"\" 1281 return self._seed 1282 1283 @seed.setter 1284 def seed(self, seed): 1285 \"\"\"\u4e71\u6570\u30b7\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1286 1287        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1288        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1289 1290        Args: 1291            seed: \u4e71\u6570\u30b7\u30fc\u30c9\u5024 1292        \"\"\" 1293 self._seed = seed 1294 np.random.seed(seed) 1295 self.logger.debug(f\"  {seed=}\") 1296 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08seed\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1297 self.engine.cache.clear() 1298 1299 @property 1300 def depol_loop(self): 1301 \"\"\"\u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002 1302 1303        Returns: 1304            int: \u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570 1305        \"\"\" 1306 return self._depol_loop 1307 1308 @depol_loop.setter 1309 def depol_loop(self, depol_loop): 1310 \"\"\"\u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1311 1312        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1313        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1314 1315        Args: 1316            depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570 1317        \"\"\" 1318 self._depol_loop = depol_loop 1319 self.logger.debug(f\"  {depol_loop=}\") 1320 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08depol_loop\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1321 self.engine.cache.clear() 1322 1323 @property 1324 def target_pol(self): 1325 \"\"\"\u5206\u6975\u306e\u76ee\u6a19\u5024\uff083\u8981\u7d20\u306e\u30d9\u30af\u30c8\u30eb\uff09\u3002\"\"\" 1326 return self._target_pol 1327 1328 @target_pol.setter 1329 def target_pol(self, target_pol): 1330 \"\"\"\u5206\u6975\u306e\u76ee\u6a19\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\u5909\u66f4\u6642\u306f\u4f9d\u5b58\u3059\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3059\u308b\u3002\"\"\" 1331 self._target_pol = np.asarray(target_pol, dtype=float).reshape(3) 1332 self.logger.debug(f\"  {target_pol=}\") 1333 self.engine.cache.clear() 1334 1335 @property 1336 def unitcell(self): 1337 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1338 1339        Returns: 1340            UnitCell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 1341 1342        Raises: 1343            ConfigurationError: \u5358\u4f4d\u80de\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408 1344        \"\"\" 1345 if not hasattr(self, \"_unitcell\") or self._unitcell is None: 1346 raise ConfigurationError(\"Unitcell is not set.\") 1347 return self._unitcell 1348 1349 @unitcell.setter 1350 def unitcell(self, unitcell): 1351 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1352 1353        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1354        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1355 1356        Args: 1357            unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 1358        \"\"\" 1359 self._unitcell = unitcell 1360 self.logger.debug(f\"  {unitcell=}\") 1361 self.logger.debug(f\"  {unitcell.lattice_sites=}\") 1362 self.logger.debug(f\"  {unitcell.graph=}\") 1363 self.logger.debug(f\"  {unitcell.fixed=}\") 1364 1365 a, b, c, A, B, C = cellshape(self.replication_matrix @ self.unitcell.cell) 1366 self.logger.debug(\"  Reshaped cell:\") 1367 self.logger.debug(f\"    {a=:.4f}, {b=:.4f}, {c=:.4f}\") 1368 self.logger.debug(f\"    {A=:.3f}, {B=:.3f}, {C=:.3f}\") 1369 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08unitcell\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1370 self.engine.cache.clear() 1371 1372 def set_unitcell(self, unitcell_or_name, kwargs): 1373 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002 1374 1375        \u4ee3\u5165\uff08genice.unitcell = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 1376        \u5358\u4f4d\u80de\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002 1377 1378        Args: 1379            unitcell_or_name: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u307e\u305f\u306f\u5358\u4f4d\u80de\u540d\uff08\u6587\u5b57\u5217\uff09\u3002 1380                \u6587\u5b57\u5217\u306e\u5834\u5408\u306f UnitCell(name, kwargs) \u3068\u3057\u3066\u5185\u90e8\u3067\u751f\u6210\u3057\u307e\u3059\u3002 1381 kwargs: unitcell_or_name \u304c\u6587\u5b57\u5217\u306e\u5834\u5408\u306b UnitCell(...) \u306b\u6e21\u3059\u30aa\u30d7\u30b7\u30e7\u30f3\u3002 1382        \"\"\" 1383 if isinstance(unitcell_or_name, UnitCell): 1384 self.unitcell = unitcell_or_name 1385 else: 1386 self.unitcell = UnitCellPlugin(unitcell_or_name, kwargs) 1387 1388 @property 1389 def replication_matrix(self): 1390 \"\"\"\u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002 1391 1392        \u3053\u306e\u884c\u5217\u306b\u3088\u308a\u3001\u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092 1393        \u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 1394 1395        Returns: 1396            np.ndarray: 3x3\u6574\u6570\u884c\u5217 1397        \"\"\" 1398 return self._replication_matrix 1399 1400 @replication_matrix.setter 1401 def replication_matrix(self, replication_matrix): 1402 \"\"\"\u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1403 1404        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1405        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1406 1407        Args: 1408            replication_matrix: 3x3\u6574\u6570\u884c\u5217 1409        \"\"\" 1410 self._replication_matrix = np.array(replication_matrix).reshape(3, 3) 1411 i, j, k = self._replication_matrix 1412 self.logger.debug(f\"    {i=}\") 1413 self.logger.debug(f\"    {j=}\") 1414 self.logger.debug(f\"    {k=}\") 1415 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08replication_matrix\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1416 self.engine.cache.clear() 1417 1418 def set_replication_matrix(self, replication_matrix): 1419 \"\"\"\u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002 1420 1421        \u4ee3\u5165\uff08genice.replication_matrix = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 1422        \u8907\u88fd\u884c\u5217\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002 1423 1424        Args: 1425            replication_matrix: 3x3\u6574\u6570\u884c\u5217\uff08\u30ea\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u307e\u305f\u306f ndarray\uff09 1426        \"\"\" 1427 self.replication_matrix = replication_matrix 1428 1429 def _get_inputs(self) -&gt; Dict[str, Any]: 1430 \"\"\"engine.resolve()\u306b\u6e21\u3059inputs\u8f9e\u66f8\u3092\u53d6\u5f97\"\"\" 1431 return { 1432 \"unitcell\": self.unitcell, 1433 \"replication_matrix\": self.replication_matrix, 1434 \"depol_loop\": self.depol_loop, 1435 \"target_pol\": self.target_pol, 1436 \"spot_anions\": self.spot_anions, 1437 \"spot_cations\": self.spot_cations, 1438 \"spot_hydroniums\": self.spot_hydroniums, 1439 \"spot_hydroxides\": self.spot_hydroxides, 1440 \"bjerrum_L_edges\": self.bjerrum_L_edges, 1441 \"bjerrum_D_edges\": self.bjerrum_D_edges, 1442 } 1443 1444 def getattr(self, name: str): 1445 \"\"\"\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u81ea\u52d5\u89e3\u6c7a\u3059\u308b\u3002 1446 1447        \u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308a\u3001DependencyEngine\u306b\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\u95a2\u6570\u304c 1448        \u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001 1449        \u4f9d\u5b58\u95a2\u4fc2\u304c\u81ea\u52d5\u7684\u306b\u89e3\u6c7a\u3055\u308c\u3001\u5fc5\u8981\u306a\u8a08\u7b97\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002 1450 1451        \u4f8b: 1452            &gt;&gt;&gt; genice = GenIce3(unitcell=my_unitcell) 1453            &gt;&gt;&gt; digraph = genice.digraph  # \u3053\u306e\u6642\u70b9\u3067digraph\u3068\u305d\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u8a08\u7b97\u3055\u308c\u308b 1454 1455        Args: 1456            name: \u30a2\u30af\u30bb\u30b9\u3059\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\u540d\uff08\u30bf\u30b9\u30af\u95a2\u6570\u540d\uff09 1457 1458        Returns: 1459            \u8a08\u7b97\u3055\u308c\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5024 1460 1461        Raises: 1462            AttributeError: \u6307\u5b9a\u3055\u308c\u305f\u540d\u524d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408 1463            ConfigurationError: \u5fc5\u8981\u306a\u5165\u529b\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408 1464        \"\"\" 1465 # DependencyEngine\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30bf\u30b9\u30af\u304b\u30c1\u30a7\u30c3\u30af 1466 if name in self.engine.registry: 1467 return self.engine.resolve(name, self._get_inputs()) 1468 1469 # \u305d\u308c\u4ee5\u5916\u306f\u901a\u5e38\u306eAttributeError\u3092\u767a\u751f 1470 raise AttributeError( 1471 f\"'{self.class.name}' object has no attribute '{name}'\" 1472 ) 1473 1474 def water_molecules(self, water_model: Molecule) -&gt; Dict[int, Molecule]: 1475 \"\"\"\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u306e\u30b5\u30a4\u30c8\u306b\u3064\u3044\u3066\u3001\u914d\u5411\u30fb\u4f4d\u7f6e\u3092\u9069\u7528\u3057\u305f\u6c34\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002 1476 1477        Args: 1478            water_model: \u6c34\u5206\u5b50\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08sites, labels \u306a\u3069\uff09\u3002 1479 1480        Returns: 1481            \u30b5\u30a4\u30c8\u756a\u53f7\uff08\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u2192 Molecule \u306e\u8f9e\u66f8\u3002\u30a4\u30aa\u30f3\u30b5\u30a4\u30c8\u306f\u542b\u307e\u306a\u3044\u3002 1482        \"\"\" 1483 mols = {} 1484 for site in range(len(self.lattice_sites)): 1485 occ = self.site_occupants[site] 1486 # hydronium\u3084hydroxide\u306fwater-like\u3067\u306f\u306a\u3044\u3002 1487 is_water_like = occ == \"water\" 1488 if is_water_like: 1489 rel_position = self.lattice_sites[site] 1490 orientation = self.orientations[site] 1491 1492 sites = water_model.sites @ orientation + rel_position @ self.cell 1493 mols[site] = Molecule( 1494 name=water_model.name, 1495 sites=sites, 1496 labels=water_model.labels, 1497 is_water=True, 1498 ) 1499 return mols 1500 1501 def guest_molecules(self) -&gt; List[Molecule]: 1502 \"\"\"GenIce3\u306b\u8a2d\u5b9a\u3055\u308c\u305fguests\u3068spot_guests\u304b\u3089\u30b2\u30b9\u30c8\u5206\u5b50\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002\"\"\" 1503 # \u901a\u5e38\u306e\u6c37\uff08\u30b2\u30b9\u30c8\u306a\u3057\uff09\u3067\u306f\u30b1\u30fc\u30b8\u4e0d\u8981 \u2192 assess_cages \u3092\u547c\u3070\u306a\u3044 1504 if not self.guests and not self.spot_guests: 1505 return [] 1506 1507 all_cage_types = [spec.cage_type for spec in self.cages.specs] 1508 available = sorted(set(all_cage_types)) 1509 # guest_spec\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u306b\u5b58\u5728\u3057\u306a\u3044\u7a2e\u985e\u306e\u30b1\u30fc\u30b8\u306f\u30a8\u30e9\u30fc\u306b\u3059\u308b\u3002 1510 for cage_type in self.guests: 1511 if cage_type not in all_cage_types: 1512 raise ConfigurationError( 1513 f\"Cage type {cage_type} is not defined. \" 1514 f\"Available cage types in this structure: {available}.\" 1515 ) 1516 1517 randoms = np.random.random(len(self.cages.positions)) 1518 1519 mols = [] 1520 for pos, spec, probability in zip( 1521 self.cages.positions, self.cages.specs, randoms 1522 ): 1523 accum = 0.0 1524 if spec.cage_type in self.guests: 1525 for guest_spec in self.guests[spec.cage_type]: 1526 molecule = guest_spec.molecule 1527 occupancy = guest_spec.occupancy 1528 accum += occupancy 1529 if accum &gt; probability: 1530 mols.append( 1531 Molecule( 1532 name=molecule.name, 1533 sites=molecule.sites + pos @ self.cell, 1534 labels=molecule.labels, 1535 is_water=molecule.is_water, 1536 ) 1537 ) 1538 break 1539 1540 # spot guest\u306e\u914d\u7f6e 1541 for cage_index, guest in self.spot_guests.items(): 1542 mols.append( 1543 Molecule( 1544 name=guest.name, 1545 sites=guest.sites + self.cages.positions[cage_index] @ self.cell, 1546 labels=guest.labels, 1547 is_water=False, 1548 ) 1549 ) 1550 return mols 1551 1552 def build_molecular_ion( 1553 self, 1554 site_index: int, 1555 molecule: str, 1556 groups: Dict[int, str] | None = None, 1557 ) -&gt; Molecule: 1558 \"\"\"\u30b5\u30a4\u30c8 site_index\uff08\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u306b\u5206\u5b50\u30a4\u30aa\u30f3\uff08\u304a\u3088\u3073 spot cation \u7528\u306e\u4fee\u98fe group\uff09\u3092\u69cb\u7bc9\u3059\u308b\u3002 1559 1560        Args: 1561            site_index: \u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\u3002 1562            molecule: \u5206\u5b50\u30a4\u30aa\u30f3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonium\"\uff09\u3002 1563            groups: \u5f53\u8a72\u30b5\u30a4\u30c8\u306b\u96a3\u63a5\u3059\u308b\u30b1\u30fc\u30b8ID \u2192 group\u540d\u3002spot cation \u306e\u4fee\u98fe\u7528\u3002 1564 1565        Returns: 1566            \u76f4\u4ea4\u5ea7\u6a19\u3067\u914d\u7f6e\u3055\u308c\u305f Molecule\uff08\u539f\u5b50\u540d\u306f labels\uff09\u3002 1567        \"\"\" 1568 groups = groups or {} 1569 ion_center = self.lattice_sites[site_index] @ self.cell 1570 try: 1571 ion = safe_import(\"molecule\", molecule).Molecule() 1572 name = ion.name 1573 sites = ion.sites + ion_center 1574 atom_names: List[str] = list(ion.labels) 1575 except ImportError: 1576 name = molecule 1577 sites = np.array([ion_center]) 1578 atom_names = [molecule] 1579 # \u4fee\u98fe\u30b0\u30eb\u30fc\u30d7\u3092\u7f6e\u3044\u3066\u3044\u304f\uff08--group \u6307\u5b9a\u304c\u3042\u3063\u305f\u30b5\u30a4\u30c8\u306e\u307f\uff09 1580 for cage, group_name in groups.items(): 1581 direction = self.cages.positions[cage] - self.lattice_sites[site_index] 1582 direction -= np.floor(direction + 0.5) 1583 group = place_group( 1584 direction @ self.cell, 1585 0.13, # \u3042\u3068\u3067\u306a\u3093\u3068\u304b\u3059\u308b\u3002N-H\u7d50\u5408\u8ddd\u96e2 1586 group_name, 1587 ) 1588 sites = np.concatenate([sites, group.sites + ion_center]) 1589 atom_names += group.labels 1590 self.logger.info(f\"{atom_names=}\") 1591 return Molecule( 1592 name=name, 1593 sites=sites, 1594 labels=atom_names, 1595 is_water=False, 1596 ) 1597 1598 def _effective_spot_cation_groups(self) -&gt; Dict[int, Dict[int, str]]: 1599 \"\"\"spot_cation_groups \u306b\u5358\u4f4d\u80de\u7531\u6765\u306e cation_groups \u3092\u5c55\u958b\u3057\u3066\u30de\u30fc\u30b8\u3057\u305f\u8f9e\u66f8\u3092\u8fd4\u3059\uff08on-demand\uff09\u3002\"\"\" 1600 # \u30d9\u30fc\u30b9\u306f CLI/API \u3067\u6307\u5b9a\u3055\u308c\u305f spot_cation_groups 1601 effective: Dict[int, Dict[int, str]] = { 1602 k: dict(v) for k, v in self.spot_cation_groups.items() 1603 } 1604 # number of nodes in the unitcell 1605 nuc_nodes = len(self.unitcell.lattice_sites) 1606 # number of cages in the unitcell 1607 nuc_cages = len(self.unitcell.cages.specs) 1608 for un_node, uc_group in self.unitcell.cation_groups.items(): 1609 for node in _replicate_lattice_node( 1610 un_node, nuc_nodes, self.replication_matrix 1611 ): 1612 # \u62e1\u5927\u80de\u306e\u30ce\u30fc\u30c9\u306b\u96a3\u63a5\u3059\u308b4\u3064\u306e\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 1613 cage_indices = self.cages.node_to_cage_indices.get(node, []) 1614 for cage_index in cage_indices: 1615 # \u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5358\u4f4d\u80de\u3067\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u306a\u304a\u3057\u3001\u305d\u3053\u306b\u5165\u308b\u30b0\u30eb\u30fc\u30d7\u3092\u53d6\u5f97 1616 self.logger.info(f\"{cage_index=} {nuc_cages=} {uc_group=} {node=}\") 1617 uc_cage_index = cage_index % nuc_cages 1618 if uc_cage_index in uc_group: 1619 group = uc_group[cage_index % nuc_cages] 1620 # \u62e1\u5927\u80de\u306e\u30ce\u30fc\u30c9\u306b\u96a3\u63a5\u3059\u308b4\u3064\u306e\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3001\u30b0\u30eb\u30fc\u30d7\u3092\u30de\u30c3\u30d4\u30f3\u30b0 1621 effective.setdefault(node, {}).setdefault(cage_index, group) 1622 return effective 1623 1624 def build_hydronium(self, site_index: int) -&gt; Molecule: 1625 \"\"\"H3O+ \u3092\u69cb\u7bc9\u3059\u308b\u3002\"\"\" 1626 sites = [] 1627 labels = [\"Cn\", \"Hn\", \"Hn\", \"Hn\"] 1628 OH = 0.1 1629 sites.append(np.zeros(3)) 1630 neighbors = list(self.digraph.successors(site_index)) 1631 if len(neighbors) != 3: 1632 raise ValueError(\"H3O+ must have 3 neighbors.\") 1633 for neighbor in neighbors: 1634 direction = self.lattice_sites[neighbor] - self.lattice_sites[site_index] 1635 direction -= np.floor(direction + 0.5) 1636 direction = direction @ self.cell 1637 direction = OH / np.linalg.norm(direction) 1638 sites.append(direction) 1639 return Molecule( 1640 name=\"H3O\", 1641 sites=np.array(sites) + self.lattice_sites[site_index] @ self.cell, 1642 labels=labels, 1643 is_water=False, 1644 ) 1645 1646 def build_hydroxide(self, site_index: int) -&gt; Molecule: 1647 \"\"\"OH- \u3092\u69cb\u7bc9\u3059\u308b\u3002\"\"\" 1648 sites = [] 1649 labels = [\"Nx\", \"Hx\"] 1650 OH = 0.1 1651 sites.append(np.zeros(3)) 1652 neighbors = list(self.digraph.successors(site_index)) 1653 if len(neighbors) != 1: 1654 raise ValueError(f\"OH- must have 1 neighbor. {site_index=} {neighbors=}\") 1655 direction = self.lattice_sites[neighbors[0]] - self.lattice_sites[site_index] 1656 direction -= np.floor(direction + 0.5) 1657 direction = direction @ self.cell 1658 direction *= OH / np.linalg.norm(direction) 1659 sites.append(direction) 1660 return Molecule( 1661 name=\"OH\", 1662 sites=np.array(sites) + self.lattice_sites[site_index] @ self.cell, 1663 labels=labels, 1664 is_water=False, 1665 ) 1666 1667 def substitutional_ions(self) -&gt; Dict[int, Molecule]: 1668 \"\"\"\u5358\u4f4d\u80de\u30fbspot \u7531\u6765\u306e\u30a4\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002\"\"\" 1669 # \u5358\u4f4d\u80de\u7531\u6765\u306e group \u6307\u5b9a\u3082\u542b\u3081\u305f\u300c\u5b9f\u52b9\u7684\u306a\u300dspot_cation_groups \u3092\u3053\u3053\u3067 on-demand \u306b\u7d44\u307f\u7acb\u3066\u3066\u4f7f\u3046 1670 1671 # \u524d\u63d0\u6761\u4ef6: anions, cations, hydroniums, hydroxides\u306e\u30b5\u30a4\u30c8\u306b\u91cd\u8907\u304c\u306a\u3044\u3053\u3068\u3002 1672 # \u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u3092\u8fd4\u3059\u3002 1673 if len(set(self.spot_hydroniums) &amp; set(self.spot_hydroxides)) &gt; 0: 1674 raise ValueError(\"hydroniums and hydroxides must not have the same site.\") 1675 if len(set(self.anions) &amp; set(self.cations)) &gt; 0: 1676 raise ValueError(\"anions and cations must not have the same site.\") 1677 if len(set(self.spot_hydroniums) &amp; set(self.cations)) &gt; 0: 1678 raise ValueError(\"hydroniums and cations must not have the same site.\") 1679 if len(set(self.spot_hydroxides) &amp; set(self.cations)) &gt; 0: 1680 raise ValueError(\"hydroxides and cations must not have the same site.\") 1681 1682 ions: Dict[int, Molecule] = {} 1683 for site_index in self.spot_hydroniums: 1684 ions[site_index] = self.build_hydronium(site_index) 1685 for site_index in self.spot_hydroxides: 1686 ions[site_index] = self.build_hydroxide(site_index) 1687 # \u306a\u3089\u3079\u304b\u3048\u306f\u3053\u3053\u3067\u306f\u3057\u306a\u3044\u3002formatter\u306b\u307e\u304b\u305b\u308b\u3002 1688 for site_index, molecule in self.anions.items(): 1689 ions[site_index] = self.build_molecular_ion(site_index, molecule) 1690 effective_groups = self._effective_spot_cation_groups() 1691 for site_index, molecule in self.cations.items(): 1692 # cation\u306b\u306f\u8155\u304c\u3064\u304f\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002 1693 groups = effective_groups.get(site_index, {}) 1694 ions[site_index] = self.build_molecular_ion(site_index, molecule, groups) 1695 self.logger.info(f\"{ions=}\") 1696 return ions 1697 1698 def dope_anions(self, anions: Dict[int, Molecule]) -&gt; None: 1699 \"\"\"\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002\"\"\" 1700 for site_index, molecule in anions.items(): 1701 self.anions[site_index] = molecule 1702 1703 def dope_cations(self, cations: Dict[int, Molecule]) -&gt; None: 1704 \"\"\"\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002\"\"\" 1705 for site_index, molecule in cations.items(): 1706 self.cations[site_index] = molecule 1707 1708 # def get_atomic_structure( 1709 #     self, 1710 #     water_model: Optional[Molecule] = None, 1711 #     guests: Optional[Dict[str, List[GuestSpec]]] = None, 1712 #     spot_guests: Optional[Dict[int, Molecule]] = None, 1713 # ) -&gt; AtomicStructure: 1714 #     \"\"\" 1715 #     \u539f\u5b50\u69cb\u9020\u30c7\u30fc\u30bf\u3092\u7d71\u5408\u7684\u306b\u53d6\u5f97\u3059\u308b\u3002 1716 #     exporter\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002 1717 1718 #     Args: 1719 #         water_model: \u6c34\u5206\u5b50\u30e2\u30c7\u30eb\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: FourSiteWater()\uff09 1720 #         guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u306e\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1721 #         spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u306e\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1722 1723 #     Returns: 1724 #         AtomicStructure: \u6c34\u5206\u5b50\u3001\u30b2\u30b9\u30c8\u5206\u5b50\u3001\u30a4\u30aa\u30f3\u3001\u30bb\u30eb\u884c\u5217\u3092\u542b\u3080\u7d71\u5408\u30c7\u30fc\u30bf\u69cb\u9020 1725 #     \"\"\" 1726 1727 #     return AtomicStructure( 1728 #         waters=self.water_molecules(water_model=water_model), 1729 #         guests=self.guest_molecules( 1730 #             guests=guests or {}, spot_guests=spot_guests or {} 1731 #         ), 1732 #         ions=self.substitutional_ions(), 1733 #         cell=self.cell, 1734 #     ) 1735 1736 @classmethod 1737 def get_public_api_properties(cls): 1738 \"\"\" 1739        \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308bproperty\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u3002 1740 1741        Returns: 1742            list: \u516c\u958bAPI property\u540d\u306e\u30ea\u30b9\u30c8 1743        \"\"\" 1744 return cls.PUBLIC_API_PROPERTIES.copy() 1745 1746 def list_all_reactive_properties(self): 1747 \"\"\" 1748        \u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08DependencyEngine\u306b\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\uff09\u3092\u5217\u6319\u3059\u308b\u3002 1749 1750        Returns: 1751            dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8 1752        \"\"\" 1753 return self.engine.registry.copy() 1754 1755 def list_public_reactive_properties(self): 1756 \"\"\" 1757        \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002 1758 1759        Returns: 1760            dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8 1761        \"\"\" 1762 all_reactive = self.list_all_reactive_properties() 1763 public_names = set(self.PUBLIC_API_PROPERTIES) 1764 return { 1765 name: func for name, func in all_reactive.items() if name in public_names 1766 } 1767 1768 @classmethod 1769 def list_settable_reactive_properties(cls): 1770 \"\"\"setter\u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u5909\u6570\u3092\u5217\u6319\u3059\u308b\"\"\" 1771 return { 1772 name: prop 1773 for name, prop in inspect.getmembers( 1774 cls, lambda x: isinstance(x, property) and x.fset is not None 1775 ) 1776 } 1777 1778 @classmethod 1779 def list_public_settable_reactive_properties(cls): 1780 \"\"\"\u516c\u958bAPI\u306e\u3046\u3061\u3001setter \u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002\"\"\" 1781 return { 1782 name: prop 1783 for name, prop in cls.list_settable_reactive_properties().items() 1784 if name in cls.PUBLIC_API_PROPERTIES 1785 } <pre><code>        &lt;/section&gt;\n            &lt;section id=\"ShowUsageError\"&gt;\n                        &lt;input id=\"ShowUsageError-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> class ShowUsageError(builtins.Exception):                  View Source <pre><code>&lt;a class=\"headerlink\" href=\"#ShowUsageError\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"ShowUsageError-44\"&gt;&lt;a href=\"#ShowUsageError-44\"&gt;&lt;span class=\"linenos\"&gt;44&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;class&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nc\"&gt;ShowUsageError&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"ne\"&gt;Exception&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>45 \"\"\"Usage\u8868\u793a\u3092\u8981\u6c42\u3059\u308b\u4f8b\u5916 46 47    Args: 48        flag_name: \u30d5\u30e9\u30b0\u540d\uff08\u4f8b: \"?\", \"help?\", \"cage?\"\uff09 49    \"\"\" 50 51 def init(self, flag_name: str, message: str = \"\"): 52 self.flag_name = flag_name 53 super().init(message or f\"Show usage for flag: {flag_name}\") </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Usage\u8868\u793a\u3092\u8981\u6c42\u3059\u308b\u4f8b\u5916&lt;/p&gt;\n</code></pre> <p>Args:     flag_name: \u30d5\u30e9\u30b0\u540d\uff08\u4f8b: \"?\", \"help?\", \"cage?\"\uff09</p> <pre><code>                        &lt;div id=\"ShowUsageError.__init__\" class=\"classattr\"&gt;\n                                    &lt;input id=\"ShowUsageError.__init__-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> ShowUsageError(flag_name: str, message: str = '') View Source <pre><code>&lt;a class=\"headerlink\" href=\"#ShowUsageError.__init__\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"ShowUsageError.__init__-51\"&gt;&lt;a href=\"#ShowUsageError.__init__-51\"&gt;&lt;span class=\"linenos\"&gt;51&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"fm\"&gt;__init__&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;flag_name&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;str&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;message&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;str&lt;/span&gt; &lt;span class=\"o\"&gt;=&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>52 self.flag_name = flag_name 53 super().init(message or f\"Show usage for flag: {flag_name}\") </p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"ShowUsageError.flag_name\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;flag_name&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#ShowUsageError.flag_name\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n            &lt;/section&gt;\n            &lt;section id=\"MoleculeType\"&gt;\n                        &lt;input id=\"MoleculeType-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> class MoleculeType(enum.Enum):                  View Source <pre><code>&lt;a class=\"headerlink\" href=\"#MoleculeType\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"MoleculeType-57\"&gt;&lt;a href=\"#MoleculeType-57\"&gt;&lt;span class=\"linenos\"&gt;57&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;class&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nc\"&gt;MoleculeType&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;Enum&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>58 WATER = \"water\" 59 GUEST = \"guest\" 60 DOPANT = \"dopant\" 61 GROUP = \"group\" </p> <pre><code>                        &lt;div id=\"MoleculeType.WATER\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;WATER&lt;/span&gt;        =\n</code></pre> <p>&lt;MoleculeType.WATER: 'water'&gt;</p> <pre><code>&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#MoleculeType.WATER\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"MoleculeType.GUEST\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;GUEST&lt;/span&gt;        =\n</code></pre> <p>&lt;MoleculeType.GUEST: 'guest'&gt;</p> <pre><code>&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#MoleculeType.GUEST\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"MoleculeType.DOPANT\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;DOPANT&lt;/span&gt;        =\n</code></pre> <p>&lt;MoleculeType.DOPANT: 'dopant'&gt;</p> <pre><code>&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#MoleculeType.DOPANT\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"MoleculeType.GROUP\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;GROUP&lt;/span&gt;        =\n</code></pre> <p>&lt;MoleculeType.GROUP: 'group'&gt;</p> <pre><code>&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#MoleculeType.GROUP\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n            &lt;/section&gt;\n            &lt;section id=\"GuestSpec\"&gt;\n                        &lt;input id=\"GuestSpec-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @dataclass class GuestSpec:                  View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GuestSpec\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GuestSpec-64\"&gt;&lt;a href=\"#GuestSpec-64\"&gt;&lt;span class=\"linenos\"&gt;64&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@dataclass&lt;/span&gt;\n</code></pre> <p>65class GuestSpec: 66 \"\"\" 67    \u30b2\u30b9\u30c8\u306e\u60c5\u5831\u3092\u8868\u3059\u30c7\u30fc\u30bf\u30af\u30e9\u30b9\u3002 68    \"\"\" 69 70 molecule: Molecule 71 occupancy: float 72 73 def repr(self) -&gt; str: 74 return ( 75 f\"GuestSpec(molecule={self.molecule.name!r}, \" 76 f\"occupancy={self.occupancy:.3f})\" 77 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30b2\u30b9\u30c8\u306e\u60c5\u5831\u3092\u8868\u3059\u30c7\u30fc\u30bf\u30af\u30e9\u30b9\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;div id=\"GuestSpec.__init__\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr function\"&gt;\n\n    &lt;span class=\"name\"&gt;GuestSpec&lt;/span&gt;&lt;span class=\"signature pdoc-code condensed\"&gt;(&lt;span class=\"param\"&gt;&lt;span class=\"n\"&gt;molecule&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;genice3&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;molecule&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;Molecule&lt;/span&gt;, &lt;/span&gt;&lt;span class=\"param\"&gt;&lt;span class=\"n\"&gt;occupancy&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;float&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GuestSpec.__init__\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GuestSpec.molecule\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;molecule&lt;/span&gt;&lt;span class=\"annotation\"&gt;: genice3.molecule.Molecule&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GuestSpec.molecule\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GuestSpec.occupancy\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;occupancy&lt;/span&gt;&lt;span class=\"annotation\"&gt;: float&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GuestSpec.occupancy\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n            &lt;/section&gt;\n            &lt;section id=\"AtomicStructure\"&gt;\n                        &lt;input id=\"AtomicStructure-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @dataclass class AtomicStructure:                  View Source <pre><code>&lt;a class=\"headerlink\" href=\"#AtomicStructure\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"AtomicStructure-80\"&gt;&lt;a href=\"#AtomicStructure-80\"&gt;&lt;span class=\"linenos\"&gt;80&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@dataclass&lt;/span&gt;\n</code></pre> <p>81class AtomicStructure: 82 \"\"\" 83    \u539f\u5b50\u69cb\u9020\u30c7\u30fc\u30bf\u3092\u7d71\u5408\u7684\u306b\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u30af\u30e9\u30b9\u3002 84    exporter\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002 85    \"\"\" 86 87 waters: Dict[int, Molecule] 88 guests: List[Molecule] 89 ions: Dict[int, Molecule] 90 cell: np.ndarray 91 92 def repr(self) -&gt; str: 93 return ( 94 f\"AtomicStructure(n_waters={len(self.waters)}, \" 95 f\"n_guests={len(self.guests)}, \" 96 f\"n_ions={len(self.ions)}, \" 97 f\"cell_shape={self.cell.shape})\" 98 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u539f\u5b50\u69cb\u9020\u30c7\u30fc\u30bf\u3092\u7d71\u5408\u7684\u306b\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u30af\u30e9\u30b9\u3002\n</code></pre> <p>exporter\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002</p> <pre><code>                        &lt;div id=\"AtomicStructure.__init__\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr function\"&gt;\n\n    &lt;span class=\"name\"&gt;AtomicStructure&lt;/span&gt;&lt;span class=\"signature pdoc-code multiline\"&gt;(&lt;span class=\"param\"&gt;  &lt;span class=\"n\"&gt;waters&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;Dict&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;genice3&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;molecule&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;]&lt;/span&gt;,&lt;/span&gt;&lt;span class=\"param\"&gt;   &lt;span class=\"n\"&gt;guests&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;List&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"n\"&gt;genice3&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;molecule&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;]&lt;/span&gt;,&lt;/span&gt;&lt;span class=\"param\"&gt;   &lt;span class=\"n\"&gt;ions&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;Dict&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;genice3&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;molecule&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;]&lt;/span&gt;,&lt;/span&gt;&lt;span class=\"param\"&gt; &lt;span class=\"n\"&gt;cell&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;numpy&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;ndarray&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#AtomicStructure.__init__\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"AtomicStructure.waters\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;waters&lt;/span&gt;&lt;span class=\"annotation\"&gt;: Dict[int, genice3.molecule.Molecule]&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#AtomicStructure.waters\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"AtomicStructure.guests\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;guests&lt;/span&gt;&lt;span class=\"annotation\"&gt;: List[genice3.molecule.Molecule]&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#AtomicStructure.guests\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"AtomicStructure.ions\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;ions&lt;/span&gt;&lt;span class=\"annotation\"&gt;: Dict[int, genice3.molecule.Molecule]&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#AtomicStructure.ions\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"AtomicStructure.cell\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;cell&lt;/span&gt;&lt;span class=\"annotation\"&gt;: numpy.ndarray&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#AtomicStructure.cell\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n            &lt;/section&gt;\n            &lt;section id=\"replicate_subgraph\"&gt;\n                        &lt;input id=\"replicate_subgraph-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def replicate_subgraph( repgraph: networkx.classes.graph.Graph, subgraph: networkx.classes.graph.Graph, nmol: int) -&gt; Generator[networkx.classes.graph.Graph, NoneType, NoneType]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#replicate_subgraph\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"replicate_subgraph-297\"&gt;&lt;a href=\"#replicate_subgraph-297\"&gt;&lt;span class=\"linenos\"&gt;297&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;replicate_subgraph&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;\n</code></pre> <p>298 repgraph: nx.Graph, subgraph: nx.Graph, nmol: int 299) -&gt; Generator[nx.Graph, None, None]: 300 \"\"\"\u5358\u4f4d\u80de\u5185\u306e subgraph \u306e\u5404\u30ec\u30d7\u30ea\u30ab\u3092 repgraph \u304b\u3089\u53d6\u308a\u51fa\u3057\u3066 yield \u3059\u308b\u3002 301 302    Args: 303        repgraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002 304        subgraph: \u5358\u4f4d\u80de\u5185\u306e\u90e8\u5206\u30b0\u30e9\u30d5\uff08\u4f8b: 1\u30b1\u30fc\u30b8\u3092\u69cb\u6210\u3059\u308b\u30ce\u30fc\u30c9\u3068\u8fba\uff09\u3002 305        nmol: \u5358\u4f4d\u80de\u5185\u306e\u30ce\u30fc\u30c9\u6570\u3002 306 307    Yields: 308        \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u5404\u30ec\u30d7\u30ea\u30ab\u306b\u5bfe\u5fdc\u3059\u308b\u90e8\u5206\u30b0\u30e9\u30d5\uff08nx.Graph\uff09\u3002 309    \"\"\" 310 origin = list(subgraph.nodes())[0] 311 nrep = len(repgraph) // nmol # number of replicas 312 313 def _next(_reporigin): 314 for _repnei in nx.neighbors(repgraph, _reporigin): 315 _origin = _reporigin % nmol 316 _nei = _repnei % nmol 317 if _nei in nx.neighbors(subgraph, _origin) and not replica.has_edge( 318 _reporigin, _repnei 319 ): 320 replica.add_edge(_reporigin, _repnei) 321 _next(_repnei) 322 323 for rep in range(nrep): 324 reporigin = origin + nmol * rep 325 replica = nx.Graph() 326 _next(reporigin) 327 yield replica </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5358\u4f4d\u80de\u5185\u306e subgraph \u306e\u5404\u30ec\u30d7\u30ea\u30ab\u3092 repgraph \u304b\u3089\u53d6\u308a\u51fa\u3057\u3066 yield \u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>Args:     repgraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002     subgraph: \u5358\u4f4d\u80de\u5185\u306e\u90e8\u5206\u30b0\u30e9\u30d5\uff08\u4f8b: 1\u30b1\u30fc\u30b8\u3092\u69cb\u6210\u3059\u308b\u30ce\u30fc\u30c9\u3068\u8fba\uff09\u3002     nmol: \u5358\u4f4d\u80de\u5185\u306e\u30ce\u30fc\u30c9\u6570\u3002</p> <p>Yields:     \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u5404\u30ec\u30d7\u30ea\u30ab\u306b\u5bfe\u5fdc\u3059\u308b\u90e8\u5206\u30b0\u30e9\u30d5\uff08nx.Graph\uff09\u3002</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"cell\"&gt;\n                        &lt;input id=\"cell-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def cell( unitcell: genice3.unitcell.UnitCell, replication_matrix: numpy.ndarray) -&gt; numpy.ndarray: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#cell\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"cell-338\"&gt;&lt;a href=\"#cell-338\"&gt;&lt;span class=\"linenos\"&gt;338&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>339def cell(unitcell: UnitCell, replication_matrix: np.ndarray) -&gt; np.ndarray: 340 \"\"\"\u62e1\u5927\u5358\u4f4d\u80de\u306e\u30bb\u30eb\u884c\u5217\"\"\" 341 return unitcell.cell @ replication_matrix </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u62e1\u5927\u5358\u4f4d\u80de\u306e\u30bb\u30eb\u884c\u5217&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"replica_vectors\"&gt;\n                        &lt;input id=\"replica_vectors-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def replica_vectors(replication_matrix: numpy.ndarray) -&gt; numpy.ndarray: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#replica_vectors\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"replica_vectors-344\"&gt;&lt;a href=\"#replica_vectors-344\"&gt;&lt;span class=\"linenos\"&gt;344&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>345def replica_vectors(replication_matrix: np.ndarray) -&gt; np.ndarray: 346 \"\"\"\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u3092\u8a08\u7b97\u3059\u308b\u3002 347 348    \u62e1\u5927\u5358\u4f4d\u80de\u3092\u69cb\u6210\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u3001\u5143\u306e\u5358\u4f4d\u80de\u306e\u30b0\u30ea\u30c3\u30c9\u4f4d\u7f6e\u3092\u8868\u3059 349    \u6574\u6570\u30d9\u30af\u30c8\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u5404\u30d9\u30af\u30c8\u30eb\u306f\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e 350    \u5358\u4f4d\u80de\u306e\u76f8\u5bfe\u4f4d\u7f6e\u3092\u8868\u3057\u307e\u3059\u3002 351 352    Args: 353        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217 354 355    Returns: 356        np.ndarray: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\uff08Nx3\u914d\u5217\u3001N\u306f\u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u5358\u4f4d\u80de\u6570\uff09 357    \"\"\" 358 i, j, k = np.array(replication_matrix) 359 corners = np.array( 360 [a i + b j + c k for a in (0, 1) for b in (0, 1) for c in (0, 1)] 361 ) 362 363 mins = np.min(corners, axis=0) 364 maxs = np.max(corners, axis=0) 365 _genice3_logger.debug(f\"  {mins=}, {maxs=}\") 366 367 det = abs(np.linalg.det(replication_matrix)) 368 det = np.floor(det + 0.5).astype(int) 369 invdet = np.floor(np.linalg.inv(replication_matrix) det + 0.5).astype(int) 370 371 vecs = set() 372 for a in range(mins[0], maxs[0] + 1): 373 for b in range(mins[1], maxs[1] + 1): 374 for c in range(mins[2], maxs[2] + 1): 375 abc = np.array([a, b, c]) 376 rep = grandcell_wrap(abc, replication_matrix, invdet, det).astype(int) 377 if tuple(rep) not in vecs: 378 vecs.add(tuple(rep)) 379 380 vecs = np.array(list(vecs)) 381 vol = abs(np.linalg.det(replication_matrix)) 382 if not np.allclose(vol, len(vecs)): 383 raise ValueError( 384 f\"replication_matrix determinant ({vol}) must equal number of \" 385 f\"replica vectors ({len(vecs)})\" 386 ) 387 return vecs <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u3092\u8a08\u7b97\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u62e1\u5927\u5358\u4f4d\u80de\u3092\u69cb\u6210\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u3001\u5143\u306e\u5358\u4f4d\u80de\u306e\u30b0\u30ea\u30c3\u30c9\u4f4d\u7f6e\u3092\u8868\u3059 \u6574\u6570\u30d9\u30af\u30c8\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u5404\u30d9\u30af\u30c8\u30eb\u306f\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e \u5358\u4f4d\u80de\u306e\u76f8\u5bfe\u4f4d\u7f6e\u3092\u8868\u3057\u307e\u3059\u3002</p> <p>Args:     replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217</p> <p>Returns:     np.ndarray: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\uff08Nx3\u914d\u5217\u3001N\u306f\u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u5358\u4f4d\u80de\u6570\uff09</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"replica_vector_labels\"&gt;\n                        &lt;input id=\"replica_vector_labels-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def replica_vector_labels(replica_vectors: numpy.ndarray) -&gt; Dict[Tuple[int, ...], int]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#replica_vector_labels\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"replica_vector_labels-390\"&gt;&lt;a href=\"#replica_vector_labels-390\"&gt;&lt;span class=\"linenos\"&gt;390&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>391def replica_vector_labels(replica_vectors: np.ndarray) -&gt; Dict[Tuple[int, ...], int]: 392 \"\"\"\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb \u2192 \u4e00\u610f\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002 393 394    \u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e\u5358\u4f4d\u80de\u306e\u4f4d\u7f6e\u3092\u3001\u30b0\u30e9\u30d5\u8907\u88fd\u306a\u3069\u3067\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3002 395 396    Args: 397        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\uff08Nx3\uff09\u3002 398 399    Returns: 400        \u5ea7\u6a19\u30bf\u30d7\u30eb (a, b, c) \u3092 0..N-1 \u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u8f9e\u66f8\u3002 401    \"\"\" 402 return {tuple(xyz): i for i, xyz in enumerate(replica_vectors)} </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb \u2192 \u4e00\u610f\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002&lt;/p&gt;\n</code></pre> <p>\u62e1\u5927\u5358\u4f4d\u80de\u5185\u3067\u306e\u5358\u4f4d\u80de\u306e\u4f4d\u7f6e\u3092\u3001\u30b0\u30e9\u30d5\u8907\u88fd\u306a\u3069\u3067\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3002</p> <p>Args:     replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\uff08Nx3\uff09\u3002</p> <p>Returns:     \u5ea7\u6a19\u30bf\u30d7\u30eb (a, b, c) \u3092 0..N-1 \u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u8f9e\u66f8\u3002</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"graph\"&gt;\n                        &lt;input id=\"graph-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def graph( unitcell: genice3.unitcell.UnitCell, replica_vectors: numpy.ndarray, replica_vector_labels: Dict[Tuple[int, ...], int], replication_matrix: numpy.ndarray) -&gt; networkx.classes.graph.Graph: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#graph\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"graph-405\"&gt;&lt;a href=\"#graph-405\"&gt;&lt;span class=\"linenos\"&gt;405&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>406def graph( 407 unitcell: UnitCell, 408 replica_vectors: np.ndarray, 409 replica_vector_labels: Dict[Tuple[int, ...], int], 410 replication_matrix: np.ndarray, 411) -&gt; nx.Graph: 412 \"\"\"\u62e1\u5927\u5358\u4f4d\u80de\u306b\u5bfe\u5fdc\u3059\u308b\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u3002 413 414    \u57fa\u672c\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\uff08\u6c34\u5206\u5b50\u9593\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u3092\u3001 415    \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u3066\u7d71\u5408\u3057\u305f\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3057\u307e\u3059\u3002 416    \u3053\u306e\u30b0\u30e9\u30d5\u306f\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u9593\u306e\u63a5\u7d9a\u95a2\u4fc2\u3092\u8868\u3057\u307e\u3059\u3002 417 418    Args: 419        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 420        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217 421        replica_vector_labels: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb\u2192\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u8f9e\u66f8\uff08replica_vector_labels \u30bf\u30b9\u30af\u306e\u623b\u308a\u5024\uff09 422        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217 423 424    Returns: 425        nx.Graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u3059\u7121\u5411\u30b0\u30e9\u30d5 426    \"\"\" 427 g = _replicate_graph( 428 unitcell.graph, 429 unitcell.lattice_sites, 430 replica_vectors, 431 replica_vector_index=replica_vector_labels, 432 reshape=replication_matrix, 433 ) 434 getLogger(name).info(\"graph: %s\", _graph_degree_stats(g)) 435 return g </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u62e1\u5927\u5358\u4f4d\u80de\u306b\u5bfe\u5fdc\u3059\u308b\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u57fa\u672c\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\uff08\u6c34\u5206\u5b50\u9593\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u3092\u3001 \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u3066\u7d71\u5408\u3057\u305f\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3057\u307e\u3059\u3002 \u3053\u306e\u30b0\u30e9\u30d5\u306f\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u9593\u306e\u63a5\u7d9a\u95a2\u4fc2\u3092\u8868\u3057\u307e\u3059\u3002</p> <p>Args:     unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8     replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217     replica_vector_labels: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u5ea7\u6a19\u30bf\u30d7\u30eb\u2192\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u8f9e\u66f8\uff08replica_vector_labels \u30bf\u30b9\u30af\u306e\u623b\u308a\u5024\uff09     replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217</p> <p>Returns:     nx.Graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u3059\u7121\u5411\u30b0\u30e9\u30d5</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"lattice_sites\"&gt;\n                        &lt;input id=\"lattice_sites-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def lattice_sites( unitcell: genice3.unitcell.UnitCell, replica_vectors: numpy.ndarray, replication_matrix: numpy.ndarray) -&gt; numpy.ndarray: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#lattice_sites\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"lattice_sites-438\"&gt;&lt;a href=\"#lattice_sites-438\"&gt;&lt;span class=\"linenos\"&gt;438&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>439def lattice_sites( 440 unitcell: UnitCell, 441 replica_vectors: np.ndarray, 442 replication_matrix: np.ndarray, 443) -&gt; np.ndarray: 444 \"\"\"\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002 445 446    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u307e\u3059\u3002 447    \u5404\u6c34\u5206\u5b50\u306e\u4f4d\u7f6e\u306f\u3001\u5358\u4f4d\u80de\u306e\u5468\u671f\u5883\u754c\u6761\u4ef6\u306b\u5f93\u3063\u3066\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002 448 449    Args: 450        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 451        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217 452        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217 453 454    Returns: 455        np.ndarray: \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\uff08Nx3\u914d\u5217\u3001N\u306f\u6c34\u5206\u5b50\u6570\uff09 456    \"\"\" 457 return replicate_positions( 458 unitcell.lattice_sites, replica_vectors, replication_matrix 459 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u57fa\u672c\u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u307e\u3059\u3002 \u5404\u6c34\u5206\u5b50\u306e\u4f4d\u7f6e\u306f\u3001\u5358\u4f4d\u80de\u306e\u5468\u671f\u5883\u754c\u6761\u4ef6\u306b\u5f93\u3063\u3066\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002</p> <p>Args:     unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8     replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217     replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217</p> <p>Returns:     np.ndarray: \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\uff08Nx3\u914d\u5217\u3001N\u306f\u6c34\u5206\u5b50\u6570\uff09</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"anions\"&gt;\n                        &lt;input id=\"anions-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def anions( unitcell: genice3.unitcell.UnitCell, replica_vectors: numpy.ndarray, spot_anions: Dict[int, str]) -&gt; Dict[int, str]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#anions\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"anions-462\"&gt;&lt;a href=\"#anions-462\"&gt;&lt;span class=\"linenos\"&gt;462&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>463def anions( 464 unitcell: UnitCell, replica_vectors: np.ndarray, spot_anions: Dict[int, str] 465) -&gt; Dict[int, str]: 466 \"\"\"\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u914d\u7f6e\u60c5\u5831\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002 467 468    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u3068\u3001spot_anions\u3067\u6307\u5b9a\u3055\u308c\u305f 469    \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u8fd4\u3057\u307e\u3059\u3002 470 471    Args: 472        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 473        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217 474        spot_anions: \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u306e\u8f9e\u66f8\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09 475 476    Returns: 477        Dict[int, str]: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09 478    \"\"\" 479 anion_dict: Dict[int, str] = {} 480 Z = len(unitcell.lattice_sites) 481 for site_index, ion_name in unitcell.anions.items(): 482 for i in range(len(replica_vectors)): 483 site = i * Z + site_index 484 anion_dict[site] = ion_name 485 for site_index, ion_name in spot_anions.items(): 486 anion_dict[site_index] = ion_name 487 return anion_dict </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u914d\u7f6e\u60c5\u5831\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u3068\u3001spot_anions\u3067\u6307\u5b9a\u3055\u308c\u305f \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <p>Args:     unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8     replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217     spot_anions: \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u306e\u8f9e\u66f8\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09</p> <p>Returns:     Dict[int, str]: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"cations\"&gt;\n                        &lt;input id=\"cations-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def cations( unitcell: genice3.unitcell.UnitCell, replica_vectors: numpy.ndarray, spot_cations: Dict[int, str]) -&gt; Dict[int, str]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#cations\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"cations-490\"&gt;&lt;a href=\"#cations-490\"&gt;&lt;span class=\"linenos\"&gt;490&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>491def cations( 492 unitcell: UnitCell, replica_vectors: np.ndarray, spot_cations: Dict[int, str] 493) -&gt; Dict[int, str]: 494 \"\"\"\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u914d\u7f6e\u60c5\u5831\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002 495 496    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u3068\u3001spot_cations\u3067\u6307\u5b9a\u3055\u308c\u305f 497    \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u8fd4\u3057\u307e\u3059\u3002 498 499    Args: 500        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 501        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217 502        spot_cations: \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u306e\u8f9e\u66f8\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09 503 504    Returns: 505        Dict[int, str]: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09 506    \"\"\" 507 cation_dict: Dict[int, str] = {} 508 Z = len(unitcell.lattice_sites) 509 for site_index, ion_name in unitcell.cations.items(): 510 for i in range(len(replica_vectors)): 511 site = i * Z + site_index 512 cation_dict[site] = ion_name 513 for site_index, ion_name in spot_cations.items(): 514 cation_dict[site_index] = ion_name 515 return cation_dict </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u914d\u7f6e\u60c5\u5831\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u3068\u3001spot_cations\u3067\u6307\u5b9a\u3055\u308c\u305f \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <p>Args:     unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8     replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217     spot_cations: \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u306e\u8f9e\u66f8\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09</p> <p>Returns:     Dict[int, str]: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\uff09</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"site_occupants\"&gt;\n                        &lt;input id=\"site_occupants-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def site_occupants( anions: Dict[int, str], cations: Dict[int, str], spot_hydroniums: List[int], spot_hydroxides: List[int], lattice_sites: numpy.ndarray) -&gt; List[str]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#site_occupants\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"site_occupants-518\"&gt;&lt;a href=\"#site_occupants-518\"&gt;&lt;span class=\"linenos\"&gt;518&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>519def site_occupants( 520 anions: Dict[int, str], 521 cations: Dict[int, str], 522 spot_hydroniums: List[int], 523 spot_hydroxides: List[int], 524 lattice_sites: np.ndarray, 525) -&gt; List[str]: 526 \"\"\"\u5404\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u5360\u6709\u7a2e\uff08\u6c34\u5206\u5b50\u30fb\u30a4\u30aa\u30f3\u30fbH3O+\u30fbOH-\uff09\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002 527 528    \u5404\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u5206\u5b50\u3001\u30a2\u30cb\u30aa\u30f3\u3001\u30ab\u30c1\u30aa\u30f3\u3001H3O+\u3001OH- \u306e\u3044\u305a\u308c\u3067\u5360\u6709\u3055\u308c\u3066\u3044\u308b\u304b\u3092 529    \u5224\u5b9a\u3057\u3001\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u9806\u306b\u30ea\u30b9\u30c8\u3068\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002 530 531    Args: 532        anions: \u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8 533        cations: \u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8 534        spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8 535        spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8 536        lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217 537 538    Returns: 539        List[str]: \u5404\u30b5\u30a4\u30c8\u306e\u5360\u6709\u7a2e\u306e\u30ea\u30b9\u30c8\uff08\"water\" \u307e\u305f\u306f\u30a4\u30aa\u30f3\u540d\uff09 540    \"\"\" 541 occupants = [\"water\"] * len(lattice_sites) 542 for site, ion_name in anions.items(): 543 occupants[site] = ion_name 544 for site, ion_name in cations.items(): 545 occupants[site] = ion_name 546 for site in spot_hydroniums: 547 occupants[site] = \"H3O+\" 548 for site in spot_hydroxides: 549 occupants[site] = \"OH-\" 550 return occupants </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5404\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u5360\u6709\u7a2e\uff08\u6c34\u5206\u5b50\u30fb\u30a4\u30aa\u30f3\u30fbH3O+\u30fbOH-\uff09\u306e\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u5404\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u5206\u5b50\u3001\u30a2\u30cb\u30aa\u30f3\u3001\u30ab\u30c1\u30aa\u30f3\u3001H3O+\u3001OH- \u306e\u3044\u305a\u308c\u3067\u5360\u6709\u3055\u308c\u3066\u3044\u308b\u304b\u3092 \u5224\u5b9a\u3057\u3001\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u9806\u306b\u30ea\u30b9\u30c8\u3068\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002</p> <p>Args:     anions: \u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8     cations: \u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8     spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8     spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8     lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217</p> <p>Returns:     List[str]: \u5404\u30b5\u30a4\u30c8\u306e\u5360\u6709\u7a2e\u306e\u30ea\u30b9\u30c8\uff08\"water\" \u307e\u305f\u306f\u30a4\u30aa\u30f3\u540d\uff09</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"fixed_edges\"&gt;\n                        &lt;input id=\"fixed_edges-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def fixed_edges( graph: networkx.classes.graph.Graph, unitcell: genice3.unitcell.UnitCell, spot_anions: Dict[int, str], spot_cations: Dict[int, str], spot_hydroniums: List[int], spot_hydroxides: List[int], bjerrum_L_edges: List[Tuple[int, int]], bjerrum_D_edges: List[Tuple[int, int]]) -&gt; networkx.classes.digraph.DiGraph: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#fixed_edges\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"fixed_edges-553\"&gt;&lt;a href=\"#fixed_edges-553\"&gt;&lt;span class=\"linenos\"&gt;553&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>554def fixed_edges( 555 graph: nx.Graph, 556 unitcell: UnitCell, 557 spot_anions: Dict[int, str], 558 spot_cations: Dict[int, str], 559 spot_hydroniums: List[int], 560 spot_hydroxides: List[int], 561 bjerrum_L_edges: List[Tuple[int, int]], 562 bjerrum_D_edges: List[Tuple[int, int]], 563) -&gt; nx.DiGraph: 564 \"\"\"\u56fa\u5b9a\u30a8\u30c3\u30b8\uff08\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u56fa\u5b9a\u3055\u308c\u305f\u30a8\u30c3\u30b8\uff09\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002 565 566    \u57fa\u672c\u5358\u4f4d\u80de\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u56fa\u5b9a\u30a8\u30c3\u30b8\u3068\u3001spot_anions/spot_cations/spot_hydroniums/ 567    spot_hydroxides \u3067\u6307\u5b9a\u3055\u308c\u305f\u30a4\u30aa\u30f3\u30fb\u7f6e\u63db\u7a2e\u306b\u57fa\u3065\u304f\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u7d71\u5408\u3057\u3001 568    \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8fd4\u3057\u307e\u3059\u3002 569    - \u30a2\u30cb\u30aa\u30f3: 4\u672c\u53d7\u3051\u5165\u308c\u3002\u30ab\u30c1\u30aa\u30f3: 4\u672c\u4f9b\u4e0e\u3002 570    - H3O+ (spot_hydroniums): 1\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002 571    - OH- (spot_hydroxides): 3\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002 572 573    Args: 574        graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u30b0\u30e9\u30d5 575        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 576        spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e 577        spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e 578        spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff081\u53d7\u5bb9\u30fb3\u4f9b\u4e0e\uff09 579        spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff083\u53d7\u5bb9\u30fb1\u4f9b\u4e0e\uff09 580 581    Returns: 582        nx.DiGraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8868\u3059\u6709\u5411\u30b0\u30e9\u30d5 583    \"\"\" 584 if ( 585 spot_anions 586 or spot_cations 587 or spot_hydroniums 588 or spot_hydroxides 589 or bjerrum_L_edges 590 or bjerrum_D_edges 591 ) and not unitcell.SUPPORTS_ION_DOPING: 592 raise ConfigurationError( 593 \"Ion doping (spot_anion/spot_cation/spot_hydronium/spot_hydroxide) \" 594 \"is not supported for hydrogen-ordered ices.\" 595 ) 596 dg = _replicate_fixed_edges(graph, unitcell.fixed, len(unitcell.lattice_sites)) 597 for site_index in spot_anions: 598 for nei in graph.neighbors(site_index): 599 if dg.has_edge(site_index, nei): 600 raise ConfigurationError( 601 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {site_index}; \u3059\u3067\u306b({site_index} --&gt; {nei})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\" 602 ) 603 else: 604 dg.add_edge(nei, site_index) 605 for site_index in spot_cations: 606 for nei in graph.neighbors(site_index): 607 if dg.has_edge(nei, site_index): 608 raise ConfigurationError( 609 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {site_index}; \u3059\u3067\u306b({nei} --&gt; {site_index})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\" 610 ) 611 else: 612 dg.add_edge(site_index, nei) 613 for site_index in spot_hydroniums: 614 neis = sorted(graph.neighbors(site_index)) 615 if len(neis) != 4: 616 raise ConfigurationError( 617 f\"spot_hydronium at {site_index} must have 4 neighbors, got {len(neis)}.\" 618 ) 619 dg.add_edge(neis[0], site_index) 620 for nei in neis[1:]: 621 dg.add_edge(site_index, nei) 622 for site_index in spot_hydroxides: 623 neis = sorted(graph.neighbors(site_index)) 624 if len(neis) != 4: 625 raise ConfigurationError( 626 f\"spot_hydroxide at {site_index} must have 4 neighbors, got {len(neis)}.\" 627 ) 628 dg.add_edge(site_index, neis[0]) 629 for nei in neis[1:]: 630 dg.add_edge(nei, site_index) 631 # Bjerrum L \u6b20\u9665: i \u30ce\u30fc\u30c9\u3092 hydronium \u3068\u540c\u69d8\u306b\u6271\u3046\u3002 632 for i, j in bjerrum_L_edges or []: 633 neis = sorted(graph.neighbors(i)) 634 if len(neis) != 4: 635 raise ConfigurationError( 636 f\"bjerrum_L at {i} must have 4 neighbors, got {len(neis)}.\" 637 ) 638 if j not in neis: 639 raise ConfigurationError( 640 f\"bjerrum_L edge ({i}, {j}) is not an edge in the graph.\" 641 ) 642 # \u53d7\u5bb9\u5074\u3068\u306a\u308b\u96a3\u63a5\u30ce\u30fc\u30c9\u3092 j \u4ee5\u5916\u304b\u3089 1 \u3064\u9078\u3076 643 acceptor = next((nei for nei in neis if nei != j), None) 644 if acceptor is None: 645 raise ConfigurationError( 646 f\"bjerrum_L at {i} cannot choose acceptor neighbor distinct from {j}.\" 647 ) 648 # hydronium \u3068\u540c\u69d8\u306e\u30c1\u30a7\u30c3\u30af\u30fb\u8ffd\u52a0\u30ed\u30b8\u30c3\u30af 649 for nei in neis: 650 if nei == acceptor: 651 # nei -&gt; i \uff08\u53d7\u5bb9\uff09 652 if dg.has_edge(i, nei): 653 raise ConfigurationError( 654 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({i} --&gt; {nei})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\" 655 ) 656 dg.add_edge(nei, i) 657 else: 658 # i -&gt; nei \uff08\u4f9b\u4e0e\uff09 659 if dg.has_edge(nei, i): 660 raise ConfigurationError( 661 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({nei} --&gt; {i})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\" 662 ) 663 dg.add_edge(i, nei) 664 # Bjerrum D \u6b20\u9665: i \u30ce\u30fc\u30c9\u3092 hydroxide \u3068\u540c\u69d8\u306b\u6271\u3046\uff08\u305f\u3060\u3057 j \u306f\u4f9b\u4e0e\u5074\u306b\u3057\u306a\u3044\uff09\u3002 665 for i, j in bjerrum_D_edges or []: 666 neis = sorted(graph.neighbors(i)) 667 if len(neis) != 4: 668 raise ConfigurationError( 669 f\"bjerrum_D at {i} must have 4 neighbors, got {len(neis)}.\" 670 ) 671 if j not in neis: 672 raise ConfigurationError( 673 f\"bjerrum_D edge ({i}, {j}) is not an edge in the graph.\" 674 ) 675 # \u4f9b\u4e0e\u5074\u3068\u306a\u308b\u96a3\u63a5\u30ce\u30fc\u30c9\u3092 j \u4ee5\u5916\u304b\u3089 1 \u3064\u9078\u3076 676 donor = next((nei for nei in neis if nei != j), None) 677 if donor is None: 678 raise ConfigurationError( 679 f\"bjerrum_D at {i} cannot choose donor neighbor distinct from {j}.\" 680 ) 681 for nei in neis: 682 if nei == donor: 683 # i -&gt; nei \uff08\u4f9b\u4e0e\uff09 684 if dg.has_edge(nei, i): 685 raise ConfigurationError( 686 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({nei} --&gt; {i})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\" 687 ) 688 dg.add_edge(i, nei) 689 else: 690 # nei -&gt; i \uff08\u53d7\u5bb9\uff09 691 if dg.has_edge(i, nei): 692 raise ConfigurationError( 693 f\"\u77db\u76fe\u3059\u308b\u8fba\u306e\u56fa\u5b9a at {i}; \u3059\u3067\u306b({i} --&gt; {nei})\u304c\u56fa\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\" 694 ) 695 dg.add_edge(nei, i) 696 return dg </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u56fa\u5b9a\u30a8\u30c3\u30b8\uff08\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u56fa\u5b9a\u3055\u308c\u305f\u30a8\u30c3\u30b8\uff09\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u57fa\u672c\u5358\u4f4d\u80de\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u56fa\u5b9a\u30a8\u30c3\u30b8\u3068\u3001spot_anions/spot_cations/spot_hydroniums/ spot_hydroxides \u3067\u6307\u5b9a\u3055\u308c\u305f\u30a4\u30aa\u30f3\u30fb\u7f6e\u63db\u7a2e\u306b\u57fa\u3065\u304f\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u7d71\u5408\u3057\u3001 \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <ul> <li>\u30a2\u30cb\u30aa\u30f3: 4\u672c\u53d7\u3051\u5165\u308c\u3002\u30ab\u30c1\u30aa\u30f3: 4\u672c\u4f9b\u4e0e\u3002</li> <li>H3O+ (spot_hydroniums): 1\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002</li> <li>OH- (spot_hydroxides): 3\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002</li> </ul> <p>Args:     graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u30b0\u30e9\u30d5     unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8     spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e     spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e     spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff081\u53d7\u5bb9\u30fb3\u4f9b\u4e0e\uff09     spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff083\u53d7\u5bb9\u30fb1\u4f9b\u4e0e\uff09</p> <p>Returns:     nx.DiGraph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3092\u8868\u3059\u6709\u5411\u30b0\u30e9\u30d5</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"digraph\"&gt;\n                        &lt;input id=\"digraph-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def digraph( graph: networkx.classes.graph.Graph, depol_loop: int, lattice_sites: numpy.ndarray, fixed_edges: networkx.classes.digraph.DiGraph, target_pol: numpy.ndarray, bjerrum_L_edges: List[Tuple[int, int]], bjerrum_D_edges: List[Tuple[int, int]]) -&gt; networkx.classes.digraph.DiGraph: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#digraph\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"digraph-699\"&gt;&lt;a href=\"#digraph-699\"&gt;&lt;span class=\"linenos\"&gt;699&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>700def digraph( 701 graph: nx.Graph, 702 depol_loop: int, 703 lattice_sites: np.ndarray, 704 fixed_edges: nx.DiGraph, 705 target_pol: np.ndarray, 706 bjerrum_L_edges: List[Tuple[int, int]], 707 bjerrum_D_edges: List[Tuple[int, int]], 708) -&gt; nx.DiGraph: 709 \"\"\"\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u3002 710 711    \u7121\u5411\u30b0\u30e9\u30d5\uff08\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u304b\u3089\u3001\u5404\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\uff08\u30d7\u30ed\u30c8\u30f3\u306e\u5411\u304d\uff09 712    \u3092\u6c7a\u5b9a\u3057\u3066\u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u56fa\u5b9a\u30a8\u30c3\u30b8\u3067\u6307\u5b9a\u3055\u308c\u305f\u65b9\u5411\u306f\u7dad\u6301\u3055\u308c\u3001 713    \u305d\u308c\u4ee5\u5916\u306e\u30a8\u30c3\u30b8\u306f\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3088\u308a\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002 714 715    Args: 716        graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5 717        depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570 718        lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217 719        fixed_edges: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u306e\u6709\u5411\u30b0\u30e9\u30d5 720        target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024 721 722    Returns: 723        nx.DiGraph: \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5 724    \"\"\" 725 for edge in fixed_edges.edges(): 726 _genice3_logger.debug(f\"+ {edge=}\") 727 dg = genice_core.ice_graph( 728 graph, 729 vertex_positions=lattice_sites, 730 is_periodic_boundary=True, 731 dipole_optimization_cycles=depol_loop, 732 fixed_edges=fixed_edges, 733 pairing_attempts=1000, 734 target_pol=target_pol, 735 ) 736 if not dg: 737 raise ConfigurationError(\"Failed to generate a directed graph.\") 738 # Bjerrum L \u6b20\u9665: \u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u3092\u524a\u9664\u3059\u308b\uff08\u4e21\u65b9\u5411\u3068\u3082\u53d6\u308a\u9664\u304f\uff09 739 for edge in bjerrum_L_edges or []: 740 i, j = edge 741 if dg.has_edge(i, j): 742 dg.remove_edge(i, j) 743 if dg.has_edge(j, i): 744 dg.remove_edge(j, i) 745 # Bjerrum D \u6b20\u9665: \u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u3092\u4e21\u65b9\u5411\u3068\u3082\u5b58\u5728\u3055\u305b\u308b 746 for edge in bjerrum_D_edges or []: 747 i, j = edge 748 if not dg.has_edge(i, j): 749 dg.add_edge(i, j) 750 if not dg.has_edge(j, i): 751 dg.add_edge(j, i) 752 return dg </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u7121\u5411\u30b0\u30e9\u30d5\uff08\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09\u304b\u3089\u3001\u5404\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\uff08\u30d7\u30ed\u30c8\u30f3\u306e\u5411\u304d\uff09 \u3092\u6c7a\u5b9a\u3057\u3066\u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u56fa\u5b9a\u30a8\u30c3\u30b8\u3067\u6307\u5b9a\u3055\u308c\u305f\u65b9\u5411\u306f\u7dad\u6301\u3055\u308c\u3001 \u305d\u308c\u4ee5\u5916\u306e\u30a8\u30c3\u30b8\u306f\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3088\u308a\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002</p> <p>Args:     graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5     depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570     lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217     fixed_edges: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u306e\u6709\u5411\u30b0\u30e9\u30d5     target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024</p> <p>Returns:     nx.DiGraph: \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"orientations\"&gt;\n                        &lt;input id=\"orientations-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def orientations( lattice_sites: numpy.ndarray, digraph: networkx.classes.digraph.DiGraph, cell: numpy.ndarray, anions: Dict[int, str], cations: Dict[int, str], spot_hydroniums: List[int], spot_hydroxides: List[int]) -&gt; numpy.ndarray: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#orientations\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"orientations-755\"&gt;&lt;a href=\"#orientations-755\"&gt;&lt;span class=\"linenos\"&gt;755&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>756def orientations( 757 lattice_sites: np.ndarray, 758 digraph: nx.DiGraph, 759 cell: np.ndarray, 760 anions: Dict[int, str], 761 cations: Dict[int, str], 762 spot_hydroniums: List[int], 763 spot_hydroxides: List[int], 764) -&gt; np.ndarray: 765 \"\"\"\u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\u3092\u8a08\u7b97\u3059\u308b\u3002 766 767    \u6709\u5411\u30b0\u30e9\u30d5\u3067\u6c7a\u5b9a\u3055\u308c\u305f\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u306b\u57fa\u3065\u3044\u3066\u3001\u5404\u6c34\u5206\u5b50\u306e 768    \u914d\u5411\uff08\u56de\u8ee2\u884c\u5217\uff09\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u6c34\u5206\u5b50\u306eOH\u30d9\u30af\u30c8\u30eb\u306e\u65b9\u5411\u304b\u3089 769    \u5206\u5b50\u5168\u4f53\u306e\u914d\u5411\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002 770 771    Args: 772        lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217 773        digraph: \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5 774        cell: \u62e1\u5927\u5358\u4f4d\u80de\u306e\u30bb\u30eb\u884c\u5217 775        anions: \u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8 776        cations: \u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8 777        spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8 778        spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8 779 780    Returns: 781        np.ndarray: \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\uff08Nx3x3\u914d\u5217\u3001N\u306f\u6c34\u5206\u5b50\u6570\uff09 782    \"\"\" 783 return _assume_water_orientations( 784 lattice_sites, 785 digraph, 786 cell, 787 set(anions) | set(cations) | set(spot_hydroniums) | set(spot_hydroxides), 788 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\u3092\u8a08\u7b97\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u6709\u5411\u30b0\u30e9\u30d5\u3067\u6c7a\u5b9a\u3055\u308c\u305f\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u306b\u57fa\u3065\u3044\u3066\u3001\u5404\u6c34\u5206\u5b50\u306e \u914d\u5411\uff08\u56de\u8ee2\u884c\u5217\uff09\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u6c34\u5206\u5b50\u306eOH\u30d9\u30af\u30c8\u30eb\u306e\u65b9\u5411\u304b\u3089 \u5206\u5b50\u5168\u4f53\u306e\u914d\u5411\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p> <p>Args:     lattice_sites: \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217     digraph: \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5     cell: \u62e1\u5927\u5358\u4f4d\u80de\u306e\u30bb\u30eb\u884c\u5217     anions: \u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8     cations: \u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u306e\u8f9e\u66f8     spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8     spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8</p> <p>Returns:     np.ndarray: \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\uff08Nx3x3\u914d\u5217\u3001N\u306f\u6c34\u5206\u5b50\u6570\uff09</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"cages\"&gt;\n                        &lt;input id=\"cages-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @reactive def cages( unitcell: genice3.unitcell.UnitCell, replica_vectors: numpy.ndarray, replication_matrix: numpy.ndarray, graph: networkx.classes.graph.Graph) -&gt; genice3.cage.CageSpecs | None: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#cages\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"cages-791\"&gt;&lt;a href=\"#cages-791\"&gt;&lt;span class=\"linenos\"&gt;791&lt;/span&gt;&lt;/a&gt;&lt;span class=\"nd\"&gt;@reactive&lt;/span&gt;\n</code></pre> <p>792def cages( 793 unitcell: UnitCell, 794 replica_vectors: np.ndarray, 795 replication_matrix: np.ndarray, 796 graph: nx.Graph, 797) -&gt; CageSpecs | None: 798 \"\"\"\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002 799 800    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b2\u30b9\u30c8\u5206\u5b50\u3092\u914d\u7f6e\u3059\u308b\u305f\u3081\u306e\u30b1\u30fc\u30b8\uff08\u7a7a\u9699\uff09\u306e 801    \u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3092\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002 802 803    Args: 804        unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 805        replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\u3002 806        replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002 807        graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\uff08\u30b5\u30d6\u30b0\u30e9\u30d5\u8907\u88fd\u306b\u4f7f\u7528\uff09\u3002 808 809    Returns: 810        CageSpecs: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3002 811        unitcell.cages \u304c None \u306e\u5834\u5408\u306f None\u3002 812    \"\"\" 813 if unitcell.cages is None: 814 return None 815 # \u30b1\u30fc\u30b8\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\uff08\u7a7a\u306e\u914d\u5217\uff09\u306e\u51e6\u7406 816 if len(unitcell.cages.positions) == 0: 817 return CageSpecs(positions=np.array([]).reshape(0, 3), specs=[]) 818 repcagepos = replicate_positions( 819 unitcell.cages.positions, replica_vectors, replication_matrix 820 ) 821 num_cages_in_unitcell = len(unitcell.cages.positions) 822 823 # replicate_subgraph\u306f\u30b1\u30fc\u30b8\u4e00\u500b\u305a\u3064\u3092replicate\u3059\u308b\u304c\u3001repcagespecs\u306e\u4e26\u3073\u9806\u306f\u5358\u4f4d\u80de\u5358\u4f4d\u3002 824 repcagespecs = [None] len(repcagepos) 825 for i, cage in enumerate(unitcell.cages.specs): 826 for j, repgraph in enumerate( 827 replicate_subgraph(graph, cage.graph, unitcell.lattice_sites.shape[0]) 828 ): 829 repcagespecs[i + j num_cages_in_unitcell] = CageSpec( 830 cage_type=cage.cage_type, faces=cage.faces, graph=repgraph 831 ) 832 # unit cell\u306ecages\u3068\u540c\u3058\u69cb\u9020\u3002 833 _genice3_logger.debug(f\"{repcagepos=}, {repcagespecs=}\") 834 return CageSpecs(positions=repcagepos, specs=repcagespecs) <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>\u57fa\u672c\u5358\u4f4d\u80de\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b2\u30b9\u30c8\u5206\u5b50\u3092\u914d\u7f6e\u3059\u308b\u305f\u3081\u306e\u30b1\u30fc\u30b8\uff08\u7a7a\u9699\uff09\u306e \u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3092\u3001\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3059\u308b\u3002</p> <p>Args:     unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002     replica_vectors: \u30ec\u30d7\u30ea\u30ab\u30d9\u30af\u30c8\u30eb\u306e\u914d\u5217\u3002     replication_matrix: \u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002     graph: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u7121\u5411\u30b0\u30e9\u30d5\uff08\u30b5\u30d6\u30b0\u30e9\u30d5\u8907\u88fd\u306b\u4f7f\u7528\uff09\u3002</p> <p>Returns:     CageSpecs: \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3068\u30bf\u30a4\u30d7\u3002     unitcell.cages \u304c None \u306e\u5834\u5408\u306f None\u3002</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"place_groups_on_lattice\"&gt;\n                        &lt;input id=\"place_groups_on_lattice-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def place_groups_on_lattice( genice: GenIce3, spot_cation_groups: Dict[int, Dict[int, str]]) -&gt; None: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#place_groups_on_lattice\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"place_groups_on_lattice-837\"&gt;&lt;a href=\"#place_groups_on_lattice-837\"&gt;&lt;span class=\"linenos\"&gt;837&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;place_groups_on_lattice&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;\n</code></pre> <p>838 genice: \"GenIce3\", 839 spot_cation_groups: Dict[int, Dict[int, str]], 840) -&gt; None: 841 \"\"\" 842    \u683c\u5b50\u70b9\u306b group \u3092\u914d\u7f6e\u3059\u308b\u3002 843 844    Args: 845        genice: GenIce3 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 846        spot_cation_groups: \u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d} \u306e\u8f9e\u66f8 847    \"\"\" 848 _genice3_logger.info( 849 f\"place_groups_on_lattice: dummy implementation (group assignment not yet applied) {spot_cation_groups=}\" 850 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u683c\u5b50\u70b9\u306b group \u3092\u914d\u7f6e\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>Args:     genice: GenIce3 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9     spot_cation_groups: \u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d} \u306e\u8f9e\u66f8</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"log_spot_cation_cages\"&gt;\n                        &lt;input id=\"log_spot_cation_cages-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def log_spot_cation_cages(genice: GenIce3) -&gt; None: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#log_spot_cation_cages\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"log_spot_cation_cages-853\"&gt;&lt;a href=\"#log_spot_cation_cages-853\"&gt;&lt;span class=\"linenos\"&gt;853&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;log_spot_cation_cages&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;genice&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;GenIce3&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"kc\"&gt;None&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>854 \"\"\"spot_cation \u3054\u3068\u306b\u5c5e\u3059\u308b\u30b1\u30fc\u30b8\u306eID\u30fbcage_type\u30fbfaces\u3092\u30ed\u30b0\u8868\u793a\u3059\u308b\u3002\"\"\" 855 if not genice.spot_cations or genice.cages is None or len(genice.cages.specs) == 0: 856 return 857 num_replicas = int(np.round(np.linalg.det(genice.replication_matrix))) 858 num_cages_in_unitcell = len(genice.cages.specs) // max(1, num_replicas) 859 for site, ion_name in genice.spot_cations.items(): 860 cage_indices = genice.cages.node_to_cage_indices.get(site, []) 861 for cage_id in cage_indices: 862 spec = genice.cages.specs[cage_id] 863 genice.logger.info( 864 f\"spot_cation {site}={ion_name} belongs to cage {cage_id} ({spec.cage_type} {spec.faces}) in the supercell.\" 865 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;spot_cation \u3054\u3068\u306b\u5c5e\u3059\u308b\u30b1\u30fc\u30b8\u306eID\u30fbcage_type\u30fbfaces\u3092\u30ed\u30b0\u8868\u793a\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"log_cation_cages\"&gt;\n                        &lt;input id=\"log_cation_cages-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def log_cation_cages(genice: GenIce3) -&gt; None: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#log_cation_cages\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"log_cation_cages-868\"&gt;&lt;a href=\"#log_cation_cages-868\"&gt;&lt;span class=\"linenos\"&gt;868&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;log_cation_cages&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;genice&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;GenIce3&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"kc\"&gt;None&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>869 \"\"\"\u5358\u4f4d\u80de\u5185\u306e\u30ab\u30c1\u30aa\u30f3\u3054\u3068\u306b\u3001\u5c5e\u3059\u308b\u30b1\u30fc\u30b8\u306eID\u30fbcage_type\u30fbfaces \u3092\u30ed\u30b0\u8868\u793a\u3059\u308b\u3002\"\"\" 870 if ( 871 not genice.cations 872 or genice.unitcell.cages is None 873 or len(genice.unitcell.cages.specs) == 0 874 ): 875 return 876 for site, ion_name in genice.cations.items(): 877 cage_indices = genice.unitcell.cages.node_to_cage_indices.get(site, []) 878 for cage_id in cage_indices: 879 spec = genice.unitcell.cages.specs[cage_id] 880 genice.logger.info( 881 f\"cation {site}={ion_name} belongs to cage {cage_id} ({spec.cage_type} {spec.faces}) in the unit cell.\" 882 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5358\u4f4d\u80de\u5185\u306e\u30ab\u30c1\u30aa\u30f3\u3054\u3068\u306b\u3001\u5c5e\u3059\u308b\u30b1\u30fc\u30b8\u306eID\u30fbcage_type\u30fbfaces \u3092\u30ed\u30b0\u8868\u793a\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"place_group\"&gt;\n                        &lt;input id=\"place_group-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def place_group( direction: numpy.ndarray, bondlen: float, group_name: str) -&gt; genice3.group.Group: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#place_group\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"place_group-885\"&gt;&lt;a href=\"#place_group-885\"&gt;&lt;span class=\"linenos\"&gt;885&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;place_group&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;direction&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;np&lt;/span&gt;&lt;span class=\"o\"&gt;.&lt;/span&gt;&lt;span class=\"n\"&gt;ndarray&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;bondlen&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;float&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;group_name&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;str&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"n\"&gt;Group&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>886 \"\"\"\u6307\u5b9a\u65b9\u5411\u30fb\u7d50\u5408\u9577\u3067 group \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307f\u3001\u914d\u7f6e\u3057\u305f Group \u3092\u8fd4\u3059\u3002 887 888    \u7f6e\u63db\u30a4\u30aa\u30f3\u304b\u3089 group \u306e\u30a2\u30f3\u30ab\u30fc\u539f\u5b50\u307e\u3067\u304c direction \u65b9\u5411\u306b bondlen \u306e\u9577\u3055\u3067\u4e26\u3076\u3002 889    TODO: \u5c06\u6765\u306f2\u500b\u4ee5\u4e0a\u306e\u30a2\u30f3\u30ab\u30fc\u3092\u6301\u3064 group \u3092\u6271\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002 890 891    Args: 892        direction: \u914d\u7f6e\u65b9\u5411\uff08\u76f4\u4ea4\u5ea7\u6a19\u3001\u6b63\u898f\u5316\u3055\u308c\u308b\uff09\u3002 893        bondlen: \u30a2\u30f3\u30ab\u30fc\u307e\u3067\u306e\u7d50\u5408\u9577\u3002 894        group_name: group \u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonia\"\uff09\u3002 895 896    Returns: 897        \u56de\u8ee2\u30fb\u4e26\u9032\u3092\u9069\u7528\u3057\u305f Group \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3002 898    \"\"\" 899 # logger = getLogger(\"GenIce3\") 900 group = safe_import(\"group\", group_name).Group() 901 # logger.info(f\"{group_name=} {group=}\") 902 direction /= np.linalg.norm(direction) 903 offset = direction bondlen 904 # Z\u8ef8\u3092direction\u65b9\u5411\u306b\u50be\u3051\u308b\u884c\u5217 905 ex, ey, ez = direction 906 r = (ex2 + ey2) * 0.5 907 Ry = np.array([[ez, 0, -r], [0, 1, 0], [r, 0, ez]]) 908 Rz = np.array([[ex / r, ey / r, 0], [-ey / r, ex / r, 0], [0, 0, 1]]) 909 rotmat = Ry @ Rz 910 sites = group.sites @ rotmat + offset 911 return Group( 912 sites=sites, 913 labels=group.labels, 914 bonds=group.bonds, 915 name=group.name, 916 ) <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u6307\u5b9a\u65b9\u5411\u30fb\u7d50\u5408\u9577\u3067 group \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307f\u3001\u914d\u7f6e\u3057\u305f Group \u3092\u8fd4\u3059\u3002&lt;/p&gt;\n</code></pre> <p>\u7f6e\u63db\u30a4\u30aa\u30f3\u304b\u3089 group \u306e\u30a2\u30f3\u30ab\u30fc\u539f\u5b50\u307e\u3067\u304c direction \u65b9\u5411\u306b bondlen \u306e\u9577\u3055\u3067\u4e26\u3076\u3002 TODO: \u5c06\u6765\u306f2\u500b\u4ee5\u4e0a\u306e\u30a2\u30f3\u30ab\u30fc\u3092\u6301\u3064 group \u3092\u6271\u3046\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002</p> <p>Args:     direction: \u914d\u7f6e\u65b9\u5411\uff08\u76f4\u4ea4\u5ea7\u6a19\u3001\u6b63\u898f\u5316\u3055\u308c\u308b\uff09\u3002     bondlen: \u30a2\u30f3\u30ab\u30fc\u307e\u3067\u306e\u7d50\u5408\u9577\u3002     group_name: group \u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonia\"\uff09\u3002</p> <p>Returns:     \u56de\u8ee2\u30fb\u4e26\u9032\u3092\u9069\u7528\u3057\u305f Group \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3002</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"GenIce3\"&gt;\n                        &lt;input id=\"GenIce3-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> class GenIce3:                  View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3-924\"&gt;&lt;a href=\"#GenIce3-924\"&gt;&lt;span class=\"linenos\"&gt; 924&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;class&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nc\"&gt;GenIce3&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p> 925 \"\"\"GenIce3\u306e\u30e1\u30a4\u30f3\u30af\u30e9\u30b9\uff1a\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3088\u308b\u6c37\u69cb\u9020\u751f\u6210\u30b7\u30b9\u30c6\u30e0  926  927    GenIce3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u30a8\u30f3\u30b8\u30f3\uff08DependencyEngine\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u5fc5\u8981\u306a\u6642\u306b  928    \u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u306f  929    \u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3060\u3051\u3067\u3001\u305d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e  930    \u8a08\u7b97\u304c\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002  931  932    \u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u4ed5\u7d44\u307f:  933        - \u5404\u30d7\u30ed\u30d1\u30c6\u30a3\uff08digraph, graph, lattice_sites\u306a\u3069\uff09\u306f\u3001\u30a2\u30af\u30bb\u30b9\u6642\u306b  934          \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u307e\u3059  935        - \u4f9d\u5b58\u95a2\u4fc2\u306f\u95a2\u6570\u306e\u5f15\u6570\u540d\u304b\u3089\u81ea\u52d5\u7684\u306b\u63a8\u8ad6\u3055\u308c\u307e\u3059  936        - \u4e00\u5ea6\u8a08\u7b97\u3055\u308c\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3001\u4f9d\u5b58\u3059\u308b\u5165\u529b\u304c\u5909\u66f4\u3055\u308c\u308b\u307e\u3067  937          \u518d\u5229\u7528\u3055\u308c\u307e\u3059  938        - \u5165\u529b\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell, replication_matrix, depol_loop\u306a\u3069\uff09\u304c  939          \u5909\u66f4\u3055\u308c\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b  940          \u30af\u30ea\u30a2\u3055\u308c\u307e\u3059  941  942    \u4f7f\u7528\u4f8b:  943        &gt;&gt;&gt; genice = GenIce3(unitcell=my_unitcell)  944        &gt;&gt;&gt; digraph = genice.digraph  # \u81ea\u52d5\u7684\u306b\u5fc5\u8981\u306a\u8a08\u7b97\u304c\u5b9f\u884c\u3055\u308c\u308b  945        &gt;&gt;&gt; orientations = genice.orientations  # digraph\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081\u3001digraph\u304c\u5148\u306b\u8a08\u7b97\u3055\u308c\u308b  946  947    Attributes:  948        digraph (nx.DiGraph): \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5\u3002  949            \u7121\u5411\u30b0\u30e9\u30d5\u304b\u3089\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3088\u308a\u5404\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u3092\u6c7a\u5b9a\u3057\u305f  950            \u6709\u5411\u30b0\u30e9\u30d5\u3067\u3059\u3002\u56fa\u5b9a\u30a8\u30c3\u30b8\u3067\u6307\u5b9a\u3055\u308c\u305f\u65b9\u5411\u306f\u7dad\u6301\u3055\u308c\u3001\u305d\u308c\u4ee5\u5916\u306e\u30a8\u30c3\u30b8\u306f  951            \u6700\u9069\u5316\u306b\u3088\u308a\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2  952            \uff08graph, lattice_sites, fixed_edges \u306a\u3069\uff09\u304c\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u307e\u3059\u3002  953  954        graph (nx.Graph): \u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002  955            \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u6c34\u5206\u5b50\u9593\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u3059\u7121\u5411\u30b0\u30e9\u30d5\u3067\u3059\u3002  956            \u57fa\u672c\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u3066\u7d71\u5408\u3057\u305f\u3082\u306e\u3067\u3059\u3002  957  958        lattice_sites (np.ndarray): \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217\u3002  959            \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u8868\u3059Nx3\u914d\u5217\u3067\u3059\uff08N\u306f\u6c34\u5206\u5b50\u6570\uff09\u3002  960            \u57fa\u672c\u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u3001\u5358\u4f4d\u80de\u306e\u5468\u671f\u5883\u754c\u6761\u4ef6\u306b\u5f93\u3063\u3066\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b  961            \u8907\u88fd\u3057\u305f\u3082\u306e\u3067\u3059\u3002  962  963        orientations (np.ndarray): \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\u3002  964            \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\uff08\u56de\u8ee2\u884c\u5217\uff09\u3092\u8868\u3059Nx3x3\u914d\u5217\u3067\u3059\uff08N\u306f\u6c34\u5206\u5b50\u6570\uff09\u3002  965            \u6709\u5411\u30b0\u30e9\u30d5\u3067\u6c7a\u5b9a\u3055\u308c\u305f\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u306b\u57fa\u3065\u3044\u3066\u3001\u5404\u6c34\u5206\u5b50\u306eOH\u30d9\u30af\u30c8\u30eb\u306e  966            \u65b9\u5411\u304b\u3089\u5206\u5b50\u5168\u4f53\u306e\u914d\u5411\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002  967  968        unitcell (UnitCell): \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002  969            \u6c37\u69cb\u9020\u306e\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8868\u3059\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\u683c\u5b50\u69cb\u9020\u3001\u6c34\u5206\u5b50\u306e\u914d\u7f6e\u3001  970            \u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3001\u56fa\u5b9a\u30a8\u30c3\u30b8\u306a\u3069\u306e\u60c5\u5831\u3092\u542b\u307f\u307e\u3059\u3002  971  972        replication_matrix (np.ndarray): \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3002  973            \u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092\u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b3x3\u6574\u6570\u884c\u5217\u3067\u3059\u3002  974            \u5358\u4f4d\u884c\u5217\u306e\u5834\u5408\u306f\u57fa\u672c\u5358\u4f4d\u80de\u306e\u307f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002  975  976        depol_loop (int): \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002  977            \u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u969b\u306e\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570\u3067\u3059\u3002  978            \u5024\u304c\u5927\u304d\u3044\u307b\u3069\u3088\u308a\u6700\u9069\u5316\u3055\u308c\u305f\u69cb\u9020\u304c\u5f97\u3089\u308c\u307e\u3059\u304c\u3001\u8a08\u7b97\u6642\u9593\u3082\u5897\u52a0\u3057\u307e\u3059\u3002  979  980        seed (int): \u4e71\u6570\u30b7\u30fc\u30c9\u3002  981            \u4e71\u6570\u751f\u6210\u5668\u306e\u30b7\u30fc\u30c9\u5024\u3067\u3059\u3002digraph\u306e\u751f\u6210\u306a\u3069\u3067\u4f7f\u7528\u3055\u308c\u308b\u4e71\u6570\u306e\u521d\u671f\u5316\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002  982            \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e  983            \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002  984  985        spot_anions (Dict[int, str]): \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002  986            \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3067\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001  987            \u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002  988  989        spot_cations (Dict[int, str]): \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002  990            \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3067\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001  991            \u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002  992  993        spot_hydroniums (List[int]): H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff081\u53d7\u5bb9\u30fb3\u4f9b\u4e0e\uff09\u3002  994  995        spot_hydroxides (List[int]): OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff083\u53d7\u5bb9\u30fb1\u4f9b\u4e0e\uff09\u3002  996  997        cages (CageSpecs): \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30b1\u30fc\u30b8\u4f4d\u7f6e\u30fb\u30bf\u30a4\u30d7\u3002  998            \u5358\u4f4d\u80de\u306e\u30b1\u30fc\u30b8\u3092 replica_vectors \u306b\u5f93\u3063\u3066\u8907\u88fd\u3057\u305f\u3082\u306e\u3067\u3001\u30b2\u30b9\u30c8\u914d\u7f6e\u3084 cage_survey \u51fa\u529b\u306b\u5229\u7528\u3057\u307e\u3059\u3002  999 1000        fixed_edges (nx.DiGraph): \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3002 1001            \u5358\u4f4d\u80de\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3068 spot_anion/spot_cation/spot_hydronium/spot_hydroxide \u306b\u57fa\u3065\u304f\u56fa\u5b9a\u3092\u7d71\u5408\u3057\u305f\u3082\u306e\u3067\u3001digraph \u306e\u751f\u6210\u306b\u5229\u7528\u3057\u307e\u3059\u3002 1002    \"\"\" 1003 1004 # Class\u540d\u3067log\u8868\u793a\u3057\u305f\u3044\u3002 1005 logger = getLogger(\"GenIce3\") 1006 1007 # \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3059\u308bproperty\u306e\u30ea\u30b9\u30c8 1008 # \u3053\u306e\u30ea\u30b9\u30c8\u306b\u542b\u307e\u308c\u308bproperty\u306e\u307fAPI\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b 1009 PUBLIC_API_PROPERTIES = [ 1010 \"digraph\", 1011 \"graph\", 1012 \"lattice_sites\", 1013 \"orientations\", 1014 \"unitcell\", 1015 \"replication_matrix\", 1016 \"depol_loop\", 1017 \"target_pol\", 1018 \"seed\", 1019 \"spot_anions\", 1020 \"spot_cations\", 1021 \"spot_hydroniums\", 1022 \"spot_hydroxides\", 1023 ] 1024 1025 def init( 1026 self, 1027 depol_loop: int = 1000, 1028 replication_matrix: np.ndarray = np.eye(3, dtype=int), 1029 target_pol: np.ndarray = np.array([0.0, 0.0, 0.0]), 1030 seed: int = 1, 1031 spot_anions: Dict[int, str] = {}, 1032 spot_cations: Dict[int, str] = {}, 1033 spot_hydroniums: List[int] = None, 1034 spot_hydroxides: List[int] = None, 1035 bjerrum_L_edges: List[Tuple[int, int]] | None = None, 1036 bjerrum_D_edges: List[Tuple[int, int]] | None = None, 1037 guests: Dict[str, List[\"GuestSpec\"]] = None, 1038 spot_guests: Dict[int, Molecule] = None, 1039 spot_cation_groups: Dict[int, Dict[int, str]] = None, 1040 kwargs: Any, 1041 ) -&gt; None: 1042 \"\"\"GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u521d\u671f\u5316\u3059\u308b\u3002 1043 1044        Args: 1045            depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1000\uff09 1046            replication_matrix: \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: \u5358\u4f4d\u884c\u5217\uff09 1047            target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: [0, 0, 0]\uff09 1048            seed: \u4e71\u6570\u30b7\u30fc\u30c9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1\uff09 1049            spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1050            spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1051            spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09 1052            spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09 1053            guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1054            spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1055            spot_cation_groups: spot_cation \u306e --group \u6307\u5b9a\uff08\u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d}\uff09\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1056 kwargs: \u305d\u306e\u4ed6\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell\u306a\u3069\uff09 1057 1058        Raises: 1059            ConfigurationError: \u7121\u52b9\u306a\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408 1060        \"\"\" 1061 # DependencyEngine\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210 1062 self.engine = DependencyEngine() 1063 1064 # Default\u5024\u304c\u5fc5\u8981\u306a\u3082\u306e 1065 self.seed = ( 1066 seed # reactive property\u3068\u3057\u3066\u8a2d\u5b9a\uff08setter\u3067np.random.seed()\u3082\u5b9f\u884c\u3055\u308c\u308b\uff09 1067 ) 1068 self.depol_loop = depol_loop 1069 self.replication_matrix = replication_matrix 1070 self.target_pol = target_pol 1071 self.spot_anions = spot_anions 1072 self.spot_cations = spot_cations 1073 self.spot_hydroniums = spot_hydroniums if spot_hydroniums is not None else [] 1074 self.spot_hydroxides = spot_hydroxides if spot_hydroxides is not None else [] 1075 self.bjerrum_L_edges = bjerrum_L_edges if bjerrum_L_edges is not None else [] 1076 self.bjerrum_D_edges = bjerrum_D_edges if bjerrum_D_edges is not None else [] 1077 self.guests = guests if guests is not None else {} 1078 self.spot_guests = spot_guests if spot_guests is not None else {} 1079 self.spot_cation_groups = ( 1080 spot_cation_groups if spot_cation_groups is not None else {} 1081 ) 1082 1083 # \u30bf\u30b9\u30af\u3092\u767b\u9332\uff08\u30e2\u30b8\u30e5\u30fc\u30eb\u30ec\u30d9\u30eb\u306e\u95a2\u6570\u3092\u767b\u9332\uff09 1084 self._register_tasks() 1085 1086 # Default\u5024\u304c\u4e0d\u8981\u306a\u3082\u306e 1087 for key in self.list_settable_reactive_properties(): 1088 if key in kwargs: 1089 setattr(self, key, kwargs.pop(key)) 1090 if kwargs: 1091 raise ConfigurationError(f\"Invalid keyword arguments: {kwargs}.\") 1092 1093 def _register_tasks(self): 1094 \"\"\"DependencyEngine \u306b @reactive \u3092\u4ed8\u3051\u305f\u30bf\u30b9\u30af\u95a2\u6570\u3092\u767b\u9332\u3059\u308b\"\"\" 1095 for func in get_reactive_tasks(name): 1096 self.engine.task(func) 1097 1098 # spot_anions 1099 @property 1100 def spot_anions(self): 1101 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002 1102 1103        Returns: 1104            Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1105        \"\"\" 1106 if not hasattr(self, \"_spot_anions\"): 1107 self._spot_anions = {} 1108 return self._spot_anions 1109 1110 @spot_anions.setter 1111 def spot_anions(self, spot_anions): 1112 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1113 1114        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1115        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1116 1117        Args: 1118            spot_anions: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1119        \"\"\" 1120 self._spot_anions = spot_anions 1121 self.logger.debug(f\"  {spot_anions=}\") 1122 self.engine.cache.clear() 1123 1124 # spot_cations 1125 @property 1126 def spot_cations(self): 1127 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002 1128 1129        Returns: 1130            Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1131        \"\"\" 1132 if not hasattr(self, \"_spot_cations\"): 1133 self._spot_cations = {} 1134 return self._spot_cations 1135 1136 @spot_cations.setter 1137 def spot_cations(self, spot_cations): 1138 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1139 1140        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1141        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1142 1143        Args: 1144            spot_cations: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1145        \"\"\" 1146 self._spot_cations = spot_cations 1147 self.logger.debug(f\"  {spot_cations=}\") 1148 self.engine.cache.clear() 1149 1150 # spot_hydroniums (H3O+: 1\u53d7\u5bb9\u30fb3\u4f9b\u4e0e) 1151 @property 1152 def spot_hydroniums(self): 1153 \"\"\"H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30021\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002 1154 1155        Returns: 1156            List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8 1157        \"\"\" 1158 if not hasattr(self, \"_spot_hydroniums\"): 1159 self._spot_hydroniums = [] 1160 return self._spot_hydroniums 1161 1162 @spot_hydroniums.setter 1163 def spot_hydroniums(self, spot_hydroniums): 1164 self._spot_hydroniums = ( 1165 list(spot_hydroniums) if spot_hydroniums is not None else [] 1166 ) 1167 self.logger.debug(f\"  {spot_hydroniums=}\") 1168 self.engine.cache.clear() 1169 1170 # spot_hydroxides (OH-: 3\u53d7\u5bb9\u30fb1\u4f9b\u4e0e) 1171 @property 1172 def spot_hydroxides(self): 1173 \"\"\"OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30023\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002 1174 1175        Returns: 1176            List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8 1177        \"\"\" 1178 if not hasattr(self, \"_spot_hydroxides\"): 1179 self._spot_hydroxides = [] 1180 return self._spot_hydroxides 1181 1182 @spot_hydroxides.setter 1183 def spot_hydroxides(self, spot_hydroxides): 1184 self._spot_hydroxides = ( 1185 list(spot_hydroxides) if spot_hydroxides is not None else [] 1186 ) 1187 self.logger.debug(f\"  {spot_hydroxides=}\") 1188 self.engine.cache.clear() 1189 1190 # Bjerrum L \u6b20\u9665\u306b\u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u96c6\u5408\uff08(i, j) \u306e\u30ea\u30b9\u30c8\uff09 1191 @property 1192 def bjerrum_L_edges(self) -&gt; List[Tuple[int, int]]: 1193 if not hasattr(self, \"_bjerrum_L_edges\"): 1194 self._bjerrum_L_edges = [] 1195 return self._bjerrum_L_edges 1196 1197 @bjerrum_L_edges.setter 1198 def bjerrum_L_edges(self, edges: List[Tuple[int, int]] | None): 1199 self._bjerrum_L_edges = list(edges) if edges is not None else [] 1200 self.logger.debug(f\"  {self._bjerrum_L_edges=}\") 1201 self.engine.cache.clear() 1202 1203 # Bjerrum D \u6b20\u9665\u306b\u5bfe\u5fdc\u3059\u308b\u30a8\u30c3\u30b8\u96c6\u5408\uff08(i, j) \u306e\u30ea\u30b9\u30c8\uff09 1204 @property 1205 def bjerrum_D_edges(self) -&gt; List[Tuple[int, int]]: 1206 if not hasattr(self, \"_bjerrum_D_edges\"): 1207 self._bjerrum_D_edges = [] 1208 return self._bjerrum_D_edges 1209 1210 @bjerrum_D_edges.setter 1211 def bjerrum_D_edges(self, edges: List[Tuple[int, int]] | None): 1212 self._bjerrum_D_edges = list(edges) if edges is not None else [] 1213 self.logger.debug(f\"  {self._bjerrum_D_edges=}\") 1214 self.engine.cache.clear() 1215 1216 def add_spot_hydronium(self, sites): 1217 \"\"\"H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1218 1219        Args: 1220            sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1221        \"\"\" 1222 if sites is None: 1223 return 1224 # numpy \u306e\u30b9\u30ab\u30e9\u30fc\u3082\u53d7\u3051\u4ed8\u3051\u308b 1225 if isinstance(sites, (int, np.integer)): 1226 new_sites = [int(sites)] 1227 else: 1228 new_sites = list(sites) 1229 # setter \u3092\u7d4c\u7531\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7121\u52b9\u5316\u3059\u308b 1230 self.spot_hydroniums = list(self.spot_hydroniums) + new_sites 1231 1232 def add_spot_hydroxide(self, sites): 1233 \"\"\"OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1234 1235        Args: 1236            sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1237        \"\"\" 1238 if sites is None: 1239 return 1240 if isinstance(sites, (int, np.integer)): 1241 new_sites = [int(sites)] 1242 else: 1243 new_sites = list(sites) 1244 self.spot_hydroxides = list(self.spot_hydroxides) + new_sites 1245 1246 def add_bjerrum_L(self, edges): 1247 \"\"\"Bjerrum L \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1248 1249        Args: 1250            edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1251        \"\"\" 1252 if edges is None: 1253 return 1254 # \u5358\u4e00\u30bf\u30d7\u30eb (i, j) \u3082\u8a31\u5bb9\u3059\u308b 1255 if isinstance(edges, tuple) and len(edges) == 2: 1256 new_edges = [edges] 1257 else: 1258 new_edges = list(edges) 1259 self.bjerrum_L_edges = list(self.bjerrum_L_edges) + new_edges 1260 1261 def add_bjerrum_D(self, edges): 1262 \"\"\"Bjerrum D \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1263 1264        Args: 1265            edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1266        \"\"\" 1267 if edges is None: 1268 return 1269 if isinstance(edges, tuple) and len(edges) == 2: 1270 new_edges = [edges] 1271 else: 1272 new_edges = list(edges) 1273 self.bjerrum_D_edges = list(self.bjerrum_D_edges) + new_edges 1274 1275 @property 1276 def seed(self): 1277 \"\"\"\u4e71\u6570\u30b7\u30fc\u30c9\u3002 1278 1279        Returns: 1280            int: \u4e71\u6570\u30b7\u30fc\u30c9\u5024 1281        \"\"\" 1282 return self._seed 1283 1284 @seed.setter 1285 def seed(self, seed): 1286 \"\"\"\u4e71\u6570\u30b7\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1287 1288        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1289        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1290 1291        Args: 1292            seed: \u4e71\u6570\u30b7\u30fc\u30c9\u5024 1293        \"\"\" 1294 self._seed = seed 1295 np.random.seed(seed) 1296 self.logger.debug(f\"  {seed=}\") 1297 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08seed\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1298 self.engine.cache.clear() 1299 1300 @property 1301 def depol_loop(self): 1302 \"\"\"\u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002 1303 1304        Returns: 1305            int: \u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570 1306        \"\"\" 1307 return self._depol_loop 1308 1309 @depol_loop.setter 1310 def depol_loop(self, depol_loop): 1311 \"\"\"\u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1312 1313        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1314        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1315 1316        Args: 1317            depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570 1318        \"\"\" 1319 self._depol_loop = depol_loop 1320 self.logger.debug(f\"  {depol_loop=}\") 1321 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08depol_loop\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1322 self.engine.cache.clear() 1323 1324 @property 1325 def target_pol(self): 1326 \"\"\"\u5206\u6975\u306e\u76ee\u6a19\u5024\uff083\u8981\u7d20\u306e\u30d9\u30af\u30c8\u30eb\uff09\u3002\"\"\" 1327 return self._target_pol 1328 1329 @target_pol.setter 1330 def target_pol(self, target_pol): 1331 \"\"\"\u5206\u6975\u306e\u76ee\u6a19\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\u5909\u66f4\u6642\u306f\u4f9d\u5b58\u3059\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3059\u308b\u3002\"\"\" 1332 self._target_pol = np.asarray(target_pol, dtype=float).reshape(3) 1333 self.logger.debug(f\"  {target_pol=}\") 1334 self.engine.cache.clear() 1335 1336 @property 1337 def unitcell(self): 1338 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1339 1340        Returns: 1341            UnitCell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 1342 1343        Raises: 1344            ConfigurationError: \u5358\u4f4d\u80de\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408 1345        \"\"\" 1346 if not hasattr(self, \"_unitcell\") or self._unitcell is None: 1347 raise ConfigurationError(\"Unitcell is not set.\") 1348 return self._unitcell 1349 1350 @unitcell.setter 1351 def unitcell(self, unitcell): 1352 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1353 1354        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1355        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1356 1357        Args: 1358            unitcell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 1359        \"\"\" 1360 self._unitcell = unitcell 1361 self.logger.debug(f\"  {unitcell=}\") 1362 self.logger.debug(f\"  {unitcell.lattice_sites=}\") 1363 self.logger.debug(f\"  {unitcell.graph=}\") 1364 self.logger.debug(f\"  {unitcell.fixed=}\") 1365 1366 a, b, c, A, B, C = cellshape(self.replication_matrix @ self.unitcell.cell) 1367 self.logger.debug(\"  Reshaped cell:\") 1368 self.logger.debug(f\"    {a=:.4f}, {b=:.4f}, {c=:.4f}\") 1369 self.logger.debug(f\"    {A=:.3f}, {B=:.3f}, {C=:.3f}\") 1370 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08unitcell\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1371 self.engine.cache.clear() 1372 1373 def set_unitcell(self, unitcell_or_name, kwargs): 1374 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002 1375 1376        \u4ee3\u5165\uff08genice.unitcell = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 1377        \u5358\u4f4d\u80de\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002 1378 1379        Args: 1380            unitcell_or_name: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u307e\u305f\u306f\u5358\u4f4d\u80de\u540d\uff08\u6587\u5b57\u5217\uff09\u3002 1381                \u6587\u5b57\u5217\u306e\u5834\u5408\u306f UnitCell(name, kwargs) \u3068\u3057\u3066\u5185\u90e8\u3067\u751f\u6210\u3057\u307e\u3059\u3002 1382 kwargs: unitcell_or_name \u304c\u6587\u5b57\u5217\u306e\u5834\u5408\u306b UnitCell(...) \u306b\u6e21\u3059\u30aa\u30d7\u30b7\u30e7\u30f3\u3002 1383        \"\"\" 1384 if isinstance(unitcell_or_name, UnitCell): 1385 self.unitcell = unitcell_or_name 1386 else: 1387 self.unitcell = UnitCellPlugin(unitcell_or_name, kwargs) 1388 1389 @property 1390 def replication_matrix(self): 1391 \"\"\"\u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002 1392 1393        \u3053\u306e\u884c\u5217\u306b\u3088\u308a\u3001\u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092 1394        \u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 1395 1396        Returns: 1397            np.ndarray: 3x3\u6574\u6570\u884c\u5217 1398        \"\"\" 1399 return self._replication_matrix 1400 1401 @replication_matrix.setter 1402 def replication_matrix(self, replication_matrix): 1403 \"\"\"\u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3092\u8a2d\u5b9a\u3059\u308b\u3002 1404 1405        \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e 1406        \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002 1407 1408        Args: 1409            replication_matrix: 3x3\u6574\u6570\u884c\u5217 1410        \"\"\" 1411 self._replication_matrix = np.array(replication_matrix).reshape(3, 3) 1412 i, j, k = self._replication_matrix 1413 self.logger.debug(f\"    {i=}\") 1414 self.logger.debug(f\"    {j=}\") 1415 self.logger.debug(f\"    {k=}\") 1416 # \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\uff08replication_matrix\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30bf\u30b9\u30af\u3092\u518d\u8a08\u7b97\u3055\u305b\u308b\uff09 1417 self.engine.cache.clear() 1418 1419 def set_replication_matrix(self, replication_matrix): 1420 \"\"\"\u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002 1421 1422        \u4ee3\u5165\uff08genice.replication_matrix = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 1423        \u8907\u88fd\u884c\u5217\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002 1424 1425        Args: 1426            replication_matrix: 3x3\u6574\u6570\u884c\u5217\uff08\u30ea\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u307e\u305f\u306f ndarray\uff09 1427        \"\"\" 1428 self.replication_matrix = replication_matrix 1429 1430 def _get_inputs(self) -&gt; Dict[str, Any]: 1431 \"\"\"engine.resolve()\u306b\u6e21\u3059inputs\u8f9e\u66f8\u3092\u53d6\u5f97\"\"\" 1432 return { 1433 \"unitcell\": self.unitcell, 1434 \"replication_matrix\": self.replication_matrix, 1435 \"depol_loop\": self.depol_loop, 1436 \"target_pol\": self.target_pol, 1437 \"spot_anions\": self.spot_anions, 1438 \"spot_cations\": self.spot_cations, 1439 \"spot_hydroniums\": self.spot_hydroniums, 1440 \"spot_hydroxides\": self.spot_hydroxides, 1441 \"bjerrum_L_edges\": self.bjerrum_L_edges, 1442 \"bjerrum_D_edges\": self.bjerrum_D_edges, 1443 } 1444 1445 def getattr(self, name: str): 1446 \"\"\"\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u81ea\u52d5\u89e3\u6c7a\u3059\u308b\u3002 1447 1448        \u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308a\u3001DependencyEngine\u306b\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\u95a2\u6570\u304c 1449        \u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001 1450        \u4f9d\u5b58\u95a2\u4fc2\u304c\u81ea\u52d5\u7684\u306b\u89e3\u6c7a\u3055\u308c\u3001\u5fc5\u8981\u306a\u8a08\u7b97\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002 1451 1452        \u4f8b: 1453            &gt;&gt;&gt; genice = GenIce3(unitcell=my_unitcell) 1454            &gt;&gt;&gt; digraph = genice.digraph  # \u3053\u306e\u6642\u70b9\u3067digraph\u3068\u305d\u306e\u4f9d\u5b58\u95a2\u4fc2\u304c\u8a08\u7b97\u3055\u308c\u308b 1455 1456        Args: 1457            name: \u30a2\u30af\u30bb\u30b9\u3059\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\u540d\uff08\u30bf\u30b9\u30af\u95a2\u6570\u540d\uff09 1458 1459        Returns: 1460            \u8a08\u7b97\u3055\u308c\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5024 1461 1462        Raises: 1463            AttributeError: \u6307\u5b9a\u3055\u308c\u305f\u540d\u524d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408 1464            ConfigurationError: \u5fc5\u8981\u306a\u5165\u529b\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408 1465        \"\"\" 1466 # DependencyEngine\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30bf\u30b9\u30af\u304b\u30c1\u30a7\u30c3\u30af 1467 if name in self.engine.registry: 1468 return self.engine.resolve(name, self._get_inputs()) 1469 1470 # \u305d\u308c\u4ee5\u5916\u306f\u901a\u5e38\u306eAttributeError\u3092\u767a\u751f 1471 raise AttributeError( 1472 f\"'{self.class.name}' object has no attribute '{name}'\" 1473 ) 1474 1475 def water_molecules(self, water_model: Molecule) -&gt; Dict[int, Molecule]: 1476 \"\"\"\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u306e\u30b5\u30a4\u30c8\u306b\u3064\u3044\u3066\u3001\u914d\u5411\u30fb\u4f4d\u7f6e\u3092\u9069\u7528\u3057\u305f\u6c34\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002 1477 1478        Args: 1479            water_model: \u6c34\u5206\u5b50\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08sites, labels \u306a\u3069\uff09\u3002 1480 1481        Returns: 1482            \u30b5\u30a4\u30c8\u756a\u53f7\uff08\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u2192 Molecule \u306e\u8f9e\u66f8\u3002\u30a4\u30aa\u30f3\u30b5\u30a4\u30c8\u306f\u542b\u307e\u306a\u3044\u3002 1483        \"\"\" 1484 mols = {} 1485 for site in range(len(self.lattice_sites)): 1486 occ = self.site_occupants[site] 1487 # hydronium\u3084hydroxide\u306fwater-like\u3067\u306f\u306a\u3044\u3002 1488 is_water_like = occ == \"water\" 1489 if is_water_like: 1490 rel_position = self.lattice_sites[site] 1491 orientation = self.orientations[site] 1492 1493 sites = water_model.sites @ orientation + rel_position @ self.cell 1494 mols[site] = Molecule( 1495 name=water_model.name, 1496 sites=sites, 1497 labels=water_model.labels, 1498 is_water=True, 1499 ) 1500 return mols 1501 1502 def guest_molecules(self) -&gt; List[Molecule]: 1503 \"\"\"GenIce3\u306b\u8a2d\u5b9a\u3055\u308c\u305fguests\u3068spot_guests\u304b\u3089\u30b2\u30b9\u30c8\u5206\u5b50\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002\"\"\" 1504 # \u901a\u5e38\u306e\u6c37\uff08\u30b2\u30b9\u30c8\u306a\u3057\uff09\u3067\u306f\u30b1\u30fc\u30b8\u4e0d\u8981 \u2192 assess_cages \u3092\u547c\u3070\u306a\u3044 1505 if not self.guests and not self.spot_guests: 1506 return [] 1507 1508 all_cage_types = [spec.cage_type for spec in self.cages.specs] 1509 available = sorted(set(all_cage_types)) 1510 # guest_spec\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u306b\u5b58\u5728\u3057\u306a\u3044\u7a2e\u985e\u306e\u30b1\u30fc\u30b8\u306f\u30a8\u30e9\u30fc\u306b\u3059\u308b\u3002 1511 for cage_type in self.guests: 1512 if cage_type not in all_cage_types: 1513 raise ConfigurationError( 1514 f\"Cage type {cage_type} is not defined. \" 1515 f\"Available cage types in this structure: {available}.\" 1516 ) 1517 1518 randoms = np.random.random(len(self.cages.positions)) 1519 1520 mols = [] 1521 for pos, spec, probability in zip( 1522 self.cages.positions, self.cages.specs, randoms 1523 ): 1524 accum = 0.0 1525 if spec.cage_type in self.guests: 1526 for guest_spec in self.guests[spec.cage_type]: 1527 molecule = guest_spec.molecule 1528 occupancy = guest_spec.occupancy 1529 accum += occupancy 1530 if accum &gt; probability: 1531 mols.append( 1532 Molecule( 1533 name=molecule.name, 1534 sites=molecule.sites + pos @ self.cell, 1535 labels=molecule.labels, 1536 is_water=molecule.is_water, 1537 ) 1538 ) 1539 break 1540 1541 # spot guest\u306e\u914d\u7f6e 1542 for cage_index, guest in self.spot_guests.items(): 1543 mols.append( 1544 Molecule( 1545 name=guest.name, 1546 sites=guest.sites + self.cages.positions[cage_index] @ self.cell, 1547 labels=guest.labels, 1548 is_water=False, 1549 ) 1550 ) 1551 return mols 1552 1553 def build_molecular_ion( 1554 self, 1555 site_index: int, 1556 molecule: str, 1557 groups: Dict[int, str] | None = None, 1558 ) -&gt; Molecule: 1559 \"\"\"\u30b5\u30a4\u30c8 site_index\uff08\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u306b\u5206\u5b50\u30a4\u30aa\u30f3\uff08\u304a\u3088\u3073 spot cation \u7528\u306e\u4fee\u98fe group\uff09\u3092\u69cb\u7bc9\u3059\u308b\u3002 1560 1561        Args: 1562            site_index: \u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\u3002 1563            molecule: \u5206\u5b50\u30a4\u30aa\u30f3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonium\"\uff09\u3002 1564            groups: \u5f53\u8a72\u30b5\u30a4\u30c8\u306b\u96a3\u63a5\u3059\u308b\u30b1\u30fc\u30b8ID \u2192 group\u540d\u3002spot cation \u306e\u4fee\u98fe\u7528\u3002 1565 1566        Returns: 1567            \u76f4\u4ea4\u5ea7\u6a19\u3067\u914d\u7f6e\u3055\u308c\u305f Molecule\uff08\u539f\u5b50\u540d\u306f labels\uff09\u3002 1568        \"\"\" 1569 groups = groups or {} 1570 ion_center = self.lattice_sites[site_index] @ self.cell 1571 try: 1572 ion = safe_import(\"molecule\", molecule).Molecule() 1573 name = ion.name 1574 sites = ion.sites + ion_center 1575 atom_names: List[str] = list(ion.labels) 1576 except ImportError: 1577 name = molecule 1578 sites = np.array([ion_center]) 1579 atom_names = [molecule] 1580 # \u4fee\u98fe\u30b0\u30eb\u30fc\u30d7\u3092\u7f6e\u3044\u3066\u3044\u304f\uff08--group \u6307\u5b9a\u304c\u3042\u3063\u305f\u30b5\u30a4\u30c8\u306e\u307f\uff09 1581 for cage, group_name in groups.items(): 1582 direction = self.cages.positions[cage] - self.lattice_sites[site_index] 1583 direction -= np.floor(direction + 0.5) 1584 group = place_group( 1585 direction @ self.cell, 1586 0.13, # \u3042\u3068\u3067\u306a\u3093\u3068\u304b\u3059\u308b\u3002N-H\u7d50\u5408\u8ddd\u96e2 1587 group_name, 1588 ) 1589 sites = np.concatenate([sites, group.sites + ion_center]) 1590 atom_names += group.labels 1591 self.logger.info(f\"{atom_names=}\") 1592 return Molecule( 1593 name=name, 1594 sites=sites, 1595 labels=atom_names, 1596 is_water=False, 1597 ) 1598 1599 def _effective_spot_cation_groups(self) -&gt; Dict[int, Dict[int, str]]: 1600 \"\"\"spot_cation_groups \u306b\u5358\u4f4d\u80de\u7531\u6765\u306e cation_groups \u3092\u5c55\u958b\u3057\u3066\u30de\u30fc\u30b8\u3057\u305f\u8f9e\u66f8\u3092\u8fd4\u3059\uff08on-demand\uff09\u3002\"\"\" 1601 # \u30d9\u30fc\u30b9\u306f CLI/API \u3067\u6307\u5b9a\u3055\u308c\u305f spot_cation_groups 1602 effective: Dict[int, Dict[int, str]] = { 1603 k: dict(v) for k, v in self.spot_cation_groups.items() 1604 } 1605 # number of nodes in the unitcell 1606 nuc_nodes = len(self.unitcell.lattice_sites) 1607 # number of cages in the unitcell 1608 nuc_cages = len(self.unitcell.cages.specs) 1609 for un_node, uc_group in self.unitcell.cation_groups.items(): 1610 for node in _replicate_lattice_node( 1611 un_node, nuc_nodes, self.replication_matrix 1612 ): 1613 # \u62e1\u5927\u80de\u306e\u30ce\u30fc\u30c9\u306b\u96a3\u63a5\u3059\u308b4\u3064\u306e\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 1614 cage_indices = self.cages.node_to_cage_indices.get(node, []) 1615 for cage_index in cage_indices: 1616 # \u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5358\u4f4d\u80de\u3067\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u306a\u304a\u3057\u3001\u305d\u3053\u306b\u5165\u308b\u30b0\u30eb\u30fc\u30d7\u3092\u53d6\u5f97 1617 self.logger.info(f\"{cage_index=} {nuc_cages=} {uc_group=} {node=}\") 1618 uc_cage_index = cage_index % nuc_cages 1619 if uc_cage_index in uc_group: 1620 group = uc_group[cage_index % nuc_cages] 1621 # \u62e1\u5927\u80de\u306e\u30ce\u30fc\u30c9\u306b\u96a3\u63a5\u3059\u308b4\u3064\u306e\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3001\u30b0\u30eb\u30fc\u30d7\u3092\u30de\u30c3\u30d4\u30f3\u30b0 1622 effective.setdefault(node, {}).setdefault(cage_index, group) 1623 return effective 1624 1625 def build_hydronium(self, site_index: int) -&gt; Molecule: 1626 \"\"\"H3O+ \u3092\u69cb\u7bc9\u3059\u308b\u3002\"\"\" 1627 sites = [] 1628 labels = [\"Cn\", \"Hn\", \"Hn\", \"Hn\"] 1629 OH = 0.1 1630 sites.append(np.zeros(3)) 1631 neighbors = list(self.digraph.successors(site_index)) 1632 if len(neighbors) != 3: 1633 raise ValueError(\"H3O+ must have 3 neighbors.\") 1634 for neighbor in neighbors: 1635 direction = self.lattice_sites[neighbor] - self.lattice_sites[site_index] 1636 direction -= np.floor(direction + 0.5) 1637 direction = direction @ self.cell 1638 direction = OH / np.linalg.norm(direction) 1639 sites.append(direction) 1640 return Molecule( 1641 name=\"H3O\", 1642 sites=np.array(sites) + self.lattice_sites[site_index] @ self.cell, 1643 labels=labels, 1644 is_water=False, 1645 ) 1646 1647 def build_hydroxide(self, site_index: int) -&gt; Molecule: 1648 \"\"\"OH- \u3092\u69cb\u7bc9\u3059\u308b\u3002\"\"\" 1649 sites = [] 1650 labels = [\"Nx\", \"Hx\"] 1651 OH = 0.1 1652 sites.append(np.zeros(3)) 1653 neighbors = list(self.digraph.successors(site_index)) 1654 if len(neighbors) != 1: 1655 raise ValueError(f\"OH- must have 1 neighbor. {site_index=} {neighbors=}\") 1656 direction = self.lattice_sites[neighbors[0]] - self.lattice_sites[site_index] 1657 direction -= np.floor(direction + 0.5) 1658 direction = direction @ self.cell 1659 direction = OH / np.linalg.norm(direction) 1660 sites.append(direction) 1661 return Molecule( 1662 name=\"OH\", 1663 sites=np.array(sites) + self.lattice_sites[site_index] @ self.cell, 1664 labels=labels, 1665 is_water=False, 1666 ) 1667 1668 def substitutional_ions(self) -&gt; Dict[int, Molecule]: 1669 \"\"\"\u5358\u4f4d\u80de\u30fbspot \u7531\u6765\u306e\u30a4\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002\"\"\" 1670 # \u5358\u4f4d\u80de\u7531\u6765\u306e group \u6307\u5b9a\u3082\u542b\u3081\u305f\u300c\u5b9f\u52b9\u7684\u306a\u300dspot_cation_groups \u3092\u3053\u3053\u3067 on-demand \u306b\u7d44\u307f\u7acb\u3066\u3066\u4f7f\u3046 1671 1672 # \u524d\u63d0\u6761\u4ef6: anions, cations, hydroniums, hydroxides\u306e\u30b5\u30a4\u30c8\u306b\u91cd\u8907\u304c\u306a\u3044\u3053\u3068\u3002 1673 # \u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u3092\u8fd4\u3059\u3002 1674 if len(set(self.spot_hydroniums) &amp; set(self.spot_hydroxides)) &gt; 0: 1675 raise ValueError(\"hydroniums and hydroxides must not have the same site.\") 1676 if len(set(self.anions) &amp; set(self.cations)) &gt; 0: 1677 raise ValueError(\"anions and cations must not have the same site.\") 1678 if len(set(self.spot_hydroniums) &amp; set(self.cations)) &gt; 0: 1679 raise ValueError(\"hydroniums and cations must not have the same site.\") 1680 if len(set(self.spot_hydroxides) &amp; set(self.cations)) &gt; 0: 1681 raise ValueError(\"hydroxides and cations must not have the same site.\") 1682 1683 ions: Dict[int, Molecule] = {} 1684 for site_index in self.spot_hydroniums: 1685 ions[site_index] = self.build_hydronium(site_index) 1686 for site_index in self.spot_hydroxides: 1687 ions[site_index] = self.build_hydroxide(site_index) 1688 # \u306a\u3089\u3079\u304b\u3048\u306f\u3053\u3053\u3067\u306f\u3057\u306a\u3044\u3002formatter\u306b\u307e\u304b\u305b\u308b\u3002 1689 for site_index, molecule in self.anions.items(): 1690 ions[site_index] = self.build_molecular_ion(site_index, molecule) 1691 effective_groups = self._effective_spot_cation_groups() 1692 for site_index, molecule in self.cations.items(): 1693 # cation\u306b\u306f\u8155\u304c\u3064\u304f\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002 1694 groups = effective_groups.get(site_index, {}) 1695 ions[site_index] = self.build_molecular_ion(site_index, molecule, groups) 1696 self.logger.info(f\"{ions=}\") 1697 return ions 1698 1699 def dope_anions(self, anions: Dict[int, Molecule]) -&gt; None: 1700 \"\"\"\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002\"\"\" 1701 for site_index, molecule in anions.items(): 1702 self.anions[site_index] = molecule 1703 1704 def dope_cations(self, cations: Dict[int, Molecule]) -&gt; None: 1705 \"\"\"\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002\"\"\" 1706 for site_index, molecule in cations.items(): 1707 self.cations[site_index] = molecule 1708 1709 # def get_atomic_structure( 1710 #     self, 1711 #     water_model: Optional[Molecule] = None, 1712 #     guests: Optional[Dict[str, List[GuestSpec]]] = None, 1713 #     spot_guests: Optional[Dict[int, Molecule]] = None, 1714 # ) -&gt; AtomicStructure: 1715 #     \"\"\" 1716 #     \u539f\u5b50\u69cb\u9020\u30c7\u30fc\u30bf\u3092\u7d71\u5408\u7684\u306b\u53d6\u5f97\u3059\u308b\u3002 1717 #     exporter\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002 1718 1719 #     Args: 1720 #         water_model: \u6c34\u5206\u5b50\u30e2\u30c7\u30eb\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: FourSiteWater()\uff09 1721 #         guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u306e\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1722 #         spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u306e\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1723 1724 #     Returns: 1725 #         AtomicStructure: \u6c34\u5206\u5b50\u3001\u30b2\u30b9\u30c8\u5206\u5b50\u3001\u30a4\u30aa\u30f3\u3001\u30bb\u30eb\u884c\u5217\u3092\u542b\u3080\u7d71\u5408\u30c7\u30fc\u30bf\u69cb\u9020 1726 #     \"\"\" 1727 1728 #     return AtomicStructure( 1729 #         waters=self.water_molecules(water_model=water_model), 1730 #         guests=self.guest_molecules( 1731 #             guests=guests or {}, spot_guests=spot_guests or {} 1732 #         ), 1733 #         ions=self.substitutional_ions(), 1734 #         cell=self.cell, 1735 #     ) 1736 1737 @classmethod 1738 def get_public_api_properties(cls): 1739 \"\"\" 1740        \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308bproperty\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u3002 1741 1742        Returns: 1743            list: \u516c\u958bAPI property\u540d\u306e\u30ea\u30b9\u30c8 1744        \"\"\" 1745 return cls.PUBLIC_API_PROPERTIES.copy() 1746 1747 def list_all_reactive_properties(self): 1748 \"\"\" 1749        \u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08DependencyEngine\u306b\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\uff09\u3092\u5217\u6319\u3059\u308b\u3002 1750 1751        Returns: 1752            dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8 1753        \"\"\" 1754 return self.engine.registry.copy() 1755 1756 def list_public_reactive_properties(self): 1757 \"\"\" 1758        \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002 1759 1760        Returns: 1761            dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8 1762        \"\"\" 1763 all_reactive = self.list_all_reactive_properties() 1764 public_names = set(self.PUBLIC_API_PROPERTIES) 1765 return { 1766 name: func for name, func in all_reactive.items() if name in public_names 1767 } 1768 1769 @classmethod 1770 def list_settable_reactive_properties(cls): 1771 \"\"\"setter\u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u5909\u6570\u3092\u5217\u6319\u3059\u308b\"\"\" 1772 return { 1773 name: prop 1774 for name, prop in inspect.getmembers( 1775 cls, lambda x: isinstance(x, property) and x.fset is not None 1776 ) 1777 } 1778 1779 @classmethod 1780 def list_public_settable_reactive_properties(cls): 1781 \"\"\"\u516c\u958bAPI\u306e\u3046\u3061\u3001setter \u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002\"\"\" 1782 return { 1783 name: prop 1784 for name, prop in cls.list_settable_reactive_properties().items() 1785 if name in cls.PUBLIC_API_PROPERTIES 1786 } <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;GenIce3\u306e\u30e1\u30a4\u30f3\u30af\u30e9\u30b9\uff1a\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3088\u308b\u6c37\u69cb\u9020\u751f\u6210\u30b7\u30b9\u30c6\u30e0&lt;/p&gt;\n</code></pre> <p>GenIce3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u30a8\u30f3\u30b8\u30f3\uff08DependencyEngine\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u5fc5\u8981\u306a\u6642\u306b \u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u306f \u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3060\u3051\u3067\u3001\u305d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e \u8a08\u7b97\u304c\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002</p> <p>\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u4ed5\u7d44\u307f:     - \u5404\u30d7\u30ed\u30d1\u30c6\u30a3\uff08digraph, graph, lattice_sites\u306a\u3069\uff09\u306f\u3001\u30a2\u30af\u30bb\u30b9\u6642\u306b       \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u307e\u3059     - \u4f9d\u5b58\u95a2\u4fc2\u306f\u95a2\u6570\u306e\u5f15\u6570\u540d\u304b\u3089\u81ea\u52d5\u7684\u306b\u63a8\u8ad6\u3055\u308c\u307e\u3059     - \u4e00\u5ea6\u8a08\u7b97\u3055\u308c\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3001\u4f9d\u5b58\u3059\u308b\u5165\u529b\u304c\u5909\u66f4\u3055\u308c\u308b\u307e\u3067       \u518d\u5229\u7528\u3055\u308c\u307e\u3059     - \u5165\u529b\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell, replication_matrix, depol_loop\u306a\u3069\uff09\u304c       \u5909\u66f4\u3055\u308c\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b       \u30af\u30ea\u30a2\u3055\u308c\u307e\u3059</p> <p>\u4f7f\u7528\u4f8b:</p> <p>genice = GenIce3(unitcell=my_unitcell)       digraph = genice.digraph  # \u81ea\u52d5\u7684\u306b\u5fc5\u8981\u306a\u8a08\u7b97\u304c\u5b9f\u884c\u3055\u308c\u308b       orientations = genice.orientations  # digraph\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081\u3001digraph\u304c\u5148\u306b\u8a08\u7b97\u3055\u308c\u308b</p> <p>Attributes:     digraph (nx.DiGraph): \u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u304c\u6c7a\u5b9a\u3055\u308c\u305f\u6709\u5411\u30b0\u30e9\u30d5\u3002         \u7121\u5411\u30b0\u30e9\u30d5\u304b\u3089\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u3088\u308a\u5404\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u3092\u6c7a\u5b9a\u3057\u305f         \u6709\u5411\u30b0\u30e9\u30d5\u3067\u3059\u3002\u56fa\u5b9a\u30a8\u30c3\u30b8\u3067\u6307\u5b9a\u3055\u308c\u305f\u65b9\u5411\u306f\u7dad\u6301\u3055\u308c\u3001\u305d\u308c\u4ee5\u5916\u306e\u30a8\u30c3\u30b8\u306f         \u6700\u9069\u5316\u306b\u3088\u308a\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2         \uff08graph, lattice_sites, fixed_edges \u306a\u3069\uff09\u304c\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3055\u308c\u307e\u3059\u3002</p> <pre><code>graph (nx.Graph): \u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7121\u5411\u30b0\u30e9\u30d5\u3002\n    \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306e\u6c34\u5206\u5b50\u9593\u306e\u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u3059\u7121\u5411\u30b0\u30e9\u30d5\u3067\u3059\u3002\n    \u57fa\u672c\u5358\u4f4d\u80de\u306e\u30b0\u30e9\u30d5\u3092\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\u8907\u88fd\u3057\u3066\u7d71\u5408\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\nlattice_sites (np.ndarray): \u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306e\u914d\u5217\u3002\n    \u62e1\u5927\u5358\u4f4d\u80de\u5185\u306e\u3059\u3079\u3066\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u8868\u3059Nx3\u914d\u5217\u3067\u3059\uff08N\u306f\u6c34\u5206\u5b50\u6570\uff09\u3002\n    \u57fa\u672c\u5358\u4f4d\u80de\u5185\u306e\u6c34\u5206\u5b50\u306e\u5ea7\u6a19\u3092\u3001\u5358\u4f4d\u80de\u306e\u5468\u671f\u5883\u754c\u6761\u4ef6\u306b\u5f93\u3063\u3066\u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u306b\n    \u8907\u88fd\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\norientations (np.ndarray): \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\u884c\u5217\u3002\n    \u5404\u6c34\u5206\u5b50\u306e\u914d\u5411\uff08\u56de\u8ee2\u884c\u5217\uff09\u3092\u8868\u3059Nx3x3\u914d\u5217\u3067\u3059\uff08N\u306f\u6c34\u5206\u5b50\u6570\uff09\u3002\n    \u6709\u5411\u30b0\u30e9\u30d5\u3067\u6c7a\u5b9a\u3055\u308c\u305f\u6c34\u7d20\u7d50\u5408\u306e\u65b9\u5411\u306b\u57fa\u3065\u3044\u3066\u3001\u5404\u6c34\u5206\u5b50\u306eOH\u30d9\u30af\u30c8\u30eb\u306e\n    \u65b9\u5411\u304b\u3089\u5206\u5b50\u5168\u4f53\u306e\u914d\u5411\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\n\nunitcell (UnitCell): \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002\n    \u6c37\u69cb\u9020\u306e\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8868\u3059\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\u683c\u5b50\u69cb\u9020\u3001\u6c34\u5206\u5b50\u306e\u914d\u7f6e\u3001\n    \u6c34\u7d20\u7d50\u5408\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3001\u56fa\u5b9a\u30a8\u30c3\u30b8\u306a\u3069\u306e\u60c5\u5831\u3092\u542b\u307f\u307e\u3059\u3002\n\nreplication_matrix (np.ndarray): \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3002\n    \u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092\u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b3x3\u6574\u6570\u884c\u5217\u3067\u3059\u3002\n    \u5358\u4f4d\u884c\u5217\u306e\u5834\u5408\u306f\u57fa\u672c\u5358\u4f4d\u80de\u306e\u307f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\ndepol_loop (int): \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002\n    \u6709\u5411\u30b0\u30e9\u30d5\u3092\u751f\u6210\u3059\u308b\u969b\u306e\u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570\u3067\u3059\u3002\n    \u5024\u304c\u5927\u304d\u3044\u307b\u3069\u3088\u308a\u6700\u9069\u5316\u3055\u308c\u305f\u69cb\u9020\u304c\u5f97\u3089\u308c\u307e\u3059\u304c\u3001\u8a08\u7b97\u6642\u9593\u3082\u5897\u52a0\u3057\u307e\u3059\u3002\n\nseed (int): \u4e71\u6570\u30b7\u30fc\u30c9\u3002\n    \u4e71\u6570\u751f\u6210\u5668\u306e\u30b7\u30fc\u30c9\u5024\u3067\u3059\u3002digraph\u306e\u751f\u6210\u306a\u3069\u3067\u4f7f\u7528\u3055\u308c\u308b\u4e71\u6570\u306e\u521d\u671f\u5316\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n    \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\n    \u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002\n\nspot_anions (Dict[int, str]): \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002\n    \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3067\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\n    \u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002\n\nspot_cations (Dict[int, str]): \u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002\n    \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3067\u3059\u3002\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5909\u66f4\u3059\u308b\u3068\u3001\n    \u305d\u308c\u306b\u4f9d\u5b58\u3059\u308b\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u81ea\u52d5\u7684\u306b\u30af\u30ea\u30a2\u3055\u308c\u307e\u3059\u3002\n\nspot_hydroniums (List[int]): H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff081\u53d7\u5bb9\u30fb3\u4f9b\u4e0e\uff09\u3002\n\nspot_hydroxides (List[int]): OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff083\u53d7\u5bb9\u30fb1\u4f9b\u4e0e\uff09\u3002\n\ncages (CageSpecs): \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u30b1\u30fc\u30b8\u4f4d\u7f6e\u30fb\u30bf\u30a4\u30d7\u3002\n    \u5358\u4f4d\u80de\u306e\u30b1\u30fc\u30b8\u3092 replica_vectors \u306b\u5f93\u3063\u3066\u8907\u88fd\u3057\u305f\u3082\u306e\u3067\u3001\u30b2\u30b9\u30c8\u914d\u7f6e\u3084 cage_survey \u51fa\u529b\u306b\u5229\u7528\u3057\u307e\u3059\u3002\n\nfixed_edges (nx.DiGraph): \u62e1\u5927\u5358\u4f4d\u80de\u5168\u4f53\u3067\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u306e\u6709\u5411\u30b0\u30e9\u30d5\u3002\n    \u5358\u4f4d\u80de\u306e\u56fa\u5b9a\u30a8\u30c3\u30b8\u3068 spot_anion/spot_cation/spot_hydronium/spot_hydroxide \u306b\u57fa\u3065\u304f\u56fa\u5b9a\u3092\u7d71\u5408\u3057\u305f\u3082\u306e\u3067\u3001digraph \u306e\u751f\u6210\u306b\u5229\u7528\u3057\u307e\u3059\u3002\n</code></pre> <pre><code>                        &lt;div id=\"GenIce3.__init__\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.__init__-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> GenIce3( depol_loop: int = 1000, replication_matrix: numpy.ndarray = array([[1, 0, 0], [0, 1, 0], [0, 0, 1]]), target_pol: numpy.ndarray = array([0., 0., 0.]), seed: int = 1, spot_anions: Dict[int, str] = {}, spot_cations: Dict[int, str] = {}, spot_hydroniums: List[int] = None, spot_hydroxides: List[int] = None, bjerrum_L_edges: Optional[List[Tuple[int, int]]] = None, bjerrum_D_edges: Optional[List[Tuple[int, int]]] = None, guests: Dict[str, List[GuestSpec]] = None, spot_guests: Dict[int, genice3.molecule.Molecule] = None, spot_cation_groups: Dict[int, Dict[int, str]] = None, **kwargs: Any) View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.__init__\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.__init__-1025\"&gt;&lt;a href=\"#GenIce3.__init__-1025\"&gt;&lt;span class=\"linenos\"&gt;1025&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"fm\"&gt;__init__&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;\n</code></pre> <p>1026 self, 1027 depol_loop: int = 1000, 1028 replication_matrix: np.ndarray = np.eye(3, dtype=int), 1029 target_pol: np.ndarray = np.array([0.0, 0.0, 0.0]), 1030 seed: int = 1, 1031 spot_anions: Dict[int, str] = {}, 1032 spot_cations: Dict[int, str] = {}, 1033 spot_hydroniums: List[int] = None, 1034 spot_hydroxides: List[int] = None, 1035 bjerrum_L_edges: List[Tuple[int, int]] | None = None, 1036 bjerrum_D_edges: List[Tuple[int, int]] | None = None, 1037 guests: Dict[str, List[\"GuestSpec\"]] = None, 1038 spot_guests: Dict[int, Molecule] = None, 1039 spot_cation_groups: Dict[int, Dict[int, str]] = None, 1040 kwargs: Any, 1041 ) -&gt; None: 1042 \"\"\"GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u521d\u671f\u5316\u3059\u308b\u3002 1043 1044        Args: 1045            depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1000\uff09 1046            replication_matrix: \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: \u5358\u4f4d\u884c\u5217\uff09 1047            target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: [0, 0, 0]\uff09 1048            seed: \u4e71\u6570\u30b7\u30fc\u30c9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1\uff09 1049            spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1050            spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1051            spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09 1052            spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09 1053            guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1054            spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1055            spot_cation_groups: spot_cation \u306e --group \u6307\u5b9a\uff08\u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d}\uff09\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09 1056 kwargs: \u305d\u306e\u4ed6\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell\u306a\u3069\uff09 1057 1058        Raises: 1059            ConfigurationError: \u7121\u52b9\u306a\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408 1060        \"\"\" 1061 # DependencyEngine\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210 1062 self.engine = DependencyEngine() 1063 1064 # Default\u5024\u304c\u5fc5\u8981\u306a\u3082\u306e 1065 self.seed = ( 1066 seed # reactive property\u3068\u3057\u3066\u8a2d\u5b9a\uff08setter\u3067np.random.seed()\u3082\u5b9f\u884c\u3055\u308c\u308b\uff09 1067 ) 1068 self.depol_loop = depol_loop 1069 self.replication_matrix = replication_matrix 1070 self.target_pol = target_pol 1071 self.spot_anions = spot_anions 1072 self.spot_cations = spot_cations 1073 self.spot_hydroniums = spot_hydroniums if spot_hydroniums is not None else [] 1074 self.spot_hydroxides = spot_hydroxides if spot_hydroxides is not None else [] 1075 self.bjerrum_L_edges = bjerrum_L_edges if bjerrum_L_edges is not None else [] 1076 self.bjerrum_D_edges = bjerrum_D_edges if bjerrum_D_edges is not None else [] 1077 self.guests = guests if guests is not None else {} 1078 self.spot_guests = spot_guests if spot_guests is not None else {} 1079 self.spot_cation_groups = ( 1080 spot_cation_groups if spot_cation_groups is not None else {} 1081 ) 1082 1083 # \u30bf\u30b9\u30af\u3092\u767b\u9332\uff08\u30e2\u30b8\u30e5\u30fc\u30eb\u30ec\u30d9\u30eb\u306e\u95a2\u6570\u3092\u767b\u9332\uff09 1084 self._register_tasks() 1085 1086 # Default\u5024\u304c\u4e0d\u8981\u306a\u3082\u306e 1087 for key in self.list_settable_reactive_properties(): 1088 if key in kwargs: 1089 setattr(self, key, kwargs.pop(key)) 1090 if kwargs: 1091 raise ConfigurationError(f\"Invalid keyword arguments: {kwargs}.\") <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u521d\u671f\u5316\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>Args:     depol_loop: \u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1000\uff09     replication_matrix: \u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: \u5358\u4f4d\u884c\u5217\uff09     target_pol: \u5206\u6975\u306e\u76ee\u6a19\u5024\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: [0, 0, 0]\uff09     seed: \u4e71\u6570\u30b7\u30fc\u30c9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1\uff09     spot_anions: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09     spot_cations: \u7279\u5b9a\u4f4d\u7f6e\u306e\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09     spot_hydroniums: H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09     spot_hydroxides: OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: []\uff09     guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09     spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u4f4d\u7f6e\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09     spot_cation_groups: spot_cation \u306e --group \u6307\u5b9a\uff08\u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d}\uff09\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: {}\uff09     **kwargs: \u305d\u306e\u4ed6\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08unitcell\u306a\u3069\uff09</p> <p>Raises:     ConfigurationError: \u7121\u52b9\u306a\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.logger\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;logger&lt;/span&gt;        =\n</code></pre> <p>&lt;Logger GenIce3 (WARNING)&gt;</p> <pre><code>&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GenIce3.logger\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.PUBLIC_API_PROPERTIES\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;PUBLIC_API_PROPERTIES&lt;/span&gt;        =\n</code></pre> <p> ['digraph', 'graph', 'lattice_sites', 'orientations', 'unitcell', 'replication_matrix', 'depol_loop', 'target_pol', 'seed', 'spot_anions', 'spot_cations', 'spot_hydroniums', 'spot_hydroxides']</p> <pre><code>&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GenIce3.PUBLIC_API_PROPERTIES\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.engine\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;engine&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GenIce3.engine\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.seed\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.seed-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> seed View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.seed\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.seed-1275\"&gt;&lt;a href=\"#GenIce3.seed-1275\"&gt;&lt;span class=\"linenos\"&gt;1275&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1276 def seed(self): 1277 \"\"\"\u4e71\u6570\u30b7\u30fc\u30c9\u3002 1278 1279        Returns: 1280            int: \u4e71\u6570\u30b7\u30fc\u30c9\u5024 1281        \"\"\" 1282 return self._seed </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u4e71\u6570\u30b7\u30fc\u30c9\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     int: \u4e71\u6570\u30b7\u30fc\u30c9\u5024</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.depol_loop\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.depol_loop-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> depol_loop View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.depol_loop\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.depol_loop-1300\"&gt;&lt;a href=\"#GenIce3.depol_loop-1300\"&gt;&lt;span class=\"linenos\"&gt;1300&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1301 def depol_loop(self): 1302 \"\"\"\u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002 1303 1304        Returns: 1305            int: \u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570 1306        \"\"\" 1307 return self._depol_loop </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u53cc\u6975\u5b50\u6700\u9069\u5316\u306e\u53cd\u5fa9\u56de\u6570\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     int: \u53cc\u6975\u5b50\u6700\u9069\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u53cd\u5fa9\u56de\u6570</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.replication_matrix\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.replication_matrix-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> replication_matrix View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.replication_matrix\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.replication_matrix-1389\"&gt;&lt;a href=\"#GenIce3.replication_matrix-1389\"&gt;&lt;span class=\"linenos\"&gt;1389&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1390 def replication_matrix(self): 1391 \"\"\"\u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002 1392 1393        \u3053\u306e\u884c\u5217\u306b\u3088\u308a\u3001\u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092 1394        \u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 1395 1396        Returns: 1397            np.ndarray: 3x3\u6574\u6570\u884c\u5217 1398        \"\"\" 1399 return self._replication_matrix </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5358\u4f4d\u80de\u3092\u8907\u88fd\u3059\u308b\u305f\u3081\u306e3x3\u6574\u6570\u884c\u5217\u3002&lt;/p&gt;\n</code></pre> <p>\u3053\u306e\u884c\u5217\u306b\u3088\u308a\u3001\u57fa\u672c\u5358\u4f4d\u80de\u3092\u3069\u306e\u3088\u3046\u306b\u7a4d\u307f\u91cd\u306d\u3066\u62e1\u5927\u5358\u4f4d\u80de\u3092 \u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002</p> <p>Returns:     np.ndarray: 3x3\u6574\u6570\u884c\u5217</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.target_pol\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.target_pol-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> target_pol View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.target_pol\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.target_pol-1324\"&gt;&lt;a href=\"#GenIce3.target_pol-1324\"&gt;&lt;span class=\"linenos\"&gt;1324&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1325 def target_pol(self): 1326 \"\"\"\u5206\u6975\u306e\u76ee\u6a19\u5024\uff083\u8981\u7d20\u306e\u30d9\u30af\u30c8\u30eb\uff09\u3002\"\"\" 1327 return self._target_pol </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5206\u6975\u306e\u76ee\u6a19\u5024\uff083\u8981\u7d20\u306e\u30d9\u30af\u30c8\u30eb\uff09\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.spot_anions\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.spot_anions-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> spot_anions View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.spot_anions\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.spot_anions-1099\"&gt;&lt;a href=\"#GenIce3.spot_anions-1099\"&gt;&lt;span class=\"linenos\"&gt;1099&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1100 def spot_anions(self): 1101 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002 1102 1103        Returns: 1104            Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1105        \"\"\" 1106 if not hasattr(self, \"_spot_anions\"): 1107 self._spot_anions = {} 1108 return self._spot_anions </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30a2\u30cb\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.spot_cations\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.spot_cations-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> spot_cations View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.spot_cations\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.spot_cations-1125\"&gt;&lt;a href=\"#GenIce3.spot_cations-1125\"&gt;&lt;span class=\"linenos\"&gt;1125&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1126 def spot_cations(self): 1127 \"\"\"\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002 1128 1129        Returns: 1130            Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 1131        \"\"\" 1132 if not hasattr(self, \"_spot_cations\"): 1133 self._spot_cations = {} 1134 return self._spot_cations </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u7279\u5b9a\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u4f4d\u7f6e\u306b\u914d\u7f6e\u3059\u308b\u30ab\u30c1\u30aa\u30f3\u30a4\u30aa\u30f3\u306e\u8f9e\u66f8\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     Dict[int, str]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304b\u3089\u30a4\u30aa\u30f3\u540d\u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.spot_hydroniums\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.spot_hydroniums-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> spot_hydroniums View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.spot_hydroniums\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.spot_hydroniums-1151\"&gt;&lt;a href=\"#GenIce3.spot_hydroniums-1151\"&gt;&lt;span class=\"linenos\"&gt;1151&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1152 def spot_hydroniums(self): 1153 \"\"\"H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30021\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002 1154 1155        Returns: 1156            List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8 1157        \"\"\" 1158 if not hasattr(self, \"_spot_hydroniums\"): 1159 self._spot_hydroniums = [] 1160 return self._spot_hydroniums </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30021\u672c\u53d7\u3051\u5165\u308c\u30fb3\u672c\u4f9b\u4e0e\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.spot_hydroxides\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.spot_hydroxides-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> spot_hydroxides View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.spot_hydroxides\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.spot_hydroxides-1171\"&gt;&lt;a href=\"#GenIce3.spot_hydroxides-1171\"&gt;&lt;span class=\"linenos\"&gt;1171&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1172 def spot_hydroxides(self): 1173 \"\"\"OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30023\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002 1174 1175        Returns: 1176            List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8 1177        \"\"\" 1178 if not hasattr(self, \"_spot_hydroxides\"): 1179 self._spot_hydroxides = [] 1180 return self._spot_hydroxides </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u306e\u30ea\u30b9\u30c8\u30023\u672c\u53d7\u3051\u5165\u308c\u30fb1\u672c\u4f9b\u4e0e\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     List[int]: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30ea\u30b9\u30c8</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.bjerrum_L_edges\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.bjerrum_L_edges-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> bjerrum_L_edges: List[Tuple[int, int]] View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.bjerrum_L_edges\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.bjerrum_L_edges-1191\"&gt;&lt;a href=\"#GenIce3.bjerrum_L_edges-1191\"&gt;&lt;span class=\"linenos\"&gt;1191&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1192 def bjerrum_L_edges(self) -&gt; List[Tuple[int, int]]: 1193 if not hasattr(self, \"_bjerrum_L_edges\"): 1194 self._bjerrum_L_edges = [] 1195 return self._bjerrum_L_edges </p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.bjerrum_D_edges\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.bjerrum_D_edges-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> bjerrum_D_edges: List[Tuple[int, int]] View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.bjerrum_D_edges\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.bjerrum_D_edges-1204\"&gt;&lt;a href=\"#GenIce3.bjerrum_D_edges-1204\"&gt;&lt;span class=\"linenos\"&gt;1204&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1205 def bjerrum_D_edges(self) -&gt; List[Tuple[int, int]]: 1206 if not hasattr(self, \"_bjerrum_D_edges\"): 1207 self._bjerrum_D_edges = [] 1208 return self._bjerrum_D_edges </p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.guests\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;guests&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GenIce3.guests\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.spot_guests\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;spot_guests&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GenIce3.spot_guests\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.spot_cation_groups\" class=\"classattr\"&gt;\n                            &lt;div class=\"attr variable\"&gt;\n        &lt;span class=\"name\"&gt;spot_cation_groups&lt;/span&gt;\n\n\n&lt;/div&gt;\n&lt;a class=\"headerlink\" href=\"#GenIce3.spot_cation_groups\"&gt;&lt;/a&gt;\n\n\n\n                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.add_spot_hydronium\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.add_spot_hydronium-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def add_spot_hydronium(self, sites): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.add_spot_hydronium\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.add_spot_hydronium-1216\"&gt;&lt;a href=\"#GenIce3.add_spot_hydronium-1216\"&gt;&lt;span class=\"linenos\"&gt;1216&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;add_spot_hydronium&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;sites&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1217 \"\"\"H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1218 1219        Args: 1220            sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1221        \"\"\" 1222 if sites is None: 1223 return 1224 # numpy \u306e\u30b9\u30ab\u30e9\u30fc\u3082\u53d7\u3051\u4ed8\u3051\u308b 1225 if isinstance(sites, (int, np.integer)): 1226 new_sites = [int(sites)] 1227 else: 1228 new_sites = list(sites) 1229 # setter \u3092\u7d4c\u7531\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7121\u52b9\u5316\u3059\u308b 1230 self.spot_hydroniums = list(self.spot_hydroniums) + new_sites </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;H3O+ \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002&lt;/p&gt;\n</code></pre> <p>Args:     sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.add_spot_hydroxide\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.add_spot_hydroxide-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def add_spot_hydroxide(self, sites): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.add_spot_hydroxide\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.add_spot_hydroxide-1232\"&gt;&lt;a href=\"#GenIce3.add_spot_hydroxide-1232\"&gt;&lt;span class=\"linenos\"&gt;1232&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;add_spot_hydroxide&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;sites&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1233 \"\"\"OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1234 1235        Args: 1236            sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1237        \"\"\" 1238 if sites is None: 1239 return 1240 if isinstance(sites, (int, np.integer)): 1241 new_sites = [int(sites)] 1242 else: 1243 new_sites = list(sites) 1244 self.spot_hydroxides = list(self.spot_hydroxides) + new_sites </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;OH- \u3092\u7f6e\u304f\u30b5\u30a4\u30c8\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002&lt;/p&gt;\n</code></pre> <p>Args:     sites: \u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff08int\uff09\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.add_bjerrum_L\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.add_bjerrum_L-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def add_bjerrum_L(self, edges): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.add_bjerrum_L\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.add_bjerrum_L-1246\"&gt;&lt;a href=\"#GenIce3.add_bjerrum_L-1246\"&gt;&lt;span class=\"linenos\"&gt;1246&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;add_bjerrum_L&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;edges&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1247 \"\"\"Bjerrum L \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1248 1249        Args: 1250            edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1251        \"\"\" 1252 if edges is None: 1253 return 1254 # \u5358\u4e00\u30bf\u30d7\u30eb (i, j) \u3082\u8a31\u5bb9\u3059\u308b 1255 if isinstance(edges, tuple) and len(edges) == 2: 1256 new_edges = [edges] 1257 else: 1258 new_edges = list(edges) 1259 self.bjerrum_L_edges = list(self.bjerrum_L_edges) + new_edges </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Bjerrum L \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002&lt;/p&gt;\n</code></pre> <p>Args:     edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.add_bjerrum_D\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.add_bjerrum_D-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def add_bjerrum_D(self, edges): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.add_bjerrum_D\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.add_bjerrum_D-1261\"&gt;&lt;a href=\"#GenIce3.add_bjerrum_D-1261\"&gt;&lt;span class=\"linenos\"&gt;1261&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;add_bjerrum_D&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;edges&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1262 \"\"\"Bjerrum D \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002 1263 1264        Args: 1265            edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1266        \"\"\" 1267 if edges is None: 1268 return 1269 if isinstance(edges, tuple) and len(edges) == 2: 1270 new_edges = [edges] 1271 else: 1272 new_edges = list(edges) 1273 self.bjerrum_D_edges = list(self.bjerrum_D_edges) + new_edges </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Bjerrum D \u6b20\u9665\u3092\u8ffd\u52a0\u767b\u9332\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u3002&lt;/p&gt;\n</code></pre> <p>Args:     edges: (i, j) \u306e\u30bf\u30d7\u30eb\u3001\u307e\u305f\u306f\u305d\u306e\u53cd\u5fa9\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.unitcell\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.unitcell-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> unitcell View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.unitcell\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.unitcell-1336\"&gt;&lt;a href=\"#GenIce3.unitcell-1336\"&gt;&lt;span class=\"linenos\"&gt;1336&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@property&lt;/span&gt;\n</code></pre> <p>1337 def unitcell(self): 1338 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002 1339 1340        Returns: 1341            UnitCell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 1342 1343        Raises: 1344            ConfigurationError: \u5358\u4f4d\u80de\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408 1345        \"\"\" 1346 if not hasattr(self, \"_unitcell\") or self._unitcell is None: 1347 raise ConfigurationError(\"Unitcell is not set.\") 1348 return self._unitcell </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     UnitCell: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</p> <p>Raises:     ConfigurationError: \u5358\u4f4d\u80de\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.set_unitcell\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.set_unitcell-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def set_unitcell(self, unitcell_or_name, **kwargs): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.set_unitcell\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.set_unitcell-1373\"&gt;&lt;a href=\"#GenIce3.set_unitcell-1373\"&gt;&lt;span class=\"linenos\"&gt;1373&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;set_unitcell&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;unitcell_or_name&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"o\"&gt;**&lt;/span&gt;&lt;span class=\"n\"&gt;kwargs&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1374 \"\"\"\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002 1375 1376        \u4ee3\u5165\uff08genice.unitcell = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 1377        \u5358\u4f4d\u80de\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002 1378 1379        Args: 1380            unitcell_or_name: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u307e\u305f\u306f\u5358\u4f4d\u80de\u540d\uff08\u6587\u5b57\u5217\uff09\u3002 1381                \u6587\u5b57\u5217\u306e\u5834\u5408\u306f UnitCell(name, kwargs) \u3068\u3057\u3066\u5185\u90e8\u3067\u751f\u6210\u3057\u307e\u3059\u3002 1382 kwargs: unitcell_or_name \u304c\u6587\u5b57\u5217\u306e\u5834\u5408\u306b UnitCell(...) \u306b\u6e21\u3059\u30aa\u30d7\u30b7\u30e7\u30f3\u3002 1383        \"\"\" 1384 if isinstance(unitcell_or_name, UnitCell): 1385 self.unitcell = unitcell_or_name 1386 else: 1387 self.unitcell = UnitCellPlugin(unitcell_or_name, **kwargs) <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u57fa\u672c\u5358\u4f4d\u80de\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002&lt;/p&gt;\n</code></pre> <p>\u4ee3\u5165\uff08genice.unitcell = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 \u5358\u4f4d\u80de\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>Args:     unitcell_or_name: \u57fa\u672c\u5358\u4f4d\u80de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u307e\u305f\u306f\u5358\u4f4d\u80de\u540d\uff08\u6587\u5b57\u5217\uff09\u3002         \u6587\u5b57\u5217\u306e\u5834\u5408\u306f UnitCell(name, *kwargs) \u3068\u3057\u3066\u5185\u90e8\u3067\u751f\u6210\u3057\u307e\u3059\u3002     *kwargs: unitcell_or_name \u304c\u6587\u5b57\u5217\u306e\u5834\u5408\u306b UnitCell(...) \u306b\u6e21\u3059\u30aa\u30d7\u30b7\u30e7\u30f3\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.set_replication_matrix\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.set_replication_matrix-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def set_replication_matrix(self, replication_matrix): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.set_replication_matrix\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.set_replication_matrix-1419\"&gt;&lt;a href=\"#GenIce3.set_replication_matrix-1419\"&gt;&lt;span class=\"linenos\"&gt;1419&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;set_replication_matrix&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;replication_matrix&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1420 \"\"\"\u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002 1421 1422        \u4ee3\u5165\uff08genice.replication_matrix = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 1423        \u8907\u88fd\u884c\u5217\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002 1424 1425        Args: 1426            replication_matrix: 3x3\u6574\u6570\u884c\u5217\uff08\u30ea\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u307e\u305f\u306f ndarray\uff09 1427        \"\"\" 1428 self.replication_matrix = replication_matrix </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5358\u4f4d\u80de\u8907\u88fd\u884c\u5217\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u7528\u306e\u30e9\u30c3\u30d1\u30fc\uff09\u3002&lt;/p&gt;\n</code></pre> <p>\u4ee3\u5165\uff08genice.replication_matrix = ...\uff09\u306e\u4ee3\u308f\u308a\u306b\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u3068\u3001 \u8907\u88fd\u884c\u5217\u304c\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u8a2d\u5b9a\u3067\u3042\u308b\u3053\u3068\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>Args:     replication_matrix: 3x3\u6574\u6570\u884c\u5217\uff08\u30ea\u30b9\u30c8\u306e\u30ea\u30b9\u30c8\u307e\u305f\u306f ndarray\uff09</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.water_molecules\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.water_molecules-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def water_molecules( self, water_model: genice3.molecule.Molecule) -&gt; Dict[int, genice3.molecule.Molecule]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.water_molecules\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.water_molecules-1475\"&gt;&lt;a href=\"#GenIce3.water_molecules-1475\"&gt;&lt;span class=\"linenos\"&gt;1475&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;water_molecules&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;water_model&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"n\"&gt;Dict&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;]:&lt;/span&gt;\n</code></pre> <p>1476 \"\"\"\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u306e\u30b5\u30a4\u30c8\u306b\u3064\u3044\u3066\u3001\u914d\u5411\u30fb\u4f4d\u7f6e\u3092\u9069\u7528\u3057\u305f\u6c34\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002 1477 1478        Args: 1479            water_model: \u6c34\u5206\u5b50\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08sites, labels \u306a\u3069\uff09\u3002 1480 1481        Returns: 1482            \u30b5\u30a4\u30c8\u756a\u53f7\uff08\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u2192 Molecule \u306e\u8f9e\u66f8\u3002\u30a4\u30aa\u30f3\u30b5\u30a4\u30c8\u306f\u542b\u307e\u306a\u3044\u3002 1483        \"\"\" 1484 mols = {} 1485 for site in range(len(self.lattice_sites)): 1486 occ = self.site_occupants[site] 1487 # hydronium\u3084hydroxide\u306fwater-like\u3067\u306f\u306a\u3044\u3002 1488 is_water_like = occ == \"water\" 1489 if is_water_like: 1490 rel_position = self.lattice_sites[site] 1491 orientation = self.orientations[site] 1492 1493 sites = water_model.sites @ orientation + rel_position @ self.cell 1494 mols[site] = Molecule( 1495 name=water_model.name, 1496 sites=sites, 1497 labels=water_model.labels, 1498 is_water=True, 1499 ) 1500 return mols </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u683c\u5b50\u30b5\u30a4\u30c8\u304c\u6c34\u306e\u30b5\u30a4\u30c8\u306b\u3064\u3044\u3066\u3001\u914d\u5411\u30fb\u4f4d\u7f6e\u3092\u9069\u7528\u3057\u305f\u6c34\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002&lt;/p&gt;\n</code></pre> <p>Args:     water_model: \u6c34\u5206\u5b50\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08sites, labels \u306a\u3069\uff09\u3002</p> <p>Returns:     \u30b5\u30a4\u30c8\u756a\u53f7\uff08\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u2192 Molecule \u306e\u8f9e\u66f8\u3002\u30a4\u30aa\u30f3\u30b5\u30a4\u30c8\u306f\u542b\u307e\u306a\u3044\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.guest_molecules\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.guest_molecules-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def guest_molecules(self) -&gt; List[genice3.molecule.Molecule]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.guest_molecules\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.guest_molecules-1502\"&gt;&lt;a href=\"#GenIce3.guest_molecules-1502\"&gt;&lt;span class=\"linenos\"&gt;1502&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;guest_molecules&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"n\"&gt;List&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;]:&lt;/span&gt;\n</code></pre> <p>1503 \"\"\"GenIce3\u306b\u8a2d\u5b9a\u3055\u308c\u305fguests\u3068spot_guests\u304b\u3089\u30b2\u30b9\u30c8\u5206\u5b50\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002\"\"\" 1504 # \u901a\u5e38\u306e\u6c37\uff08\u30b2\u30b9\u30c8\u306a\u3057\uff09\u3067\u306f\u30b1\u30fc\u30b8\u4e0d\u8981 \u2192 assess_cages \u3092\u547c\u3070\u306a\u3044 1505 if not self.guests and not self.spot_guests: 1506 return [] 1507 1508 all_cage_types = [spec.cage_type for spec in self.cages.specs] 1509 available = sorted(set(all_cage_types)) 1510 # guest_spec\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u306e\u306b\u5b58\u5728\u3057\u306a\u3044\u7a2e\u985e\u306e\u30b1\u30fc\u30b8\u306f\u30a8\u30e9\u30fc\u306b\u3059\u308b\u3002 1511 for cage_type in self.guests: 1512 if cage_type not in all_cage_types: 1513 raise ConfigurationError( 1514 f\"Cage type {cage_type} is not defined. \" 1515 f\"Available cage types in this structure: {available}.\" 1516 ) 1517 1518 randoms = np.random.random(len(self.cages.positions)) 1519 1520 mols = [] 1521 for pos, spec, probability in zip( 1522 self.cages.positions, self.cages.specs, randoms 1523 ): 1524 accum = 0.0 1525 if spec.cage_type in self.guests: 1526 for guest_spec in self.guests[spec.cage_type]: 1527 molecule = guest_spec.molecule 1528 occupancy = guest_spec.occupancy 1529 accum += occupancy 1530 if accum &gt; probability: 1531 mols.append( 1532 Molecule( 1533 name=molecule.name, 1534 sites=molecule.sites + pos @ self.cell, 1535 labels=molecule.labels, 1536 is_water=molecule.is_water, 1537 ) 1538 ) 1539 break 1540 1541 # spot guest\u306e\u914d\u7f6e 1542 for cage_index, guest in self.spot_guests.items(): 1543 mols.append( 1544 Molecule( 1545 name=guest.name, 1546 sites=guest.sites + self.cages.positions[cage_index] @ self.cell, 1547 labels=guest.labels, 1548 is_water=False, 1549 ) 1550 ) 1551 return mols </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;GenIce3\u306b\u8a2d\u5b9a\u3055\u308c\u305fguests\u3068spot_guests\u304b\u3089\u30b2\u30b9\u30c8\u5206\u5b50\u30ea\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.build_molecular_ion\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.build_molecular_ion-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def build_molecular_ion( self, site_index: int, molecule: str, groups: Optional[Dict[int, str]] = None) -&gt; genice3.molecule.Molecule: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.build_molecular_ion\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.build_molecular_ion-1553\"&gt;&lt;a href=\"#GenIce3.build_molecular_ion-1553\"&gt;&lt;span class=\"linenos\"&gt;1553&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;build_molecular_ion&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;\n</code></pre> <p>1554 self, 1555 site_index: int, 1556 molecule: str, 1557 groups: Dict[int, str] | None = None, 1558 ) -&gt; Molecule: 1559 \"\"\"\u30b5\u30a4\u30c8 site_index\uff08\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u306b\u5206\u5b50\u30a4\u30aa\u30f3\uff08\u304a\u3088\u3073 spot cation \u7528\u306e\u4fee\u98fe group\uff09\u3092\u69cb\u7bc9\u3059\u308b\u3002 1560 1561        Args: 1562            site_index: \u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\u3002 1563            molecule: \u5206\u5b50\u30a4\u30aa\u30f3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonium\"\uff09\u3002 1564            groups: \u5f53\u8a72\u30b5\u30a4\u30c8\u306b\u96a3\u63a5\u3059\u308b\u30b1\u30fc\u30b8ID \u2192 group\u540d\u3002spot cation \u306e\u4fee\u98fe\u7528\u3002 1565 1566        Returns: 1567            \u76f4\u4ea4\u5ea7\u6a19\u3067\u914d\u7f6e\u3055\u308c\u305f Molecule\uff08\u539f\u5b50\u540d\u306f labels\uff09\u3002 1568        \"\"\" 1569 groups = groups or {} 1570 ion_center = self.lattice_sites[site_index] @ self.cell 1571 try: 1572 ion = safe_import(\"molecule\", molecule).Molecule() 1573 name = ion.name 1574 sites = ion.sites + ion_center 1575 atom_names: List[str] = list(ion.labels) 1576 except ImportError: 1577 name = molecule 1578 sites = np.array([ion_center]) 1579 atom_names = [molecule] 1580 # \u4fee\u98fe\u30b0\u30eb\u30fc\u30d7\u3092\u7f6e\u3044\u3066\u3044\u304f\uff08--group \u6307\u5b9a\u304c\u3042\u3063\u305f\u30b5\u30a4\u30c8\u306e\u307f\uff09 1581 for cage, group_name in groups.items(): 1582 direction = self.cages.positions[cage] - self.lattice_sites[site_index] 1583 direction -= np.floor(direction + 0.5) 1584 group = place_group( 1585 direction @ self.cell, 1586 0.13, # \u3042\u3068\u3067\u306a\u3093\u3068\u304b\u3059\u308b\u3002N-H\u7d50\u5408\u8ddd\u96e2 1587 group_name, 1588 ) 1589 sites = np.concatenate([sites, group.sites + ion_center]) 1590 atom_names += group.labels 1591 self.logger.info(f\"{atom_names=}\") 1592 return Molecule( 1593 name=name, 1594 sites=sites, 1595 labels=atom_names, 1596 is_water=False, 1597 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30b5\u30a4\u30c8 site_index\uff08\u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\uff09\u306b\u5206\u5b50\u30a4\u30aa\u30f3\uff08\u304a\u3088\u3073 spot cation \u7528\u306e\u4fee\u98fe group\uff09\u3092\u69cb\u7bc9\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>Args:     site_index: \u683c\u5b50\u30b5\u30a4\u30c8\u306e\u30ce\u30fc\u30c9\u756a\u53f7\u3002     molecule: \u5206\u5b50\u30a4\u30aa\u30f3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u540d\uff08\u4f8b: \"ammonium\"\uff09\u3002     groups: \u5f53\u8a72\u30b5\u30a4\u30c8\u306b\u96a3\u63a5\u3059\u308b\u30b1\u30fc\u30b8ID \u2192 group\u540d\u3002spot cation \u306e\u4fee\u98fe\u7528\u3002</p> <p>Returns:     \u76f4\u4ea4\u5ea7\u6a19\u3067\u914d\u7f6e\u3055\u308c\u305f Molecule\uff08\u539f\u5b50\u540d\u306f labels\uff09\u3002</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.build_hydronium\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.build_hydronium-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def build_hydronium(self, site_index: int) -&gt; genice3.molecule.Molecule: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.build_hydronium\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.build_hydronium-1625\"&gt;&lt;a href=\"#GenIce3.build_hydronium-1625\"&gt;&lt;span class=\"linenos\"&gt;1625&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;build_hydronium&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;site_index&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>1626 \"\"\"H3O+ \u3092\u69cb\u7bc9\u3059\u308b\u3002\"\"\" 1627 sites = [] 1628 labels = [\"Cn\", \"Hn\", \"Hn\", \"Hn\"] 1629 OH = 0.1 1630 sites.append(np.zeros(3)) 1631 neighbors = list(self.digraph.successors(site_index)) 1632 if len(neighbors) != 3: 1633 raise ValueError(\"H3O+ must have 3 neighbors.\") 1634 for neighbor in neighbors: 1635 direction = self.lattice_sites[neighbor] - self.lattice_sites[site_index] 1636 direction -= np.floor(direction + 0.5) 1637 direction = direction @ self.cell 1638 direction *= OH / np.linalg.norm(direction) 1639 sites.append(direction) 1640 return Molecule( 1641 name=\"H3O\", 1642 sites=np.array(sites) + self.lattice_sites[site_index] @ self.cell, 1643 labels=labels, 1644 is_water=False, 1645 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;H3O+ \u3092\u69cb\u7bc9\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.build_hydroxide\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.build_hydroxide-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def build_hydroxide(self, site_index: int) -&gt; genice3.molecule.Molecule: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.build_hydroxide\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.build_hydroxide-1647\"&gt;&lt;a href=\"#GenIce3.build_hydroxide-1647\"&gt;&lt;span class=\"linenos\"&gt;1647&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;build_hydroxide&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;site_index&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>1648 \"\"\"OH- \u3092\u69cb\u7bc9\u3059\u308b\u3002\"\"\" 1649 sites = [] 1650 labels = [\"Nx\", \"Hx\"] 1651 OH = 0.1 1652 sites.append(np.zeros(3)) 1653 neighbors = list(self.digraph.successors(site_index)) 1654 if len(neighbors) != 1: 1655 raise ValueError(f\"OH- must have 1 neighbor. {site_index=} {neighbors=}\") 1656 direction = self.lattice_sites[neighbors[0]] - self.lattice_sites[site_index] 1657 direction -= np.floor(direction + 0.5) 1658 direction = direction @ self.cell 1659 direction *= OH / np.linalg.norm(direction) 1660 sites.append(direction) 1661 return Molecule( 1662 name=\"OH\", 1663 sites=np.array(sites) + self.lattice_sites[site_index] @ self.cell, 1664 labels=labels, 1665 is_water=False, 1666 ) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;OH- \u3092\u69cb\u7bc9\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.substitutional_ions\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.substitutional_ions-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def substitutional_ions(self) -&gt; Dict[int, genice3.molecule.Molecule]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.substitutional_ions\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.substitutional_ions-1668\"&gt;&lt;a href=\"#GenIce3.substitutional_ions-1668\"&gt;&lt;span class=\"linenos\"&gt;1668&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;substitutional_ions&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"n\"&gt;Dict&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;]:&lt;/span&gt;\n</code></pre> <p>1669 \"\"\"\u5358\u4f4d\u80de\u30fbspot \u7531\u6765\u306e\u30a4\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002\"\"\" 1670 # \u5358\u4f4d\u80de\u7531\u6765\u306e group \u6307\u5b9a\u3082\u542b\u3081\u305f\u300c\u5b9f\u52b9\u7684\u306a\u300dspot_cation_groups \u3092\u3053\u3053\u3067 on-demand \u306b\u7d44\u307f\u7acb\u3066\u3066\u4f7f\u3046 1671 1672 # \u524d\u63d0\u6761\u4ef6: anions, cations, hydroniums, hydroxides\u306e\u30b5\u30a4\u30c8\u306b\u91cd\u8907\u304c\u306a\u3044\u3053\u3068\u3002 1673 # \u305d\u3046\u3067\u306a\u3044\u5834\u5408\u306f\u3001\u30a8\u30e9\u30fc\u3092\u8fd4\u3059\u3002 1674 if len(set(self.spot_hydroniums) &amp; set(self.spot_hydroxides)) &gt; 0: 1675 raise ValueError(\"hydroniums and hydroxides must not have the same site.\") 1676 if len(set(self.anions) &amp; set(self.cations)) &gt; 0: 1677 raise ValueError(\"anions and cations must not have the same site.\") 1678 if len(set(self.spot_hydroniums) &amp; set(self.cations)) &gt; 0: 1679 raise ValueError(\"hydroniums and cations must not have the same site.\") 1680 if len(set(self.spot_hydroxides) &amp; set(self.cations)) &gt; 0: 1681 raise ValueError(\"hydroxides and cations must not have the same site.\") 1682 1683 ions: Dict[int, Molecule] = {} 1684 for site_index in self.spot_hydroniums: 1685 ions[site_index] = self.build_hydronium(site_index) 1686 for site_index in self.spot_hydroxides: 1687 ions[site_index] = self.build_hydroxide(site_index) 1688 # \u306a\u3089\u3079\u304b\u3048\u306f\u3053\u3053\u3067\u306f\u3057\u306a\u3044\u3002formatter\u306b\u307e\u304b\u305b\u308b\u3002 1689 for site_index, molecule in self.anions.items(): 1690 ions[site_index] = self.build_molecular_ion(site_index, molecule) 1691 effective_groups = self._effective_spot_cation_groups() 1692 for site_index, molecule in self.cations.items(): 1693 # cation\u306b\u306f\u8155\u304c\u3064\u304f\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002 1694 groups = effective_groups.get(site_index, {}) 1695 ions[site_index] = self.build_molecular_ion(site_index, molecule, groups) 1696 self.logger.info(f\"{ions=}\") 1697 return ions </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u5358\u4f4d\u80de\u30fbspot \u7531\u6765\u306e\u30a4\u30aa\u30f3\u3092\u7d71\u5408\u3057\u3001\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3092\u8fd4\u3059\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.dope_anions\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.dope_anions-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def dope_anions(self, anions: Dict[int, genice3.molecule.Molecule]) -&gt; None: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.dope_anions\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.dope_anions-1699\"&gt;&lt;a href=\"#GenIce3.dope_anions-1699\"&gt;&lt;span class=\"linenos\"&gt;1699&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;dope_anions&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;anions&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;Dict&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;])&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"kc\"&gt;None&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>1700 \"\"\"\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002\"\"\" 1701 for site_index, molecule in anions.items(): 1702 self.anions[site_index] = molecule </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30a2\u30cb\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.dope_cations\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.dope_cations-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def dope_cations(self, cations: Dict[int, genice3.molecule.Molecule]) -&gt; None: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.dope_cations\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.dope_cations-1704\"&gt;&lt;a href=\"#GenIce3.dope_cations-1704\"&gt;&lt;span class=\"linenos\"&gt;1704&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;dope_cations&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;cations&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"n\"&gt;Dict&lt;/span&gt;&lt;span class=\"p\"&gt;[&lt;/span&gt;&lt;span class=\"nb\"&gt;int&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;])&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"kc\"&gt;None&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>1705 \"\"\"\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002\"\"\" 1706 for site_index, molecule in cations.items(): 1707 self.cations[site_index] = molecule </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30b5\u30a4\u30c8\u756a\u53f7\u2192\u5206\u5b50\u306e\u8f9e\u66f8\u3067\u30ab\u30c1\u30aa\u30f3\u914d\u7f6e\u3092\u4e0a\u66f8\u304d\u3059\u308b\uff08\u4e3b\u306b API/\u30c6\u30b9\u30c8\u7528\uff09\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.get_public_api_properties\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.get_public_api_properties-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @classmethod def get_public_api_properties(cls): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.get_public_api_properties\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.get_public_api_properties-1737\"&gt;&lt;a href=\"#GenIce3.get_public_api_properties-1737\"&gt;&lt;span class=\"linenos\"&gt;1737&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@classmethod&lt;/span&gt;\n</code></pre> <p>1738 def get_public_api_properties(cls): 1739 \"\"\" 1740        \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308bproperty\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u3002 1741 1742        Returns: 1743            list: \u516c\u958bAPI property\u540d\u306e\u30ea\u30b9\u30c8 1744        \"\"\" 1745 return cls.PUBLIC_API_PROPERTIES.copy() </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308bproperty\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     list: \u516c\u958bAPI property\u540d\u306e\u30ea\u30b9\u30c8</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.list_all_reactive_properties\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.list_all_reactive_properties-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def list_all_reactive_properties(self): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.list_all_reactive_properties\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.list_all_reactive_properties-1747\"&gt;&lt;a href=\"#GenIce3.list_all_reactive_properties-1747\"&gt;&lt;span class=\"linenos\"&gt;1747&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;list_all_reactive_properties&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1748 \"\"\" 1749        \u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08DependencyEngine\u306b\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\uff09\u3092\u5217\u6319\u3059\u308b\u3002 1750 1751        Returns: 1752            dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8 1753        \"\"\" 1754 return self.engine.registry.copy() </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u3059\u3079\u3066\u306e\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\uff08DependencyEngine\u306b\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\uff09\u3092\u5217\u6319\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.list_public_reactive_properties\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.list_public_reactive_properties-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def list_public_reactive_properties(self): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.list_public_reactive_properties\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.list_public_reactive_properties-1756\"&gt;&lt;a href=\"#GenIce3.list_public_reactive_properties-1756\"&gt;&lt;span class=\"linenos\"&gt;1756&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;list_public_reactive_properties&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"bp\"&gt;self&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>1757 \"\"\" 1758        \u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002 1759 1760        Returns: 1761            dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8 1762        \"\"\" 1763 all_reactive = self.list_all_reactive_properties() 1764 public_names = set(self.PUBLIC_API_PROPERTIES) 1765 return { 1766 name: func for name, func in all_reactive.items() if name in public_names 1767 } </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u30e6\u30fc\u30b6\u30fc\u5411\u3051API\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <p>Returns:     dict: property\u540d\u3092\u30ad\u30fc\u3001\u30bf\u30b9\u30af\u95a2\u6570\u3092\u5024\u3068\u3059\u308b\u8f9e\u66f8</p> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.list_settable_reactive_properties\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.list_settable_reactive_properties-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @classmethod def list_settable_reactive_properties(cls): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.list_settable_reactive_properties\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.list_settable_reactive_properties-1769\"&gt;&lt;a href=\"#GenIce3.list_settable_reactive_properties-1769\"&gt;&lt;span class=\"linenos\"&gt;1769&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@classmethod&lt;/span&gt;\n</code></pre> <p>1770 def list_settable_reactive_properties(cls): 1771 \"\"\"setter\u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u5909\u6570\u3092\u5217\u6319\u3059\u308b\"\"\" 1772 return { 1773 name: prop 1774 for name, prop in inspect.getmembers( 1775 cls, lambda x: isinstance(x, property) and x.fset is not None 1776 ) 1777 } </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;setter\u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u306a\u5909\u6570\u3092\u5217\u6319\u3059\u308b&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n                        &lt;div id=\"GenIce3.list_public_settable_reactive_properties\" class=\"classattr\"&gt;\n                                    &lt;input id=\"GenIce3.list_public_settable_reactive_properties-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> @classmethod def list_public_settable_reactive_properties(cls): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#GenIce3.list_public_settable_reactive_properties\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"GenIce3.list_public_settable_reactive_properties-1779\"&gt;&lt;a href=\"#GenIce3.list_public_settable_reactive_properties-1779\"&gt;&lt;span class=\"linenos\"&gt;1779&lt;/span&gt;&lt;/a&gt;    &lt;span class=\"nd\"&gt;@classmethod&lt;/span&gt;\n</code></pre> <p>1780 def list_public_settable_reactive_properties(cls): 1781 \"\"\"\u516c\u958bAPI\u306e\u3046\u3061\u3001setter \u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002\"\"\" 1782 return { 1783 name: prop 1784 for name, prop in cls.list_settable_reactive_properties().items() 1785 if name in cls.PUBLIC_API_PROPERTIES 1786 } </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;\u516c\u958bAPI\u306e\u3046\u3061\u3001setter \u3092\u6301\u3064\u30ea\u30a2\u30af\u30c6\u30a3\u30d6\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u307f\u3092\u5217\u6319\u3059\u308b\u3002&lt;/p&gt;\n</code></pre> <pre><code>                        &lt;/div&gt;\n            &lt;/section&gt;\n&lt;/main&gt;\n</code></pre> <p>pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert &gt; em{display:none;}.pdoc .alert &gt; :last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E\");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E\");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E\");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E\");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E\");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E\");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc &gt; section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc &gt; section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc &gt; section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc &gt; section:not(.module-info) h4{font-size:1.2rem;}.pdoc &gt; section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a &gt; code{color:inherit;}.pdoc pre &gt; code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc &gt; section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button &gt; span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:\"View Source\";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code &gt; pre &gt; span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code &gt; pre &gt; span:target{display:block;}.pdoc div:target &gt; .attr,.pdoc section:target &gt; .attr,.pdoc dd:target &gt; a{background-color:var(--active);}.pdoc {scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:\"#\";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target &gt; .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:\"show\";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:\"hide\";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:\", \";}.pdoc .inherited .class:before{content:\"class \";}.pdoc .inherited .function a:after{content:\"()\";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused &gt; .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</p>"},{"location":"api/genice3/plugin/","title":"Plugin","text":"<pre><code>&lt;main class=\"pdoc\"&gt;\n        &lt;section class=\"module-info\"&gt;\n                &lt;h1 class=\"modulename\"&gt;\n</code></pre> <p>genice3.plugin    </p> <pre><code>                    &lt;div class=\"docstring\"&gt;&lt;p&gt;Plugin handler.&lt;/p&gt;\n</code></pre> <pre><code>                    &lt;input id=\"mod-plugin-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n\n                    &lt;label class=\"view-source-button\" for=\"mod-plugin-view-source\"&gt;&lt;span&gt;View Source&lt;/span&gt;&lt;/label&gt;\n\n                    &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"L-1\"&gt;&lt;a href=\"#L-1\"&gt;&lt;span class=\"linenos\"&gt;  1&lt;/span&gt;&lt;/a&gt;&lt;span class=\"sd\"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;\n</code></pre> <p>  2Plugin handler.   3\"\"\"   4   5import glob   6import importlib   7import os   8import re   9import sys  10from collections import defaultdict  11from logging import DEBUG, INFO, basicConfig, getLogger  12from textwrap import fill  13from typing import Any, Dict, List, Sequence, Tuple, Union  14  15# import pkg_resources as pr  16  17if sys.version_info &lt; (3, 10):  18 from importlib_metadata import entry_points  19else:  20 from importlib.metadata import entry_points  21  22  23def normalize_unitcell_options(  24 options: Sequence[Union[Tuple[str, str], Dict[str, Any]]],  25) -&gt; List[Dict[str, Any]]:  26 \"\"\"(name, help) or dict \u306e\u30ea\u30b9\u30c8\u3092 {name, help, required?, example?} \u306e\u30ea\u30b9\u30c8\u306b\u7d71\u4e00\u3002\"\"\"  27 result = []  28 for opt in options:  29 if isinstance(opt, dict):  30 result.append({  31 \"name\": str(opt[\"name\"]),  32 \"help\": str(opt.get(\"help\", opt.get(\"brief\", \"\"))),  33 \"required\": bool(opt.get(\"required\", False)),  34 \"example\": opt.get(\"example\"),  35 })  36 else:  37 name, help = opt[0], opt[1]  38 required = opt[2] if len(opt) &gt; 2 else False  39 example = opt[3] if len(opt) &gt; 3 else None  40 result.append({  41 \"name\": str(name),  42 \"help\": str(help_),  43 \"required\": bool(required),  44 \"example\": example,  45 })  46 return result  47  48  49def format_unitcell_usage(  50 unitcell_name: str, options: Sequence[Union[Tuple[str, str], Dict[str, Any]]]  51) -&gt; Dict[str, str]:  52 \"\"\"  53    options \u69cb\u9020\u4f53\u304b\u3089 CLI / API / YAML \u306e 3 \u8868\u8a18\u3092\u751f\u6210\u3059\u308b\u3002  54    Returns:  55        {\"cli\": \"...\", \"api\": \"...\", \"yaml\": \"...\"}  56    \"\"\"  57 opts = normalize_unitcell_options(options)  58 cli_parts = [f\"genice3 {unitcell_name}\"]  59 api_args = []  60 yaml_lines = [f\"unitcell:\", f\"  name: {unitcell_name}\"]  61 for o in opts:  62 ex = o.get(\"example\")  63 ex_str = str(ex) if ex is not None else \"VALUE\"  64 cli_parts.append(f\"--{o['name']} {ex_str}\")  65 if o.get(\"required\"):  66 cli_parts.append(\"(required)\")  67 api_args.append(f\"{o['name']}={repr(ex)}\" if ex is not None else f\"{o['name']}=None\")  68 yaml_lines.append(f\"  {o['name']}: {ex}\" if ex is not None else f\"  {o['name']}: ...\")  69 return {  70 \"cli\": \" \".join(cli_parts) + \"\\n  \" + \"\\n  \".join(f\"--{o['name']}: {o['help']}\" for o in opts),  71 \"api\": f'UnitCell(\"{unitcell_name}\", ' + \", \".join(api_args) + \")\",  72 \"yaml\": \"\\n\".join(yaml_lines),  73 }  74  75  76def _is_water_module(module, category):  77 \"\"\"Return True if the module is a water model (for molecule plugins).\"\"\"  78 if category != \"molecule\":  79 return False  80 if \"water\" in module.__dict__:  81 return True  82 if hasattr(module, \"Molecule\"):  83 try:  84 m = module.Molecule()  85 return getattr(m, \"is_water\", False)  86 except Exception:  87 pass  88 return False  89  90  91def scan(category):  92 \"\"\"  93    Scan available plugins.  94    \"\"\"  95 logger = getLogger()  96  97 modules = {}  98 desc = dict()  99 iswater = dict() 100 refs = dict() 101 tests = dict() 102 103 logger.info(f\"\\nPredefined {category}\") 104 module = importlib.import_module(f\"genice3.{category}\") 105 mods = [] 106 for path in module.__path__: 107 for mod in sorted(glob.glob(path + \"/.py\")): 108 mod = os.path.basename(mod)[:-3] 109 if mod[:2] != \"\": 110 mods.append(mod) 111 logger.info(mods) 112 modules[\"system\"] = mods 113 114 for mod in modules[\"system\"]: 115 try: 116 module = importlib.import_module(f\"genice3.{category}.{mod}\") 117 if \"desc\" in module.__dict: 118 desc[mod] = module.desc[\"brief\"] 119 if \"ref\" in module.desc: 120 refs[mod] = module.desc[\"ref\"] 121 if \"test\" in module.desc: 122 tests[mod] = module.desc[\"test\"] 123 iswater[mod] = is_water_module(module, category) 124 except BaseException: 125 pass 126 127 logger.info(f\"Extra {category}\") 128 groupname = f\"genice3{category}\" 129 mods = [] 130 # for ep in pr.iter_entry_points(group=groupname): 131 for ep in entry_points(group=groupname): 132 mods.append(ep.name) 133 try: 134 module = ep.load() 135 if \"desc\" in module.dict: 136 desc[ep.name] = module.desc[\"brief\"] 137 if \"ref\" in module.desc: 138 refs[ep.name] = module.desc[\"ref\"] 139 if \"test\" in module.desc: 140 tests[mod] = module.desc[\"test\"] 141 iswater[ep.name] = _is_water_module(module, category) 142 except BaseException: 143 pass 144 logger.info(mods) 145 modules[\"extra\"] = mods 146 147 logger.info(f\"Local {category}\") 148 mods = [ 149 os.path.basename(mod)[:-3] for mod in sorted(glob.glob(f\"./{category}/.py\")) 150 ] 151 logger.info(mods) 152 for mod in mods: 153 module = importlib.import_module(f\"{category}.{mod}\") 154 if \"desc\" in module.dict: 155 desc[mod] = module.desc[\"brief\"] 156 if \"ref\" in module.desc: 157 refs[mod] = module.desc[\"ref\"] 158 if \"test\" in module.desc: 159 tests[mod] = module.desc[\"test\"] 160 iswater[mod] = _is_water_module(module, category) 161 logger.info(mods) 162 modules[\"local\"] = mods 163 modules[\"desc\"] = desc 164 modules[\"iswater\"] = iswater 165 modules[\"refs\"] = refs 166 modules[\"tests\"] = tests 167 168 return modules 169 170 171def descriptions(category, width=72, water=False, groups=(\"system\", \"extra\", \"local\")): 172 \"\"\" 173    Show the list of available plugins in the category. 174 175    Options: 176      width=72      Width of the output. 177      water=False   Pick up water molecules only (for molecule plugin). 178    \"\"\" 179 titles = { 180 \"lattice\": { 181 \"system\": \"1. Lattice structures served with GenIce\", 182 \"extra\": \"2. Lattice structures served by external plugins\", 183 \"local\": \"3. Lattice structures served locally\", 184 \"title\": \"[Available lattice structures]\", 185 }, 186 \"format\": { 187 \"system\": \"1. Formatters served with GenIce\", 188 \"extra\": \"2. Formatters served by external plugins\", 189 \"local\": \"3. Formatters served locally\", 190 \"title\": \"[Available formatters]\", 191 }, 192 \"loader\": { 193 \"system\": \"1. File types served with GenIce\", 194 \"extra\": \"2. File types served by external eplugins\", 195 \"local\": \"3. File types served locally\", 196 \"title\": \"[Available input file types]\", 197 }, 198 \"molecule\": { 199 \"system\": \"1. Molecules served with GenIce\", 200 \"extra\": \"2. Molecules served by external plugins\", 201 \"local\": \"3. Molecules served locally\", 202 \"title\": \"[Available molecules]\", 203 }, 204 } 205 mods = scan(category) 206 catalog = f\" \\n \\n{titles[category]['title']}\\n \\n\" 207 desc = mods[\"desc\"] 208 iswater = mods[\"iswater\"] 209 for group in groups: 210 desced = defaultdict(list) 211 undesc = [] 212 for L in mods[group]: 213 if category == \"molecule\": 214 if L not in iswater: 215 iswater[L] = False 216 if water and not iswater[L]: 217 continue 218 if not water and iswater[L]: 219 continue 220 if L in desc: 221 desced[desc[L]].append(L) 222 else: 223 undesc.append(L) 224 for dd in desced: 225 desced[dd] = \", \".join(desced[dd]) 226 catalog += f\"{titles[category][group]}\\n \\n\" 227 table = \"\" 228 for dd in sorted(desced, key=lambda x: desced[x]): 229 table += f\"{desced[dd]}\\t{dd}\\n\" 230 if table == \"\": 231 table = \"(None)\\n\" 232 table = [ 233 fill( 234 line, 235 width=width, 236 drop_whitespace=False, 237 expand_tabs=True, 238 tabsize=16, 239 subsequent_indent=\" \" 16, 240 ) 241 for line in table.splitlines() 242 ] 243 table = \"\\n\".join(table) + \"\\n\" 244 undesc = \" \".join(undesc) 245 if undesc != \"\": 246 undesc = \"(Undocumented) \" + undesc 247 catalog += table + \"----\\n\" + undesc + \"\\n \\n \\n\" 248 return catalog 249 250 251def plugin_descriptors(category, water=False, groups=(\"system\", \"extra\", \"local\")): 252 \"\"\" 253    Show the list of available plugins in the category. 254 255    Options: 256      water=False   Pick up water molecules only (for molecule plugin). 257    \"\"\" 258 mods = scan(category) 259 catalog = dict() 260 desc = mods[\"desc\"] 261 iswater = mods[\"iswater\"] 262 refs = mods[\"refs\"] 263 for group in groups: 264 desced = defaultdict(list) 265 undesc = [] 266 refss = defaultdict(set) 267 for L in mods[group]: 268 if category == \"molecule\": 269 if L not in iswater: 270 iswater[L] = False 271 if water and not iswater[L]: 272 continue 273 if not water and iswater[L]: 274 continue 275 if L in desc: 276 # desc[L] is the brief description of the module 277 # L is the name of module (name of ice) 278 desced[desc[L]].append(L) 279 if L in refs: 280 refss[desc[L]] |= set([label for key, label in refs[L].items()]) 281 else: 282 undesc.append(L) 283 catalog[group] = [desced, undesc, refss] 284 return catalog 285 286 287def audit_name(name: str, category: str = \"plugin\") -&gt; str: 288 \"\"\" 289    Audit the mol name to avoid the access to unexpected files 290    \"\"\" 291 match = re.match(\"^[A-Za-z0-9-]+$\", name) 292 if match is not None: 293 return name 294 match = re.match(r\"^[([A-Za-z0-9-]+) .]$\", name) 295 if match is not None: 296 return match.group(1) 297 raise ValueError(f\"Dubious {category} name: {name}\") 298 299 300def import_extra(category, name): 301 logger = getLogger() 302 logger.info(f\"Extra {category} plugin: {name}\") 303 groupname = f\"genice3{category}\" 304 module = None 305 # for ep in pr.iter_entry_points(group=groupname): 306 for ep in entry_points(group=groupname): 307 logger.debug(f\"    Entry point: {ep}\") 308 if ep.name == name: 309 logger.debug(f\"      Loading {name}...\") 310 module = ep.load() 311 if module is None: 312 raise ImportError(f\"Nonexistent or failed to load the {category} module: {name}\") 313 return module 314 315 316def safe_import(category, name): 317 \"\"\" 318    Load a plugin. 319 320    The plugins can exist either in the system, as a extra plugin, or in the 321    local folder. 322 323    category: The type of the plugin; \"lattice\", \"format\", \"molecule\", or \"loader\". 324    name:     The name of the plugin. 325    \"\"\" 326 logger = getLogger() 327 if category not in (\"exporter\", \"molecule\", \"unitcell\", \"group\"): 328 raise ValueError( 329 f\"category must be 'exporter', 'molecule', 'unitcell', or 'group', got: {category}\" 330 ) 331 332 # single ? as a plugin name ==&gt; show descriptions (list all) 333 if name == \"?\": 334 print(descriptions(category)) 335 sys.exit(0) 336 337 # SYMBOL? ==&gt; show usage for that plugin (then exit) 338 usage = False 339 if len(name) &gt; 1 and name[-1] == \"?\": 340 usage = True 341 name = name[:-1] 342 343 module_name = audit_name(name, category) 344 345 module = None 346 fullname = f\"{category}.{module_name}\" 347 logger.debug(f\"Try to Load a local module: {fullname}\") 348 # \u307e\u305a\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 path \u306b\u633f\u5165\u3057\u3066\u8a66\u3059\uff08\u5b9f\u884c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e group/ \u7b49\u3092\u8aad\u3080\u305f\u3081\uff09 349 cwd = os.getcwd() 350 path_inserted = cwd not in sys.path 351 if path_inserted: 352 sys.path.insert(0, cwd) 353 try: 354 try: 355 module = importlib.import_module(fullname) 356 logger.debug(\"Succeeded (local from cwd or path).\") 357 except ModuleNotFoundError: 358 logger.debug(f\"Module not found: {fullname}\") 359 module = None 360 except ImportError as e: 361 logger.error(f\"Error importing module {fullname}: {str(e)}\") 362 raise 363 finally: 364 if path_inserted and sys.path and sys.path[0] == cwd: 365 sys.path.pop(0) 366 if module is None: 367 fullname = f\"genice3.{category}.{module_name}\" 368 logger.debug(f\"Try to load a system module: {fullname}\") 369 try: 370 module = importlib.import_module(fullname) 371 logger.debug(\"Succeeded.\") 372 except ModuleNotFoundError: 373 logger.debug(f\"Module not found: {fullname}\") 374 module = None 375 except ImportError as e: 376 logger.error(f\"Error importing module {fullname}: {str(e)}\") 377 raise 378 if module is None: 379 logger.debug(f\"Try to load an extra module: {fullname}\") 380 module = import_extra(category, module_name) 381 logger.debug(\"Succeeded.\") 382 383 if usage: 384 if \"desc\" in module.dict: 385 d = module.desc 386 logger.info(f\"Usage for '{name}' plugin\") 387 if category == \"unitcell\" and d.get(\"options\"): 388 u = format_unitcell_usage(name, d[\"options\"]) 389 print(\"CLI:  \", u[\"cli\"]) 390 print(\"API:  \", u[\"api\"]) 391 print(\"YAML:\\n\", u[\"yaml\"]) 392 elif d.get(\"usage\"): 393 print(d[\"usage\"]) 394 else: 395 print(\"(no usage)\") 396 sys.exit(0) 397 398 return module 399 400 401def UnitCell(name, kwargs): 402 \"\"\" 403    Shortcut for safe_import. 404    \"\"\" 405 return safe_import(\"unitcell\", name).UnitCell(kwargs) 406 407 408def Molecule(name, kwargs): 409 \"\"\" 410    Shortcut for safe_import. 411    \"\"\" 412 return safe_import(\"molecule\", name).Molecule(kwargs) 413 414 415def Exporter(name, kwargs): 416 \"\"\" 417    Shortcut for safe_import. 418    \"\"\" 419 return safe_import(\"exporter\", name) 420 421 422def Group(name, kwargs): 423 \"\"\" 424    Shortcut for safe_import. 425    \"\"\" 426 return safe_import(\"group\", name).Group(**kwargs) 427 428 429def get_exporter_format_rows(category=\"exporter\", groups=(\"system\", \"extra\", \"local\")): 430 \"\"\" 431    Collect format_desc from all exporter plugins and return rows for the README table. 432 433    Each exporter module may define a <code>format_desc</code> dict with keys: 434      aliases: list of option names (e.g. [\"g\", \"gromacs\"]) 435      application: str (markdown allowed) 436      extension: str (e.g. \".gro\") 437      water: str (e.g. \"Atomic positions\") 438      solute: str 439      hb: str (e.g. \"none\", \"o\", \"auto\") 440      remarks: str 441      suboptions: str (optional; short description of :key value options, e.g. \"water_model: 3site, 4site, 6site, tip4p\") 442 443    Returns a list of dicts with keys name, application, extension, water, solute, hb, remarks, suboptions. 444    \"\"\" 445 logger = getLogger() 446 mods = scan(category) 447 rows = [] 448 seen = set() 449 450 for group in groups: 451 for name in mods.get(group, []): 452 if name in seen: 453 continue 454 try: 455 if group == \"system\": 456 mod = importlib.import_module(f\"genice3.{category}.{name}\") 457 elif group == \"extra\": 458 mod = None 459 for ep in entry_points(group=f\"genice3_{category}\"): 460 if ep.name == name: 461 mod = ep.load() 462 break 463 if mod is None: 464 continue 465 else: 466 try: 467 mod = importlib.import_module(f\"{category}.{name}\") 468 except ModuleNotFoundError: 469 continue 470 if not hasattr(mod, \"format_desc\"): 471 continue 472 fd = mod.format_desc 473 aliases = fd.get(\"aliases\", [name]) 474 name_col = \", \".join(f\"<code>&lt;/span&gt;&lt;span class=\"si\"&gt;{&lt;/span&gt;&lt;span class=\"n\"&gt;a&lt;/span&gt;&lt;span class=\"si\"&gt;}&lt;/span&gt;&lt;span class=\"s2\"&gt;</code>\" for a in aliases) 475 rows.append( 476 { 477 \"name\": name_col, 478 \"application\": fd.get(\"application\", \"\"), 479 \"extension\": fd.get(\"extension\", \"\"), 480 \"water\": fd.get(\"water\", \"\"), 481 \"solute\": fd.get(\"solute\", \"\"), 482 \"hb\": fd.get(\"hb\", \"\"), 483 \"remarks\": fd.get(\"remarks\", \"\"), 484 \"suboptions\": fd.get(\"suboptions\", \"\"), 485 } 486 ) 487 seen.add(name) 488 except Exception as e: 489 logger.debug(f\"Skip {name} for format table: {e}\") 490 return rows 491 492 493if name == \"main\": 494 basicConfig(level=INFO) 495 if len(sys.argv) == 1: 496 cats = (\"lattice\", \"format\", \"molecule\", \"loader\") 497 else: 498 cats = sys.argv[1:] 499 modules = {cat: scan(cat) for cat in cats} 500 print(modules) <pre><code>        &lt;/section&gt;\n            &lt;section id=\"format_unitcell_usage\"&gt;\n                        &lt;input id=\"format_unitcell_usage-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def format_unitcell_usage( unitcell_name: str, options: Sequence[Union[Tuple[str, str], Dict[str, Any]]]) -&gt; Dict[str, str]: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#format_unitcell_usage\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"format_unitcell_usage-50\"&gt;&lt;a href=\"#format_unitcell_usage-50\"&gt;&lt;span class=\"linenos\"&gt;50&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;format_unitcell_usage&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;\n</code></pre> <p>51 unitcell_name: str, options: Sequence[Union[Tuple[str, str], Dict[str, Any]]] 52) -&gt; Dict[str, str]: 53 \"\"\" 54    options \u69cb\u9020\u4f53\u304b\u3089 CLI / API / YAML \u306e 3 \u8868\u8a18\u3092\u751f\u6210\u3059\u308b\u3002 55    Returns: 56        {\"cli\": \"...\", \"api\": \"...\", \"yaml\": \"...\"} 57    \"\"\" 58 opts = _normalize_unitcell_options(options) 59 cli_parts = [f\"genice3 {unitcell_name}\"] 60 api_args = [] 61 yaml_lines = [f\"unitcell:\", f\"  name: {unitcell_name}\"] 62 for o in opts: 63 ex = o.get(\"example\") 64 ex_str = str(ex) if ex is not None else \"VALUE\" 65 cli_parts.append(f\"--{o['name']} {ex_str}\") 66 if o.get(\"required\"): 67 cli_parts.append(\"(required)\") 68 api_args.append(f\"{o['name']}={repr(ex)}\" if ex is not None else f\"{o['name']}=None\") 69 yaml_lines.append(f\"  {o['name']}: {ex}\" if ex is not None else f\"  {o['name']}: ...\") 70 return { 71 \"cli\": \" \".join(cli_parts) + \"\\n  \" + \"\\n  \".join(f\"--{o['name']}: {o['help']}\" for o in opts), 72 \"api\": f'UnitCell(\"{unitcell_name}\", ' + \", \".join(api_args) + \")\", 73 \"yaml\": \"\\n\".join(yaml_lines), 74 } </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;options \u69cb\u9020\u4f53\u304b\u3089 CLI / API / YAML \u306e 3 \u8868\u8a18\u3092\u751f\u6210\u3059\u308b\u3002\n</code></pre> <p>Returns:     {\"cli\": \"...\", \"api\": \"...\", \"yaml\": \"...\"}</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"scan\"&gt;\n                        &lt;input id=\"scan-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def scan(category): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#scan\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"scan-92\"&gt;&lt;a href=\"#scan-92\"&gt;&lt;span class=\"linenos\"&gt; 92&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;scan&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p> 93 \"\"\"  94    Scan available plugins.  95    \"\"\"  96 logger = getLogger()  97  98 modules = {}  99 desc = dict() 100 iswater = dict() 101 refs = dict() 102 tests = dict() 103 104 logger.info(f\"\\nPredefined {category}\") 105 module = importlib.import_module(f\"genice3.{category}\") 106 mods = [] 107 for path in module.path: 108 for mod in sorted(glob.glob(path + \"/.py\")): 109 mod = os.path.basename(mod)[:-3] 110 if mod[:2] != \"\": 111 mods.append(mod) 112 logger.info(mods) 113 modules[\"system\"] = mods 114 115 for mod in modules[\"system\"]: 116 try: 117 module = importlib.import_module(f\"genice3.{category}.{mod}\") 118 if \"desc\" in module.__dict: 119 desc[mod] = module.desc[\"brief\"] 120 if \"ref\" in module.desc: 121 refs[mod] = module.desc[\"ref\"] 122 if \"test\" in module.desc: 123 tests[mod] = module.desc[\"test\"] 124 iswater[mod] = is_water_module(module, category) 125 except BaseException: 126 pass 127 128 logger.info(f\"Extra {category}\") 129 groupname = f\"genice3{category}\" 130 mods = [] 131 # for ep in pr.iter_entry_points(group=groupname): 132 for ep in entry_points(group=groupname): 133 mods.append(ep.name) 134 try: 135 module = ep.load() 136 if \"desc\" in module.dict: 137 desc[ep.name] = module.desc[\"brief\"] 138 if \"ref\" in module.desc: 139 refs[ep.name] = module.desc[\"ref\"] 140 if \"test\" in module.desc: 141 tests[mod] = module.desc[\"test\"] 142 iswater[ep.name] = _is_water_module(module, category) 143 except BaseException: 144 pass 145 logger.info(mods) 146 modules[\"extra\"] = mods 147 148 logger.info(f\"Local {category}\") 149 mods = [ 150 os.path.basename(mod)[:-3] for mod in sorted(glob.glob(f\"./{category}/.py\")) 151 ] 152 logger.info(mods) 153 for mod in mods: 154 module = importlib.import_module(f\"{category}.{mod}\") 155 if \"desc\" in module.dict: 156 desc[mod] = module.desc[\"brief\"] 157 if \"ref\" in module.desc: 158 refs[mod] = module.desc[\"ref\"] 159 if \"test\" in module.desc: 160 tests[mod] = module.desc[\"test\"] 161 iswater[mod] = _is_water_module(module, category) 162 logger.info(mods) 163 modules[\"local\"] = mods 164 modules[\"desc\"] = desc 165 modules[\"iswater\"] = iswater 166 modules[\"refs\"] = refs 167 modules[\"tests\"] = tests 168 169 return modules <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Scan available plugins.&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"descriptions\"&gt;\n                        &lt;input id=\"descriptions-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def descriptions(category, width=72, water=False, groups=('system', 'extra', 'local')): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#descriptions\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"descriptions-172\"&gt;&lt;a href=\"#descriptions-172\"&gt;&lt;span class=\"linenos\"&gt;172&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;descriptions&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;width&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"mi\"&gt;72&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;water&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"kc\"&gt;False&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;groups&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"s2\"&gt;&amp;quot;system&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;extra&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;local&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;)):&lt;/span&gt;\n</code></pre> <p>173 \"\"\" 174    Show the list of available plugins in the category. 175 176    Options: 177      width=72      Width of the output. 178      water=False   Pick up water molecules only (for molecule plugin). 179    \"\"\" 180 titles = { 181 \"lattice\": { 182 \"system\": \"1. Lattice structures served with GenIce\", 183 \"extra\": \"2. Lattice structures served by external plugins\", 184 \"local\": \"3. Lattice structures served locally\", 185 \"title\": \"[Available lattice structures]\", 186 }, 187 \"format\": { 188 \"system\": \"1. Formatters served with GenIce\", 189 \"extra\": \"2. Formatters served by external plugins\", 190 \"local\": \"3. Formatters served locally\", 191 \"title\": \"[Available formatters]\", 192 }, 193 \"loader\": { 194 \"system\": \"1. File types served with GenIce\", 195 \"extra\": \"2. File types served by external eplugins\", 196 \"local\": \"3. File types served locally\", 197 \"title\": \"[Available input file types]\", 198 }, 199 \"molecule\": { 200 \"system\": \"1. Molecules served with GenIce\", 201 \"extra\": \"2. Molecules served by external plugins\", 202 \"local\": \"3. Molecules served locally\", 203 \"title\": \"[Available molecules]\", 204 }, 205 } 206 mods = scan(category) 207 catalog = f\" \\n \\n{titles[category]['title']}\\n \\n\" 208 desc = mods[\"desc\"] 209 iswater = mods[\"iswater\"] 210 for group in groups: 211 desced = defaultdict(list) 212 undesc = [] 213 for L in mods[group]: 214 if category == \"molecule\": 215 if L not in iswater: 216 iswater[L] = False 217 if water and not iswater[L]: 218 continue 219 if not water and iswater[L]: 220 continue 221 if L in desc: 222 desced[desc[L]].append(L) 223 else: 224 undesc.append(L) 225 for dd in desced: 226 desced[dd] = \", \".join(desced[dd]) 227 catalog += f\"{titles[category][group]}\\n \\n\" 228 table = \"\" 229 for dd in sorted(desced, key=lambda x: desced[x]): 230 table += f\"{desced[dd]}\\t{dd}\\n\" 231 if table == \"\": 232 table = \"(None)\\n\" 233 table = [ 234 fill( 235 line, 236 width=width, 237 drop_whitespace=False, 238 expand_tabs=True, 239 tabsize=16, 240 subsequent_indent=\" \" * 16, 241 ) 242 for line in table.splitlines() 243 ] 244 table = \"\\n\".join(table) + \"\\n\" 245 undesc = \" \".join(undesc) 246 if undesc != \"\": 247 undesc = \"(Undocumented) \" + undesc 248 catalog += table + \"----\\n\" + undesc + \"\\n \\n \\n\" 249 return catalog </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Show the list of available plugins in the category.&lt;/p&gt;\n</code></pre> <p>Options:   width=72      Width of the output.   water=False   Pick up water molecules only (for molecule plugin).</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"plugin_descriptors\"&gt;\n                        &lt;input id=\"plugin_descriptors-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def plugin_descriptors(category, water=False, groups=('system', 'extra', 'local')): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#plugin_descriptors\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"plugin_descriptors-252\"&gt;&lt;a href=\"#plugin_descriptors-252\"&gt;&lt;span class=\"linenos\"&gt;252&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;plugin_descriptors&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;water&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"kc\"&gt;False&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;groups&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"s2\"&gt;&amp;quot;system&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;extra&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;local&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;)):&lt;/span&gt;\n</code></pre> <p>253 \"\"\" 254    Show the list of available plugins in the category. 255 256    Options: 257      water=False   Pick up water molecules only (for molecule plugin). 258    \"\"\" 259 mods = scan(category) 260 catalog = dict() 261 desc = mods[\"desc\"] 262 iswater = mods[\"iswater\"] 263 refs = mods[\"refs\"] 264 for group in groups: 265 desced = defaultdict(list) 266 undesc = [] 267 refss = defaultdict(set) 268 for L in mods[group]: 269 if category == \"molecule\": 270 if L not in iswater: 271 iswater[L] = False 272 if water and not iswater[L]: 273 continue 274 if not water and iswater[L]: 275 continue 276 if L in desc: 277 # desc[L] is the brief description of the module 278 # L is the name of module (name of ice) 279 desced[desc[L]].append(L) 280 if L in refs: 281 refss[desc[L]] |= set([label for key, label in refs[L].items()]) 282 else: 283 undesc.append(L) 284 catalog[group] = [desced, undesc, refss] 285 return catalog </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Show the list of available plugins in the category.&lt;/p&gt;\n</code></pre> <p>Options:   water=False   Pick up water molecules only (for molecule plugin).</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"audit_name\"&gt;\n                        &lt;input id=\"audit_name-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def audit_name(name: str, category: str = 'plugin') -&gt; str: View Source <pre><code>&lt;a class=\"headerlink\" href=\"#audit_name\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"audit_name-288\"&gt;&lt;a href=\"#audit_name-288\"&gt;&lt;span class=\"linenos\"&gt;288&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;audit_name&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;str&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt; &lt;span class=\"nb\"&gt;str&lt;/span&gt; &lt;span class=\"o\"&gt;=&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;plugin&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;)&lt;/span&gt; &lt;span class=\"o\"&gt;-&amp;gt;&lt;/span&gt; &lt;span class=\"nb\"&gt;str&lt;/span&gt;&lt;span class=\"p\"&gt;:&lt;/span&gt;\n</code></pre> <p>289 \"\"\" 290    Audit the mol name to avoid the access to unexpected files 291    \"\"\" 292 match = re.match(\"^[A-Za-z0-9-]+$\", name) 293 if match is not None: 294 return name 295 match = re.match(r\"^[([A-Za-z0-9-]+) .*]$\", name) 296 if match is not None: 297 return match.group(1) 298 raise ValueError(f\"Dubious {category} name: {name}\") <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Audit the mol name to avoid the access to unexpected files&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"import_extra\"&gt;\n                        &lt;input id=\"import_extra-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def import_extra(category, name): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#import_extra\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"import_extra-301\"&gt;&lt;a href=\"#import_extra-301\"&gt;&lt;span class=\"linenos\"&gt;301&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;import_extra&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>302 logger = getLogger() 303 logger.info(f\"Extra {category} plugin: {name}\") 304 groupname = f\"genice3_{category}\" 305 module = None 306 # for ep in pr.iter_entry_points(group=groupname): 307 for ep in entry_points(group=groupname): 308 logger.debug(f\"    Entry point: {ep}\") 309 if ep.name == name: 310 logger.debug(f\"      Loading {name}...\") 311 module = ep.load() 312 if module is None: 313 raise ImportError(f\"Nonexistent or failed to load the {category} module: {name}\") 314 return module </p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"safe_import\"&gt;\n                        &lt;input id=\"safe_import-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def safe_import(category, name): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#safe_import\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"safe_import-317\"&gt;&lt;a href=\"#safe_import-317\"&gt;&lt;span class=\"linenos\"&gt;317&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;safe_import&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>318 \"\"\" 319    Load a plugin. 320 321    The plugins can exist either in the system, as a extra plugin, or in the 322    local folder. 323 324    category: The type of the plugin; \"lattice\", \"format\", \"molecule\", or \"loader\". 325    name:     The name of the plugin. 326    \"\"\" 327 logger = getLogger() 328 if category not in (\"exporter\", \"molecule\", \"unitcell\", \"group\"): 329 raise ValueError( 330 f\"category must be 'exporter', 'molecule', 'unitcell', or 'group', got: {category}\" 331 ) 332 333 # single ? as a plugin name ==&gt; show descriptions (list all) 334 if name == \"?\": 335 print(descriptions(category)) 336 sys.exit(0) 337 338 # SYMBOL? ==&gt; show usage for that plugin (then exit) 339 usage = False 340 if len(name) &gt; 1 and name[-1] == \"?\": 341 usage = True 342 name = name[:-1] 343 344 module_name = audit_name(name, category) 345 346 module = None 347 fullname = f\"{category}.{module_name}\" 348 logger.debug(f\"Try to Load a local module: {fullname}\") 349 # \u307e\u305a\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 path \u306b\u633f\u5165\u3057\u3066\u8a66\u3059\uff08\u5b9f\u884c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e group/ \u7b49\u3092\u8aad\u3080\u305f\u3081\uff09 350 cwd = os.getcwd() 351 path_inserted = cwd not in sys.path 352 if path_inserted: 353 sys.path.insert(0, cwd) 354 try: 355 try: 356 module = importlib.import_module(fullname) 357 logger.debug(\"Succeeded (local from cwd or path).\") 358 except ModuleNotFoundError: 359 logger.debug(f\"Module not found: {fullname}\") 360 module = None 361 except ImportError as e: 362 logger.error(f\"Error importing module {fullname}: {str(e)}\") 363 raise 364 finally: 365 if path_inserted and sys.path and sys.path[0] == cwd: 366 sys.path.pop(0) 367 if module is None: 368 fullname = f\"genice3.{category}.{module_name}\" 369 logger.debug(f\"Try to load a system module: {fullname}\") 370 try: 371 module = importlib.import_module(fullname) 372 logger.debug(\"Succeeded.\") 373 except ModuleNotFoundError: 374 logger.debug(f\"Module not found: {fullname}\") 375 module = None 376 except ImportError as e: 377 logger.error(f\"Error importing module {fullname}: {str(e)}\") 378 raise 379 if module is None: 380 logger.debug(f\"Try to load an extra module: {fullname}\") 381 module = import_extra(category, module_name) 382 logger.debug(\"Succeeded.\") 383 384 if usage: 385 if \"desc\" in module.dict: 386 d = module.desc 387 logger.info(f\"Usage for '{name}' plugin\") 388 if category == \"unitcell\" and d.get(\"options\"): 389 u = format_unitcell_usage(name, d[\"options\"]) 390 print(\"CLI:  \", u[\"cli\"]) 391 print(\"API:  \", u[\"api\"]) 392 print(\"YAML:\\n\", u[\"yaml\"]) 393 elif d.get(\"usage\"): 394 print(d[\"usage\"]) 395 else: 396 print(\"(no usage)\") 397 sys.exit(0) 398 399 return module </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Load a plugin.&lt;/p&gt;\n</code></pre> <p>The plugins can exist either in the system, as a extra plugin, or in the local folder.</p> <p>category: The type of the plugin; \"lattice\", \"format\", \"molecule\", or \"loader\". name:     The name of the plugin.</p> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"UnitCell\"&gt;\n                        &lt;input id=\"UnitCell-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def UnitCell(name, **kwargs): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#UnitCell\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"UnitCell-402\"&gt;&lt;a href=\"#UnitCell-402\"&gt;&lt;span class=\"linenos\"&gt;402&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;UnitCell&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"o\"&gt;**&lt;/span&gt;&lt;span class=\"n\"&gt;kwargs&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>403 \"\"\" 404    Shortcut for safe_import. 405    \"\"\" 406 return safe_import(\"unitcell\", name).UnitCell(**kwargs) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Shortcut for safe_import.&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"Molecule\"&gt;\n                        &lt;input id=\"Molecule-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def Molecule(name, **kwargs): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#Molecule\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"Molecule-409\"&gt;&lt;a href=\"#Molecule-409\"&gt;&lt;span class=\"linenos\"&gt;409&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;Molecule&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"o\"&gt;**&lt;/span&gt;&lt;span class=\"n\"&gt;kwargs&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>410 \"\"\" 411    Shortcut for safe_import. 412    \"\"\" 413 return safe_import(\"molecule\", name).Molecule(**kwargs) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Shortcut for safe_import.&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"Exporter\"&gt;\n                        &lt;input id=\"Exporter-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def Exporter(name, **kwargs): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#Exporter\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"Exporter-416\"&gt;&lt;a href=\"#Exporter-416\"&gt;&lt;span class=\"linenos\"&gt;416&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;Exporter&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"o\"&gt;**&lt;/span&gt;&lt;span class=\"n\"&gt;kwargs&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>417 \"\"\" 418    Shortcut for safe_import. 419    \"\"\" 420 return safe_import(\"exporter\", name) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Shortcut for safe_import.&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"Group\"&gt;\n                        &lt;input id=\"Group-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def Group(name, **kwargs): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#Group\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"Group-423\"&gt;&lt;a href=\"#Group-423\"&gt;&lt;span class=\"linenos\"&gt;423&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;Group&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;name&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"o\"&gt;**&lt;/span&gt;&lt;span class=\"n\"&gt;kwargs&lt;/span&gt;&lt;span class=\"p\"&gt;):&lt;/span&gt;\n</code></pre> <p>424 \"\"\" 425    Shortcut for safe_import. 426    \"\"\" 427 return safe_import(\"group\", name).Group(**kwargs) </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Shortcut for safe_import.&lt;/p&gt;\n</code></pre> <pre><code>            &lt;/section&gt;\n            &lt;section id=\"get_exporter_format_rows\"&gt;\n                        &lt;input id=\"get_exporter_format_rows-view-source\" class=\"view-source-toggle-state\" type=\"checkbox\" aria-hidden=\"true\" tabindex=\"-1\"&gt;\n</code></pre> def get_exporter_format_rows(category='exporter', groups=('system', 'extra', 'local')): View Source <pre><code>&lt;a class=\"headerlink\" href=\"#get_exporter_format_rows\"&gt;&lt;/a&gt;\n        &lt;div class=\"pdoc-code codehilite\"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span id=\"get_exporter_format_rows-430\"&gt;&lt;a href=\"#get_exporter_format_rows-430\"&gt;&lt;span class=\"linenos\"&gt;430&lt;/span&gt;&lt;/a&gt;&lt;span class=\"k\"&gt;def&lt;/span&gt;&lt;span class=\"w\"&gt; &lt;/span&gt;&lt;span class=\"nf\"&gt;get_exporter_format_rows&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"n\"&gt;category&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"s2\"&gt;&amp;quot;exporter&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"n\"&gt;groups&lt;/span&gt;&lt;span class=\"o\"&gt;=&lt;/span&gt;&lt;span class=\"p\"&gt;(&lt;/span&gt;&lt;span class=\"s2\"&gt;&amp;quot;system&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;extra&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;,&lt;/span&gt; &lt;span class=\"s2\"&gt;&amp;quot;local&amp;quot;&lt;/span&gt;&lt;span class=\"p\"&gt;)):&lt;/span&gt;\n</code></pre> <p>431 \"\"\" 432    Collect format_desc from all exporter plugins and return rows for the README table. 433 434    Each exporter module may define a <code>format_desc</code> dict with keys: 435      aliases: list of option names (e.g. [\"g\", \"gromacs\"]) 436      application: str (markdown allowed) 437      extension: str (e.g. \".gro\") 438      water: str (e.g. \"Atomic positions\") 439      solute: str 440      hb: str (e.g. \"none\", \"o\", \"auto\") 441      remarks: str 442      suboptions: str (optional; short description of :key value options, e.g. \"water_model: 3site, 4site, 6site, tip4p\") 443 444    Returns a list of dicts with keys name, application, extension, water, solute, hb, remarks, suboptions. 445    \"\"\" 446 logger = getLogger() 447 mods = scan(category) 448 rows = [] 449 seen = set() 450 451 for group in groups: 452 for name in mods.get(group, []): 453 if name in seen: 454 continue 455 try: 456 if group == \"system\": 457 mod = importlib.import_module(f\"genice3.{category}.{name}\") 458 elif group == \"extra\": 459 mod = None 460 for ep in entry_points(group=f\"genice3_{category}\"): 461 if ep.name == name: 462 mod = ep.load() 463 break 464 if mod is None: 465 continue 466 else: 467 try: 468 mod = importlib.import_module(f\"{category}.{name}\") 469 except ModuleNotFoundError: 470 continue 471 if not hasattr(mod, \"format_desc\"): 472 continue 473 fd = mod.format_desc 474 aliases = fd.get(\"aliases\", [name]) 475 name_col = \", \".join(f\"<code>&lt;/span&gt;&lt;span class=\"si\"&gt;{&lt;/span&gt;&lt;span class=\"n\"&gt;a&lt;/span&gt;&lt;span class=\"si\"&gt;}&lt;/span&gt;&lt;span class=\"s2\"&gt;</code>\" for a in aliases) 476 rows.append( 477 { 478 \"name\": name_col, 479 \"application\": fd.get(\"application\", \"\"), 480 \"extension\": fd.get(\"extension\", \"\"), 481 \"water\": fd.get(\"water\", \"\"), 482 \"solute\": fd.get(\"solute\", \"\"), 483 \"hb\": fd.get(\"hb\", \"\"), 484 \"remarks\": fd.get(\"remarks\", \"\"), 485 \"suboptions\": fd.get(\"suboptions\", \"\"), 486 } 487 ) 488 seen.add(name) 489 except Exception as e: 490 logger.debug(f\"Skip {name} for format table: {e}\") 491 return rows </p> <pre><code>        &lt;div class=\"docstring\"&gt;&lt;p&gt;Collect format_desc from all exporter plugins and return rows for the README table.&lt;/p&gt;\n</code></pre> <p>Each exporter module may define a <code>format_desc</code> dict with keys:   aliases: list of option names (e.g. [\"g\", \"gromacs\"])   application: str (markdown allowed)   extension: str (e.g. \".gro\")   water: str (e.g. \"Atomic positions\")   solute: str   hb: str (e.g. \"none\", \"o\", \"auto\")   remarks: str   suboptions: str (optional; short description of :key value options, e.g. \"water_model: 3site, 4site, 6site, tip4p\")</p> <p>Returns a list of dicts with keys name, application, extension, water, solute, hb, remarks, suboptions.</p> <pre><code>            &lt;/section&gt;\n&lt;/main&gt;\n</code></pre> <p>pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert &gt; em{display:none;}.pdoc .alert &gt; :last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E\");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E\");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E\");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E\");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E\");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url(\"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E\");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc &gt; section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc &gt; section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc &gt; section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc &gt; section:not(.module-info) h4{font-size:1.2rem;}.pdoc &gt; section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a &gt; code{color:inherit;}.pdoc pre &gt; code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc &gt; section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button &gt; span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:\"View Source\";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code &gt; pre &gt; span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code &gt; pre &gt; span:target{display:block;}.pdoc div:target &gt; .attr,.pdoc section:target &gt; .attr,.pdoc dd:target &gt; a{background-color:var(--active);}.pdoc {scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:\"#\";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target &gt; .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:\"show\";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:\"hide\";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:\", \";}.pdoc .inherited .class:before{content:\"class \";}.pdoc .inherited .function a:after{content:\"()\";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused &gt; .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</p>"},{"location":"api-examples/","title":"Overview","text":"<p>API-level examples for GenIce3. Each subdirectory groups examples by topic, showing how to call GenIce3 from Python.</p>"},{"location":"api-examples/#example-categories","title":"Example categories","text":"Directory Description basic Basic usage (reactive properties, simple structure generation) cif_io Reading from and writing to CIF files doping Ionic substitution and group (cation group) doping guest_occupancy Guest placement and cage survey for clathrate hydrates polarization Polarization and dipole optimization (<code>target_pol</code>, <code>depol_loop</code>) unitcell_transform Extending the unit cell (<code>replication_matrix</code>) topological_defects Topological defects (Bjerrum, H3O\u207a, OH\u207b) tools Helper scripts for YAML \u2194 shell conversions used by the examples <p>Each subdirectory has its own <code>README.md</code> describing the example scripts it contains.</p>"},{"location":"api-examples/#how-to-run","title":"How to run","text":"<p>In an environment where <code>genice3</code> can be imported, you can run each <code>.py</code> file directly from the project root:</p> <pre><code>python examples/api/basic/2_simple.py\n</code></pre> <p>Run all examples at once (from project root):</p> <pre><code>make run-api-examples\n# or\npython scripts/run_api_examples.py\n</code></pre> <p>By default only <code>.py</code> files are run. To include <code>.sh</code> and/or <code>.yaml</code>:</p> <pre><code>python scripts/run_api_examples.py --sh        # .py + .sh (bash)\npython scripts/run_api_examples.py --yaml      # .py + .yaml (genice3 --config)\npython scripts/run_api_examples.py --all       # .py + .sh + .yaml\n</code></pre> <p>List entries without running: <code>python scripts/run_api_examples.py --dry-run</code>. On failure, stdout/stderr are written to <code>run_api_examples.log</code>. Note: <code>doping/11_ion_group_unitcell.py</code> may occasionally fail due to random depolarization; re-run if needed.</p> <p>To generate <code>.sh</code> from YAML (or vice versa), use <code>tools/gen_sh_from_yaml.py</code> and <code>tools/gen_yaml_from_sh.py</code>.</p> <p>API.ipynb is generated from these examples (<code>make api-notebook</code>). It includes all categories except <code>tools</code> (those scripts rely on <code>__file__</code> and are meant to be run from the command line). Run the Setup cell first so that paths like <code>cif/MEP.cif</code> resolve correctly.</p>"},{"location":"api-examples/basic/","title":"Basic","text":"<p>Basic usage examples of GenIce3.</p> <ul> <li><code>1_reactive_properties.py</code> </li> <li> <p>Minimal example to explore how GenIce3's reactive properties behave.</p> </li> <li> <p><code>2_simple.py</code> </p> </li> <li>Introductory example that generates a simple ice structure and exports it.</li> </ul>"},{"location":"api-examples/basic/#sample-code","title":"Sample code","text":""},{"location":"api-examples/basic/#1_reactive_properties","title":"1_reactive_properties","text":"<p><code>1_reactive_properties.py</code></p> <pre><code>from genice3.genice import GenIce3\nfrom logging import getLogger, basicConfig, INFO\n\nlogger = getLogger(\"test_genice3api1\")\nbasicConfig(level=INFO)\ngenice = GenIce3()\nlogger.info(\"Reactive properties:\")\nlogger.info(f\"     All: {genice.list_all_reactive_properties().keys()}\")\nlogger.info(f\"  Public: {genice.list_public_reactive_properties().keys()}\")\nlogger.info(\"Settabe reactive properties:\")\nlogger.info(f\"     All: {genice.list_settable_reactive_properties().keys()}\")\nlogger.info(f\"  Public: {genice.list_public_settable_reactive_properties().keys()}\")\n</code></pre>"},{"location":"api-examples/basic/#2_simple","title":"2_simple","text":"<p><code>2_simple.py</code> | <code>2_simple.sh</code> | <code>2_simple.yaml</code></p> 2_simple.py2_simple.sh2_simple.yaml <pre><code>from genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\n\n# corresponding command:\n# genice3 A15 --exporter gromacs\ngenice = GenIce3()\ngenice.set_unitcell(\"A15\")\nExporter(\"gromacs\").dump(genice)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 2_simple.yaml\n\npython3 -m genice3.cli.genice A15 \\\n  --exporter gromacs\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 2_simple.yaml\n# Generated from 2_simple.sh\n\nunitcell: A15\nexporter: gromacs\n</code></pre>"},{"location":"api-examples/cif_io/","title":"CIF I/O","text":"<p>Reading from and writing to CIF files.</p> <ul> <li><code>cif/</code> </li> <li> <p>Symlink to the project-root <code>cif/</code> directory. Used so examples can refer to files such as <code>cif/MEP.cif</code>.</p> </li> <li> <p><code>4_from_cif.py</code> </p> </li> <li> <p>Load an ice structure from a CIF file and use it as a GenIce3 <code>UnitCell</code>.</p> </li> <li> <p><code>5_to_cif.py</code> </p> </li> <li>Export a structure generated by GenIce3 in CIF format.</li> </ul>"},{"location":"api-examples/cif_io/#sample-code","title":"Sample code","text":""},{"location":"api-examples/cif_io/#4_from_cif","title":"4_from_cif","text":"<p><code>4_from_cif.py</code> | <code>4_from_cif.sh</code> | <code>4_from_cif.yaml</code></p> 4_from_cif.py4_from_cif.sh4_from_cif.yaml <pre><code>from genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\nfrom logging import basicConfig, INFO\n\n# corresponding command:\n# genice3 'CIF[file=cif/MEP.cif, osite=T]' --exporter gromacs\nbasicConfig(level=INFO)\ngenice = GenIce3()\ngenice.set_unitcell(\"CIF\", file=\"cif/MEP.cif\", osite=\"T\")\nExporter(\"gromacs\").dump(genice)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 4_from_cif.yaml\n\npython3 -m genice3.cli.genice CIF \\\n  --file cif/MEP.cif \\\n  --osite T\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 4_from_cif.yaml\n# Generated from 4_from_cif.sh\n\nunitcell: CIF\nfile: cif/MEP.cif\nosite: T\n</code></pre>"},{"location":"api-examples/cif_io/#5_to_cif","title":"5_to_cif","text":"<p><code>5_to_cif.py</code> | <code>5_to_cif.sh</code> | <code>5_to_cif.yaml</code></p> 5_to_cif.py5_to_cif.sh5_to_cif.yaml <pre><code>from genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\nfrom logging import basicConfig, INFO\n\n# corresponding command:\n# genice3 A15 -e cif\nbasicConfig(level=INFO)\ngenice = GenIce3()\ngenice.set_unitcell(\"A15\")\nExporter(\"cif\").dump(genice)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 5_to_cif.yaml\n\npython3 -m genice3.cli.genice A15 \\\n  --exporter cif\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 5_to_cif.yaml\n# Generated from 5_to_cif.sh\n\nunitcell: A15\nexporter: cif\n</code></pre>"},{"location":"api-examples/doping/","title":"Doping","text":"<p>Ionic substitution and group (cation group) doping.</p> <p>CLI: unitcell \u306e\u30a4\u30aa\u30f3\u306f -a / --anion, -c / --cation\u3002\u30b9\u30dd\u30c3\u30c8\u7f6e\u63db\u306f -A / --spot_anion, -C / --spot_cation\u3002</p> <ul> <li><code>3_doped.py</code> </li> <li> <p>Basic usage of anion/cation substitutional doping (unitcell + spot).</p> </li> <li> <p><code>9_ion_group.py</code> </p> </li> <li> <p>Attach groups to cations inside a unit cell.</p> </li> <li> <p><code>11_ion_group_unitcell.py</code> </p> </li> <li>Use <code>cation_groups</code> defined in the unit cell and expand them to the replicated supercell.</li> </ul>"},{"location":"api-examples/doping/#sample-code","title":"Sample code","text":""},{"location":"api-examples/doping/#11_ion_group_unitcell","title":"11_ion_group_unitcell","text":"<p><code>11_ion_group_unitcell.py</code> | <code>11_ion_group_unitcell.sh</code> | <code>11_ion_group_unitcell.yaml</code></p> 11_ion_group_unitcell.py11_ion_group_unitcell.sh11_ion_group_unitcell.yaml <pre><code>from logging import basicConfig, INFO\nimport numpy as np\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\n\n# corresponding command:\n# genice3 A15 --cation 0=N :group 1=methyl 6=methyl 3=methyl 4=methyl \\\n#   --anion 2=Cl --rep 2 2 2 --exporter gromacs :water_model 4site\n\nbasicConfig(level=INFO)\n\ngenice = GenIce3(\n    replication_matrix=np.array([[2, 0, 0], [0, 2, 0], [0, 0, 2]]),\n    seed=43,\n)\n\n# \u5358\u4f4d\u80de\u5185\u306e anion/cation \u3068 cation_groups\uff08\u30ab\u30c1\u30aa\u30f3\u306e\u8155\u306e group \u6307\u5b9a\uff09\ngenice.set_unitcell(\n    \"A15\",\n    anion={2: \"Cl\"},\n    cation={0: \"N\"},\n    cation_groups={0: {1: \"methyl\", 6: \"methyl\", 3: \"methyl\", 4: \"methyl\"}},\n)\n\nExporter(\"gromacs\").dump(\n    genice,\n    water_model=\"4site\",\n)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 11_ion_group_unitcell.yaml\n\npython3 -m genice3.cli.genice A15 --seed 43 \\\n  --cation 0=N :group 1=methyl 6=methyl 3=methyl 4=methyl \\\n  --anion 2=Cl \\\n  --rep 2 2 2 \\\n  --exporter gromacs :water_model 4site\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 11_ion_group_unitcell.yaml\n# Generated from 11_ion_group_unitcell.sh\n\nunitcell: A15\nseed: 43\ncation:\n  0=N:\n    group:\n    - 1=methyl\n    - 6=methyl\n    - 3=methyl\n    - 4=methyl\nanion: 2=Cl\nrep:\n- 2\n- 2\n- 2\nexporter:\n  gromacs:\n    water_model: 4site\n</code></pre>"},{"location":"api-examples/doping/#3_doped","title":"3_doped","text":"<p><code>3_doped.py</code> | <code>3_doped.sh</code> | <code>3_doped.yaml</code></p> 3_doped.py3_doped.sh3_doped.yaml <pre><code>from logging import basicConfig, DEBUG, INFO\nimport numpy as np\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter, Molecule\n\n# corresponding command:\n# genice3 \"A15[shift=(0.1,0.1,0.1), anion.0=Cl, cation.6=Na, density=0.8]\" \\\n#   --rep 2 2 2 \\\n#   --spot_anion 1=Cl --spot_anion 35=Br \\\n#   --spot_cation 1=Na --spot_cation 35=K \\\n#   --exporter gromacs :water_model 4site \\\n#   --seed 42 --depol_loop 2000 -D\n\nbasicConfig(level=INFO)\n\n# GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\n# seed: \u4e71\u6570\u30b7\u30fc\u30c9\n# depol_loop: \u5206\u6975\u30eb\u30fc\u30d7\u306e\u53cd\u5fa9\u56de\u6570\n# replication_matrix: \u8907\u88fd\u884c\u5217\uff082x2x2\u306e\u5bfe\u89d2\u884c\u5217\uff09\n# spot_anions: \u7279\u5b9a\u306e\u6c34\u5206\u5b50\u3092\u30a2\u30cb\u30aa\u30f3\u3067\u7f6e\u63db\uff08\u6c34\u5206\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9: \u30a4\u30aa\u30f3\u540d\uff09\u3002CLI \u306f -A / --spot_anion\n# spot_cations: \u7279\u5b9a\u306e\u6c34\u5206\u5b50\u3092\u30ab\u30c1\u30aa\u30f3\u3067\u7f6e\u63db\uff08\u6c34\u5206\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9: \u30a4\u30aa\u30f3\u540d\uff09\u3002CLI \u306f -C / --spot_cation\n# \u6ce8\u610f: debug\u306fGenIce3\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u306f\u53d7\u3051\u4ed8\u3051\u3089\u308c\u306a\u3044\uff08\u30ed\u30b0\u30ec\u30d9\u30eb\u306e\u8a2d\u5b9a\u306fbasicConfig\u3067\u884c\u3046\uff09\ngenice = GenIce3(\n    seed=42,\n    depol_loop=2000,\n    replication_matrix=np.array([[2, 0, 0], [0, 2, 0], [0, 0, 2]]),\n    spot_anions={\n        1: \"Cl\",\n    },\n    spot_cations={\n        51: \"Na\",\n    },\n)\n\n# \u5358\u4f4d\u30bb\u30eb\u3092\u8a2d\u5b9a\n# shift: \u30b7\u30d5\u30c8\uff08\u5206\u6570\u5ea7\u6a19\uff09\n# anion: \u5358\u4f4d\u80de\u5185\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u3092\u30a2\u30cb\u30aa\u30f3\u3067\u7f6e\u63db\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9: \u30a4\u30aa\u30f3\u540d\uff09\u3002CLI \u306f -a / --anion\n# cation: \u5358\u4f4d\u80de\u5185\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u3092\u30ab\u30c1\u30aa\u30f3\u3067\u7f6e\u63db\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9: \u30a4\u30aa\u30f3\u540d\uff09\u3002CLI \u306f -c / --cation\n# density: \u5bc6\u5ea6\uff08g/cm\u00b3\uff09\n# \u30b1\u30fc\u30b8\u60c5\u5831\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f Exporter(\"cage_survey\").dump(genice, file) \u3067JSON\u51fa\u529b\u53ef\u80fd\ngenice.set_unitcell(\n    \"A15\",\n    shift=(0.1, 0.1, 0.1),\n    anion={15: \"Cl\"},\n    cation={21: \"Na\"},\n    density=0.8,\n)\n\n\n# \u30a8\u30af\u30b9\u30dd\u30fc\u30bf\u30fc\u3067\u51fa\u529b\nExporter(\"gromacs\").dump(\n    genice,\n    water_model=\"4site\",\n)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 3_doped.yaml\n\npython3 -m genice3.cli.genice A15 \\\n  --shift 0.1 0.1 0.1 \\\n  --anion 15=Cl \\\n  --cation 21=Na \\\n  --density 0.8 \\\n  --rep 2 2 2 \\\n  --exporter gromacs :water_model 4site \\\n  --seed 42 \\\n  --depol_loop 2000 \\\n  --spot_anion 1=Cl \\\n  --spot_cation 51=Na\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 3_doped.yaml\n# Generated from 3_doped.sh\n\nunitcell: A15\nshift:\n- 0.1\n- 0.1\n- 0.1\nanion: 15=Cl\ncation: 21=Na\ndensity: 0.8\nrep:\n- 2\n- 2\n- 2\nexporter:\n  gromacs:\n    water_model: 4site\nseed: 42\ndepol_loop: 2000\nspot_anion: 1=Cl\nspot_cation: 51=Na\n</code></pre>"},{"location":"api-examples/doping/#9_ion_group","title":"9_ion_group","text":"<p><code>9_ion_group.py</code> | <code>9_ion_group.sh</code> | <code>9_ion_group.yaml</code></p> 9_ion_group.py9_ion_group.sh9_ion_group.yaml <pre><code>from logging import basicConfig, DEBUG, INFO\nimport numpy as np\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter, Molecule\n\n# corresponding command:\n# genice3 \"A15[shift=(0.1,0.1,0.1), anion.0=Cl, cation.6=Na, density=0.8]\" \\\n#   --rep 2 2 2 \\\n#   --spot_anion 1=Cl --spot_anion 35=Br \\\n#   --spot_cation 1=Na --spot_cation 35=K \\\n#   --exporter gromacs :water_model 4site \\\n#   --seed 42 --depol_loop 2000 -D\n\nbasicConfig(level=INFO)\n\n# GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\n# seed: \u4e71\u6570\u30b7\u30fc\u30c9\n# depol_loop: \u5206\u6975\u30eb\u30fc\u30d7\u306e\u53cd\u5fa9\u56de\u6570\n# replication_matrix: \u8907\u88fd\u884c\u5217\uff082x2x2\u306e\u5bfe\u89d2\u884c\u5217\uff09\n# spot_anions / spot_cations: \u6c34\u5206\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 -&gt; \u30a4\u30aa\u30f3\u540d\u3002CLI \u306f -A / --spot_anion, -C / --spot_cation\n# spot_cation_groups: group \u30b5\u30d6\u30aa\u30d7\u30b7\u30e7\u30f3\uff08\u30b5\u30a4\u30c8 -&gt; {\u30b1\u30fc\u30b8ID -&gt; group\u540d}\uff09\u3002\n# YAML/CLI \u306e\u30cd\u30b9\u30c8\u5f62\u5f0f\u3067\u4f7f\u3046 \"ion\" \u30ad\u30fc\u306f Python API \u3067\u306f\u4e0d\u8981\uff08\u5225\u5f15\u6570\u3067\u6e21\u3059\uff09\u3002\ngenice = GenIce3(\n    seed=42,\n    depol_loop=2000,\n    replication_matrix=np.array([[2, 0, 0], [0, 2, 0], [0, 0, 2]]),\n    spot_anions={1: \"Cl\"},\n    spot_cations={51: \"N\"},\n    spot_cation_groups={\n        51: {12: \"methyl\", 48: \"methyl\", 49: \"methyl\", 50: \"methyl\"},\n    },\n)\n\n# \u5358\u4f4d\u30bb\u30eb\u3092\u8a2d\u5b9a\n# anion / cation: \u5358\u4f4d\u80de\u5185\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u3092\u30a4\u30aa\u30f3\u3067\u7f6e\u63db\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9: \u30a4\u30aa\u30f3\u540d\uff09\u3002CLI \u306f -a / --anion, -c / --cation\n# density: \u5bc6\u5ea6\uff08g/cm\u00b3\uff09\n# \u30b1\u30fc\u30b8\u60c5\u5831\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f Exporter(\"cage_survey\").dump(genice, file) \u3067JSON\u51fa\u529b\u53ef\u80fd\ngenice.set_unitcell(\"A15\", shift=(0.1, 0.1, 0.1), density=0.8)\n\n\n# \u30a8\u30af\u30b9\u30dd\u30fc\u30bf\u30fc\u3067\u51fa\u529b\nExporter(\"yaplot\").dump(\n    genice,\n)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 9_ion_group.yaml\n\npython3 -m genice3.cli.genice A15 \\\n  --shift 0.1 0.1 0.1 \\\n  --density 0.8 \\\n  --rep 2 2 2 \\\n  --spot_anion 1=Cl \\\n  --spot_cation 51=N :group 12=methyl 48=methyl 49=methyl 50=methyl \\\n  --exporter yaplot \\\n  --seed 42 \\\n  --depol_loop 2000\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 9_ion_group.yaml\n# Generated from 9_ion_group.sh\n\nunitcell: A15\nshift:\n- 0.1\n- 0.1\n- 0.1\ndensity: 0.8\nrep:\n- 2\n- 2\n- 2\nspot_anion: 1=Cl\nspot_cation:\n  51=N:\n    group:\n    - 12=methyl\n    - 48=methyl\n    - 49=methyl\n    - 50=methyl\nexporter: yaplot\nseed: 42\ndepol_loop: 2000\n</code></pre>"},{"location":"api-examples/guest_occupancy/","title":"Guest occupancy","text":"<p>Guest occupancy and cage-related operations in clathrate hydrates.</p> <ul> <li><code>6_with_guests.py</code> </li> <li> <p>Place guest molecules with specified occupancy for each cage type.</p> </li> <li> <p><code>8_cage_survey.py</code> </p> </li> <li>Survey cage positions and types in the structure.</li> </ul>"},{"location":"api-examples/guest_occupancy/#sample-code","title":"Sample code","text":""},{"location":"api-examples/guest_occupancy/#6_with_guests","title":"6_with_guests","text":"<p><code>6_with_guests.py</code> | <code>6_with_guests.sh</code> | <code>6_with_guests.yaml</code></p> 6_with_guests.py6_with_guests.sh6_with_guests.yaml <pre><code>from logging import basicConfig, DEBUG, INFO\nimport numpy as np\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter, Molecule\nfrom genice3.cli.options import parse_guest_option, parse_spot_guest_option\n\n# corresponding command (guest/spot_guest \u306f\u57fa\u5e95\u30aa\u30d7\u30b7\u30e7\u30f3\u3001exporter\u306e\u5916\u3067\u6307\u5b9a):\n# genice3 \"A15[shift=(0.1,0.1,0.1), anion.0=Cl, cation.6=Na, density=0.8]\" \\\n#   --rep 2 2 2 \\\n#   --guest A12=me --guest A14=et --spot_guest 0=4site \\\n#   --exporter gromacs :water_model 4site \\\n#   --seed 42 --depol_loop 2000 -D\n\nbasicConfig(level=INFO)\n\n# GenIce3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\n# guests: \u30b1\u30fc\u30b8\u30bf\u30a4\u30d7\u3054\u3068\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08parse_guest_option\u3067 raw dict \u3092\u5909\u63db\uff09\n# spot_guests: \u7279\u5b9a\u30b1\u30fc\u30b8\u3078\u306e\u30b2\u30b9\u30c8\u5206\u5b50\u6307\u5b9a\uff08parse_spot_guest_option\u3067 raw dict \u3092\u5909\u63db\uff09\ngenice = GenIce3(\n    seed=42,\n    depol_loop=2000,\n    replication_matrix=np.array([[2, 0, 0], [0, 2, 0], [0, 0, 2]]),\n    guests=parse_guest_option({\"A12\": \"me\", \"A14\": \"et\"}),\n    spot_guests=parse_spot_guest_option({0: \"4site\"}),\n)\n\n# \u5358\u4f4d\u30bb\u30eb\u3092\u8a2d\u5b9a\n# shift: \u30b7\u30d5\u30c8\uff08\u5206\u6570\u5ea7\u6a19\uff09\n# anion / cation: \u5358\u4f4d\u80de\u5185\u306e\u683c\u5b50\u30b5\u30a4\u30c8\u3092\u30a4\u30aa\u30f3\u3067\u7f6e\u63db\uff08\u30b5\u30a4\u30c8\u30a4\u30f3\u30c7\u30c3\u30af\u30b9: \u30a4\u30aa\u30f3\u540d\uff09\u3002CLI \u306f -a / --anion, -c / --cation\n# density: \u5bc6\u5ea6\uff08g/cm\u00b3\uff09\n# \u30b1\u30fc\u30b8\u60c5\u5831\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f Exporter(\"cage_survey\").dump(genice, file) \u3067JSON\u51fa\u529b\u53ef\u80fd\ngenice.set_unitcell(\"A15\", shift=(0.1, 0.1, 0.1), density=0.8)\n\n\n# \u30a8\u30af\u30b9\u30dd\u30fc\u30bf\u30fc\u3067\u51fa\u529b\uff08guest/spot_guest \u306f GenIce3 \u306b\u8a2d\u5b9a\u6e08\u307f\uff09\nExporter(\"gromacs\").dump(\n    genice,\n    water_model=\"4site\",\n)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 6_with_guests.yaml\n\npython3 -m genice3.cli.genice A15 \\\n  --shift 0.1 0.1 0.1 \\\n  --density 0.8 \\\n  --rep 2 2 2 \\\n  --guest A12=me A14=et \\\n  --spot_guest 0=4site \\\n  --exporter gromacs :water_model 4site \\\n  --seed 42 \\\n  --depol_loop 2000\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 6_with_guests.yaml\n# Generated from 6_with_guests.sh\n\nunitcell: A15\nshift:\n- 0.1\n- 0.1\n- 0.1\ndensity: 0.8\nrep:\n- 2\n- 2\n- 2\nguest:\n- A12=me\n- A14=et\nspot_guest: 0=4site\nexporter:\n  gromacs:\n    water_model: 4site\nseed: 42\ndepol_loop: 2000\n</code></pre>"},{"location":"api-examples/guest_occupancy/#8_cage_survey","title":"8_cage_survey","text":"<p><code>8_cage_survey.py</code> | <code>8_cage_survey.sh</code> | <code>8_cage_survey.yaml</code></p> 8_cage_survey.py8_cage_survey.sh8_cage_survey.yaml <pre><code>\"\"\"DOH \u69cb\u9020\u3067 cage_survey \u3092\u4f7f\u3046\u4f8b\uff08Python API\uff09\"\"\"\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\nfrom logging import basicConfig, INFO\n\n# \u5bfe\u5fdc\u3059\u308b\u30b3\u30de\u30f3\u30c9:\n#   genice3 DOH -e cage_survey\nbasicConfig(level=INFO)\ngenice = GenIce3()\ngenice.set_unitcell(\"DOH\")\nExporter(\"cage_survey\").dump(genice)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 8_cage_survey.yaml\n\npython3 -m genice3.cli.genice DOH \\\n  --exporter cage_survey\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 8_cage_survey.yaml\n# Generated from 8_cage_survey.sh\n\nunitcell: DOH\nexporter: cage_survey\n</code></pre>"},{"location":"api-examples/polarization/","title":"Polarization","text":"<p>Polarization and dipole optimization.</p> <ul> <li><code>7_polarized.py</code> </li> <li>Generate a structure with a specified polarization using <code>target_pol</code> and <code>depol_loop</code>.</li> </ul>"},{"location":"api-examples/polarization/#sample-code","title":"Sample code","text":""},{"location":"api-examples/polarization/#7_polarized","title":"7_polarized","text":"<p><code>7_polarized.py</code> | <code>7_polarized.sh</code> | <code>7_polarized.yaml</code></p> 7_polarized.py7_polarized.sh7_polarized.yaml <pre><code># \u5206\u6975\u3057\u305f\u6c37\u306e\u4f5c\u308a\u65b9 (1) \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067 target_pol \u3092\u6307\u5b9a\n# corresponding command: 7_polarized_1.sh \u307e\u305f\u306f 7_polarized_1_flat.sh\n\nfrom logging import basicConfig, INFO\nimport numpy as np\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\n\nbasicConfig(level=INFO)\n\ngenice = GenIce3(\n    seed=114,\n    depol_loop=1000,\n    replication_matrix=np.diag([2, 2, 2]),\n    target_pol=np.array([4.0, 0.0, 0.0]),\n)\ngenice.set_unitcell(\"1h\")\n\nExporter(\"_pol\").dump(genice)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 7_polarized.yaml\n\npython3 -m genice3.cli.genice 1h \\\n  --rep 2 2 2 \\\n  --exporter _pol \\\n  --seed 114 \\\n  --depol_loop 1000 \\\n  --target_polarization 4 0 0\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 7_polarized.yaml\n# Generated from 7_polarized.sh\n\nunitcell: 1h\nrep:\n- 2\n- 2\n- 2\nexporter: _pol\nseed: 114\ndepol_loop: 1000\ntarget_polarization:\n- 4\n- 0\n- 0\n</code></pre>"},{"location":"api-examples/tools/","title":"Tools","text":"<p>Helper scripts for YAML \u2194 shell conversion, used by the examples.</p> <ul> <li><code>gen_sh_from_yaml.py</code> </li> <li> <p>Generate shell scripts (<code>*.sh</code>) from YAML configuration files.</p> </li> <li> <p><code>gen_yaml_from_sh.py</code> </p> </li> <li>Generate YAML configuration from existing shell scripts.</li> </ul> <p>The <code>*.yaml</code> / <code>*.sh</code> files in each example subdirectory are meant to be generated and edited using these tools.</p>"},{"location":"api-examples/tools/#sample-code","title":"Sample code","text":""},{"location":"api-examples/tools/#gen_sh_from_yaml","title":"gen_sh_from_yaml","text":"<p><code>gen_sh_from_yaml.py</code></p> <pre><code>#!/usr/bin/env python3\n\"\"\"\nexamples/api/*.yaml \u3092\u8aad\u307f\u3001option_parser \u306e structure_to_option_string \u3067\n\u30aa\u30d7\u30b7\u30e7\u30f3\u884c\u306b\u623b\u3057\u3001\u540c\u3058 basename \u306e .sh \u3092\u751f\u6210\u3059\u308b\u3002\n\u898b\u3084\u3059\u3044\u4f4d\u7f6e\uff08\u5404 --option \u306e\u524d\uff09\u3067\u6539\u884c\u3092\u5165\u308c\u308b\u3002\n\u5b9f\u884c: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u3067 python examples/api/gen_sh_from_yaml.py\n\"\"\"\n\nfrom __future__ import annotations\n\nimport re\nimport sys\nfrom pathlib import Path\n\nSCRIPT_DIR = Path(__file__).resolve().parent\nROOT = SCRIPT_DIR.parent.parent\nif str(ROOT) not in sys.path:\n    sys.path.insert(0, str(ROOT))\n\nfrom genice3.cli.option_parser import structure_to_option_string\n\ntry:\n    import yaml\nexcept ImportError:\n    yaml = None\n\n\ndef _option_line_with_breaks(line: str) -&gt; str:\n    \"\"\"1\u884c\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u6587\u5b57\u5217\u3092\u3001\u5404 ' --' \u306e\u524d\u3067\u6539\u884c\u3057\u3066\u8fd4\u3059\u3002\"\"\"\n    parts = re.split(r\" (?=--)\", line)\n    if len(parts) &lt;= 1:\n        return line\n    return \" \\\\\\n  \".join(parts)\n\n\ndef main() -&gt; None:\n    if yaml is None:\n        print(\"PyYAML \u304c\u5fc5\u8981\u3067\u3059: pip install pyyaml\", file=sys.stderr)\n        sys.exit(1)\n\n    api_dir = SCRIPT_DIR\n    for yaml_path in sorted(api_dir.glob(\"*.yaml\")):\n        text = yaml_path.read_text(encoding=\"utf-8\")\n        # \u5148\u982d\u306e # \u30b3\u30e1\u30f3\u30c8\u884c\u3092\u9664\u3044\u3066\u304b\u3089\u30d1\u30fc\u30b9\n        body = re.sub(r\"^#.*\\n?\", \"\", text).strip()\n        if not body:\n            continue\n        try:\n            data = yaml.safe_load(body)\n        except Exception as e:\n            print(f\"  skip {yaml_path.name}: load error: {e}\", file=sys.stderr)\n            continue\n        if not data or \"unitcell\" not in data:\n            continue\n        try:\n            line = structure_to_option_string(data)\n        except Exception as e:\n            print(f\"  skip {yaml_path.name}: {e}\", file=sys.stderr)\n            continue\n        opt_line = _option_line_with_breaks(line)\n        sh_path = yaml_path.with_suffix(\".sh\")\n        content = f\"\"\"#!/bin/bash\n# Generated from {yaml_path.name}\n\npython3 -m genice3.cli.genice {opt_line}\n\"\"\"\n        sh_path.write_text(content, encoding=\"utf-8\")\n        print(f\"  {yaml_path.name} -&gt; {sh_path.name}\")\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"api-examples/tools/#gen_yaml_from_sh","title":"gen_yaml_from_sh","text":"<p><code>gen_yaml_from_sh.py</code></p> <pre><code>#!/usr/bin/env python3\n\"\"\"\nexamples/api/*.sh \u304b\u3089\u30aa\u30d7\u30b7\u30e7\u30f3\u884c\u3092\u62bd\u51fa\u3057\u3001option_parser \u3067\u30d1\u30fc\u30b9\u3057\u3066\n\u540c\u3058 basename \u306e .yaml \u3092\u751f\u6210\u3059\u308b\u3002\n\u5b9f\u884c: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u3067 python examples/api/gen_yaml_from_sh.py\n\"\"\"\n\nfrom __future__ import annotations\n\nimport re\nimport sys\nfrom pathlib import Path\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u3092 path \u306b\u8ffd\u52a0\nSCRIPT_DIR = Path(__file__).resolve().parent\nROOT = SCRIPT_DIR.parent.parent\nif str(ROOT) not in sys.path:\n    sys.path.insert(0, str(ROOT))\n\nfrom genice3.cli.option_parser import (\n    parse_options,\n    structure_for_display,\n    scalarize_single_item_lists,\n)\n\ntry:\n    import yaml\nexcept ImportError:\n    yaml = None\n\n\ndef _numeric_if_possible(s: str):\n    \"\"\"\u6570\u5024\u306b\u898b\u3048\u308b\u6587\u5b57\u5217\u306f int/float \u306b\u5909\u63db\uff08YAML \u3067\u5f15\u7528\u7b26\u306a\u3057\u3067\u51fa\u3059\u305f\u3081\uff09\u3002\"\"\"\n    if not isinstance(s, str):\n        return s\n    s = s.strip()\n    if not s:\n        return s\n    try:\n        if \".\" in s or \"e\" in s.lower():\n            return float(s)\n        return int(s)\n    except ValueError:\n        return s\n\n\ndef _coerce_numbers(obj):\n    \"\"\"\u518d\u5e30\u7684\u306b\u30b9\u30ab\u30e9\u30fc\u6587\u5b57\u5217\u3092\u6570\u5024\u306b\u5909\u63db\u3059\u308b\u3002\"\"\"\n    if isinstance(obj, dict):\n        return {k: _coerce_numbers(v) for k, v in obj.items()}\n    if isinstance(obj, list):\n        return [_coerce_numbers(e) for e in obj]\n    if isinstance(obj, str):\n        return _numeric_if_possible(obj)\n    return obj\n\n\ndef extract_option_line(sh_path: Path) -&gt; str | None:\n    \"\"\".sh \u304b\u3089 genice3.cli.genice \u306b\u6e21\u3057\u3066\u3044\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u6587\u5b57\u5217\u3092\u62bd\u51fa\u3059\u308b\u3002\"\"\"\n    text = sh_path.read_text(encoding=\"utf-8\")\n    # \u884c\u7d99\u7d9a \\ \u3092\u7a7a\u767d\u306b\n    oneline = re.sub(r\"\\\\\\s*\\n\\s*\", \" \", text)\n    m = re.search(r\"genice3\\.cli\\.genice\\s+(.+)\", oneline)\n    if not m:\n        return None\n    line = m.group(1).strip()\n    if \"#\" in line:\n        line = line.split(\"#\", 1)[0].strip()\n    return line if line else None\n\n\ndef main() -&gt; None:\n    if yaml is None:\n        print(\"PyYAML \u304c\u5fc5\u8981\u3067\u3059: pip install pyyaml\", file=sys.stderr)\n        sys.exit(1)\n\n    api_dir = SCRIPT_DIR\n    for sh_path in sorted(api_dir.glob(\"*.sh\")):\n        if sh_path.name.startswith(\"_\"):\n            continue\n        line = extract_option_line(sh_path)\n        if not line:\n            continue\n        try:\n            parsed = parse_options(line)\n            display = structure_for_display(parsed)\n            for_yaml = scalarize_single_item_lists(display)\n            for_yaml = _coerce_numbers(for_yaml)\n        except Exception as e:\n            print(f\"  skip {sh_path.name}: parse error: {e}\", file=sys.stderr)\n            continue\n        yaml_path = sh_path.with_suffix(\".yaml\")\n        yaml_str = yaml.dump(\n            for_yaml,\n            allow_unicode=True,\n            default_flow_style=False,\n            sort_keys=False,\n        )\n        yaml_path.write_text(\"# Generated from \" + sh_path.name + \"\\n\\n\" + yaml_str, encoding=\"utf-8\")\n        print(f\"  {sh_path.name} -&gt; {yaml_path.name}\")\n\n\nif __name__ == \"__main__\":\n    main()\n</code></pre>"},{"location":"api-examples/topological_defects/","title":"Topological defects","text":"<p>Topological defects (Bjerrum defects, H3O\u207a, OH\u207b).</p> <ul> <li><code>12_topological_defect.py</code> </li> <li> <p>Introduce hydronium (H3O\u207a) and hydroxide (OH\u207b) defects at specified coordinates.</p> </li> <li> <p><code>13_topological_defect2.py</code> </p> </li> <li>Introduce Bjerrum L and D defects at specified coordinates.</li> </ul> <p>Additional implementations for the same topics (e.g., CLI- or config-file\u2013driven variants) may be added here in the future.</p>"},{"location":"api-examples/topological_defects/#sample-code","title":"Sample code","text":""},{"location":"api-examples/topological_defects/#12_topological_defect","title":"12_topological_defect","text":"<p><code>12_topological_defect.py</code></p> <pre><code>\"\"\"\n\u30c8\u30dd\u30ed\u30b8\u30ab\u30eb\u6b20\u9665\uff08Hydronium/Hydroxide\uff09\u3092\u5ea7\u6a19\u6307\u5b9a\u3067\u57cb\u3081\u8fbc\u3080\u30b5\u30f3\u30d7\u30eb\u3002\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom logging import basicConfig, INFO\n\nimport numpy as np\n\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\nfrom genice3.util import find_nearest_sites_pbc\n\n# -----------------------------------------------------------------------------\n# \u30b5\u30f3\u30d7\u30eb\u672c\u4f53\n# -----------------------------------------------------------------------------\n\nbasicConfig(level=INFO)\n\ngenice = GenIce3(\n    replication_matrix=np.array([[2, 0, 0], [0, 2, 0], [0, 0, 2]]),\n)\ngenice.set_unitcell(\"A15\")\n\n# \u6b20\u9665\u3092\u7f6e\u304d\u305f\u3044\u4f4d\u7f6e\u3092\u5206\u6570\u5ea7\u6a19\u3067\u6307\u5b9a\uff08\u5404 2 \u70b9\u305a\u3064\uff09\u30bb\u30eb\u5ea7\u6a19\u306b\u5909\u63db\u3057\u3066\u3002\ncelli = np.linalg.inv(genice.cell)\nH3O_positions = np.array([[0.0, 0.0, 0.0], [1.0, 1.0, 1.0]]) @ celli\nOH_positions = np.array([[1.0, 0.0, 0.0], [2.0, 1.0, 1.0]]) @ celli\nH3O_sites = find_nearest_sites_pbc(H3O_positions, genice.lattice_sites, genice.cell)\nOH_sites = find_nearest_sites_pbc(OH_positions, genice.lattice_sites, genice.cell)\n\ngenice.add_spot_hydronium(H3O_sites)\ngenice.add_spot_hydroxide(OH_sites)\n\nExporter(\"gromacs\").dump(\n    genice,\n    water_model=\"3site\",\n)\n</code></pre>"},{"location":"api-examples/topological_defects/#13_topological_defect2","title":"13_topological_defect2","text":"<p><code>13_topological_defect2.py</code></p> <pre><code>\"\"\"\n\u30c8\u30dd\u30ed\u30b8\u30ab\u30eb\u6b20\u9665\uff08Bjerrum\uff09\u3092\u5ea7\u6a19\u6307\u5b9a\u3067\u57cb\u3081\u8fbc\u3080\u30b5\u30f3\u30d7\u30eb\u3002\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom logging import basicConfig, INFO\n\nimport numpy as np\n\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import Exporter\nfrom genice3.util import find_nearest_edges_pbc\n\n# -----------------------------------------------------------------------------\n# \u30b5\u30f3\u30d7\u30eb\u672c\u4f53\n# -----------------------------------------------------------------------------\n\nbasicConfig(level=INFO)\n\ngenice = GenIce3(\n    replication_matrix=np.array([[2, 0, 0], [0, 2, 0], [0, 0, 2]]),\n)\ngenice.set_unitcell(\"A15\")\n\n# \u6b20\u9665\u3092\u7f6e\u304d\u305f\u3044\u4f4d\u7f6e\u3092\u5206\u6570\u5ea7\u6a19\u3067\u6307\u5b9a\uff08\u5404 2 \u70b9\u305a\u3064\uff09\u30bb\u30eb\u5ea7\u6a19\u306b\u5909\u63db\u3057\u3066\u3002\ncelli = np.linalg.inv(genice.cell)\nD_positions = np.array([[0.0, 0.0, 0.0], [1.0, 1.0, 1.0]]) @ celli\nL_positions = np.array([[1.0, 0.0, 0.0], [2.0, 1.0, 1.0]]) @ celli\nD_edges = find_nearest_edges_pbc(\n    D_positions, genice.graph, genice.lattice_sites, genice.cell\n)\nL_edges = find_nearest_edges_pbc(\n    L_positions, genice.graph, genice.lattice_sites, genice.cell\n)\n\ngenice.add_bjerrum_D(D_edges)\ngenice.add_bjerrum_L(L_edges)\n\nExporter(\"gromacs\").dump(\n    genice,\n    water_model=\"3site\",\n)\n</code></pre>"},{"location":"api-examples/unitcell_transform/","title":"Unit cell transform","text":"<p>Extending or transforming the unit cell.</p> <ul> <li><code>10_extend_unitcell.py</code> </li> <li>Use <code>replication_matrix</code> to extend the unit cell and build a larger supercell.</li> </ul>"},{"location":"api-examples/unitcell_transform/#sample-code","title":"Sample code","text":""},{"location":"api-examples/unitcell_transform/#10_extend_unitcell","title":"10_extend_unitcell","text":"<p><code>10_extend_unitcell.py</code> | <code>10_extend_unitcell.sh</code> | <code>10_extend_unitcell.yaml</code></p> 10_extend_unitcell.py10_extend_unitcell.sh10_extend_unitcell.yaml <pre><code>#!/usr/bin/env python3\n\"\"\"\n\u62e1\u5927\u80de\u3092\u65b0\u305f\u306b\u5358\u4f4d\u80de\u3068\u3059\u308b unitcell \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u51fa\u529b\u3059\u308b\u4f8b\u3002\n\n\u5bfe\u5fdc\u3059\u308b CLI: examples/api/10_extend_unitcell.sh\n\u5bfe\u5fdc\u3059\u308b YAML: examples/api/10_extend_unitcell.yaml\n\n\u751f\u6210\u3055\u308c\u305f A15e.py \u306f\u3001rep=1 1 1 \u3067\u540c\u3058\u69cb\u9020\u3092\u518d\u73fe\u3059\u308b unitcell \u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\"\"\"\n\nfrom pathlib import Path\n\nfrom genice3.genice import GenIce3\nfrom genice3.plugin import safe_import\n\n# A15 \u5358\u4f4d\u80de\u3001\u8907\u88fd\u884c\u5217\u3067\u62e1\u5927\nunitcell = safe_import(\"unitcell\", \"A15\").UnitCell()\ngenice = GenIce3(unitcell=unitcell)\ngenice.set_replication_matrix([[1, 1, 0], [-1, 1, 0], [0, 0, 1]])\n\n# python exporter \u3067 unitcell \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\nexporter = safe_import(\"exporter\", \"python\")\nexporter.dump(genice)\n</code></pre> <pre><code>#!/bin/bash\n# Generated from 10_extend_unitcell.yaml\n\npython3 -m genice3.cli.genice A15 \\\n  --replication_matrix 1 1 0 -1 1 0 0 0 1 \\\n  --exporter python\n</code></pre> <pre><code># Run with GenIce3: genice3 --config 10_extend_unitcell.yaml\n# Generated from 10_extend_unitcell.sh\n\nunitcell: A15\nreplication_matrix:\n- 1\n- 1\n- 0\n- -1\n- 1\n- 0\n- 0\n- 0\n- 1\nexporter: python\n</code></pre>"}]}
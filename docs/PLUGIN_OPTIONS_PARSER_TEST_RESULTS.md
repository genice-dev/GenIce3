# プラグインオプションパーサーのテスト結果

## ユーザー提示例のパース結果

### 入力オプション文字列

**コマンドライン**:

```bash
--exporter "gromacs[guest.A12=0.3*me[monatomic]+0.6*et[molecular], spot_guest.0=propane]"
```

**実際にパーサーに渡されるオプション文字列部分**（`gromacs[...]` の `[...]` の中身）:

```
guest.A12=0.3*me[monatomic]+0.6*et[molecular], spot_guest.0=propane
```

---

## パース結果

### 結果の辞書

```python
{
    "guest.A12": "0.3*me[monatomic]+0.6*et[molecular]",
    "spot_guest.0": "propane"
}
```

### 詳細な情報

| キー           | 値                                      | 型    | 文字列長 | 説明                                             |
| -------------- | --------------------------------------- | ----- | -------- | ------------------------------------------------ |
| `guest.A12`    | `"0.3*me[monatomic]+0.6*et[molecular]"` | `str` | 35 文字  | 混合ガス記述は文字列のまま（プラグイン側で解釈） |
| `spot_guest.0` | `"propane"`                             | `str` | 7 文字   | 単純な値                                         |

### JSON 形式（読みやすい形式）

```json
{
  "guest.A12": "0.3*me[monatomic]+0.6*et[molecular]",
  "spot_guest.0": "propane"
}
```

---

## パーサーの動作

### 自動的に解釈されるもの

1. **カンマ区切りでオプションを分割**

   - `guest.A12=...` と `spot_guest.0=...` を分離

2. **キーと値の分離**

   - `key=value` 形式を `key` と `value` に分割

3. **階層的キー名の認識**
   - `guest.A12` や `spot_guest.0` はそのままキーとして使用

### 自動的に解釈されないもの（文字列のまま）

1. **混合ガス記述**

   - `0.3*me[monatomic]+0.6*et[molecular]` は文字列のまま
   - プラグイン側で解釈する責任を持つ

2. **ネストしたプラグインのオプション**
   - `me[monatomic]` の中の `[monatomic]` 部分も文字列のまま
   - プラグイン側で解釈する責任を持つ

---

## 追加テストケース

### テストケース 1: 丸括弧配列を含む場合

**入力**:

```
guest.A12=0.3*me[monatomic]+0.6*et[molecular],shift=(0.1,0.1,0.1),rep=(3,3,3)
```

**パース結果**:

```python
{
    "guest.A12": "0.3*me[monatomic]+0.6*et[molecular]",
    "shift": [0.1, 0.1, 0.1],
    "rep": [3.0, 3.0, 3.0]
}
```

**説明**:

- 丸括弧配列形式 `shift=(0.1,0.1,0.1)` は自動的にリスト `[0.1, 0.1, 0.1]` に変換
- 混合ガス記述は文字列のまま

### テストケース 2: 単純なゲスト指定

**入力**:

```
guest.A12=me,guest.A14=et
```

**パース結果**:

```python
{
    "guest.A12": "me",
    "guest.A14": "et"
}
```

**説明**:

- 単純な値はそのまま文字列として保持

### テストケース 3: 丸括弧配列のみ

**入力**:

```
shift=(0.1,0.1,0.1),rep=(3,3,3)
```

**パース結果**:

```python
{
    "shift": [0.1, 0.1, 0.1],
    "rep": [3.0, 3.0, 3.0]
}
```

**説明**:

- 丸括弧配列形式は自動的にリストに変換
- 数値は自動的に `float` または `int` に変換

---

## まとめ

### パーサーの役割

- ✅ カンマ区切りでオプションを分割
- ✅ キーと値の分離
- ✅ 丸括弧配列形式の自動変換（`(0.1,0.1,0.1)` → `[0.1, 0.1, 0.1]`）
- ✅ 階層的キー名の認識

### プラグイン側の責任

- ✅ 混合ガス記述の解釈（`0.3*me[monatomic]+0.6*et[molecular]`）
- ✅ ネストしたプラグインのオプションの解釈（`me[monatomic]` の中の `[monatomic]`）
- ✅ 複雑な値の解釈

### パース結果の特徴

1. **混合ガス記述は文字列のまま**

   - `"0.3*me[monatomic]+0.6*et[molecular]"` として保持
   - プラグインが自分で解釈する

2. **丸括弧配列は自動的にリストに変換**

   - `shift=(0.1,0.1,0.1)` → `[0.1, 0.1, 0.1]`
   - 数値は自動的に変換される

3. **階層的キー名はそのまま使用**
   - `guest.A12` や `spot_guest.0` はそのままキーとして使用
   - プラグインが階層を理解して処理する

この設計により、基本的なオプションのパースは共通化され、複雑な記述はプラグイン側で柔軟に解釈できます。
